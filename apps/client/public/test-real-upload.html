<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Real Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Test Image Upload</h1>
        
        <!-- Partner Upload Test -->
        <div class="bg-white p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold mb-4">Test Partner Upload</h2>
            <form id="partnerForm" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Partner Name</label>
                    <input type="text" name="name" value="Test Partner" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Partner Link</label>
                    <input type="text" name="link" value="https://example.com" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea name="description" class="w-full p-2 border rounded">Test partner description</textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Logo Image</label>
                    <input type="file" name="logo" accept="image/*" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <input type="hidden" name="is_active" value="true">
                    <input type="hidden" name="display_order" value="1">
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Upload Partner
                </button>
            </form>
            <div id="partnerResult" class="mt-4"></div>
        </div>
        
        <!-- Service Upload Test -->
        <div class="bg-white p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold mb-4">Test Service Upload</h2>
            <form id="serviceForm" enctype="multipart/form-data">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Service Name</label>
                    <input type="text" name="name" value="Test Service" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Service Link</label>
                    <input type="text" name="link" value="https://example.com" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea name="description" class="w-full p-2 border rounded">Test service description</textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Icon</label>
                    <input type="text" name="icon" value="🔧" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Service Image</label>
                    <input type="file" name="image" accept="image/*" class="w-full p-2 border rounded">
                </div>
                <div class="mb-4">
                    <input type="hidden" name="is_active" value="true">
                    <input type="hidden" name="display_order" value="1">
                </div>
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Upload Service
                </button>
            </form>
            <div id="serviceResult" class="mt-4"></div>
        </div>
        
        <!-- Display Test -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Test Image Display</h2>
            <button onclick="testImageDisplay()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                Test Current Images
            </button>
            <div id="displayResult" class="mt-4"></div>
        </div>
    </div>
    
    <script>
        // Test partner upload
        document.getElementById('partnerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                console.log('Uploading partner...');
                const response = await fetch('/api/admin/partners', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Authorization': 'Bearer test-token'
                    }
                });
                
                const result = await response.json();
                document.getElementById('partnerResult').innerHTML = `
                    <div class="p-4 rounded ${result.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        <strong>Result:</strong> ${result.message}<br>
                        <strong>Response:</strong> <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
                
                if (result.success) {
                    setTimeout(testImageDisplay, 1000);
                }
            } catch (error) {
                console.error('Upload error:', error);
                document.getElementById('partnerResult').innerHTML = `
                    <div class="p-4 rounded bg-red-100 text-red-800">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        });
        
        // Test service upload
        document.getElementById('serviceForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                console.log('Uploading service...');
                const response = await fetch('/api/admin/other-services', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Authorization': 'Bearer test-token'
                    }
                });
                
                const result = await response.json();
                document.getElementById('serviceResult').innerHTML = `
                    <div class="p-4 rounded ${result.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                        <strong>Result:</strong> ${result.message}<br>
                        <strong>Response:</strong> <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                `;
                
                if (result.success) {
                    setTimeout(testImageDisplay, 1000);
                }
            } catch (error) {
                console.error('Upload error:', error);
                document.getElementById('serviceResult').innerHTML = `
                    <div class="p-4 rounded bg-red-100 text-red-800">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        });
        
        // Test image display
        async function testImageDisplay() {
            try {
                console.log('Testing image display...');
                
                // Test partners
                const partnersResponse = await fetch('/api/partners');
                const partnersData = await partnersResponse.json();
                
                // Test services
                const servicesResponse = await fetch('/api/other-services');
                const servicesData = await servicesResponse.json();
                
                let html = '<h3 class="font-semibold mb-2">Current Partners:</h3>';
                
                if (partnersData.success && partnersData.partners) {
                    partnersData.partners.forEach(partner => {
                        const imageUrl = partner.logo_url;
                        html += `
                            <div class="border p-4 mb-2 rounded">
                                <strong>${partner.name}</strong><br>
                                <span class="text-sm text-gray-600">Image URL: ${imageUrl || 'None'}</span><br>
                                ${imageUrl ? `
                                    <img src="${imageUrl}" alt="${partner.name}" class="w-16 h-16 object-contain mt-2 border"
                                         onload="console.log('✅ Partner image loaded: ${imageUrl}')"
                                         onerror="console.error('❌ Partner image failed: ${imageUrl}')">
                                    <br><small>Test URL: <a href="${imageUrl}" target="_blank" class="text-blue-500">${imageUrl}</a></small>
                                ` : '<div class="w-16 h-16 bg-gray-200 mt-2 flex items-center justify-center">No Image</div>'}
                            </div>
                        `;
                    });
                }
                
                html += '<h3 class="font-semibold mb-2 mt-4">Current Services:</h3>';
                
                if (servicesData.success && servicesData.services) {
                    servicesData.services.forEach(service => {
                        const imageUrl = service.image_url;
                        html += `
                            <div class="border p-4 mb-2 rounded">
                                <strong>${service.name}</strong><br>
                                <span class="text-sm text-gray-600">Image URL: ${imageUrl || 'None'}</span><br>
                                <span class="text-sm text-gray-600">Icon: ${service.icon || 'None'}</span><br>
                                ${imageUrl ? `
                                    <img src="${imageUrl}" alt="${service.name}" class="w-16 h-16 object-contain mt-2 border"
                                         onload="console.log('✅ Service image loaded: ${imageUrl}')"
                                         onerror="console.error('❌ Service image failed: ${imageUrl}')">
                                    <br><small>Test URL: <a href="${imageUrl}" target="_blank" class="text-blue-500">${imageUrl}</a></small>
                                ` : `<div class="w-16 h-16 bg-gray-200 mt-2 flex items-center justify-center">${service.icon || '📷'}</div>`}
                            </div>
                        `;
                    });
                }
                
                document.getElementById('displayResult').innerHTML = html;
                
            } catch (error) {
                console.error('Display test error:', error);
                document.getElementById('displayResult').innerHTML = `
                    <div class="p-4 rounded bg-red-100 text-red-800">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test on load
        testImageDisplay();
    </script>
</body>
</html>