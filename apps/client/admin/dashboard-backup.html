<!DOCTYPE html>
<html lang="en" class="admin-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Dashboard | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="admin-auth-check.js"></script>
    <style>
        :root {
            --primary-color: #080b3b;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.2s ease-in-out;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .sidebar {
            background: linear-gradient(180deg, #1e293b 0%, #334155 100%);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 2px 8px;
        }
        
        .nav-item:hover {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .nav-item.active {
            background: linear-gradient(90deg, var(--accent-color) 0%, #1d4ed8 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            border-left: 4px solid #fbbf24;
        }
        
        .nav-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin: 8px 4px;
            padding: 8px 4px;
        }
        
        .nav-group-title {
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 8px 12px;
            margin-bottom: 4px;
        }
        
        .sidebar-scroll {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
            padding-bottom: 20px;
        }
        
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 3px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.2) 100%);
            border-radius: 3px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.4) 100%);
        }
        
        .badge {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .badge-new {
            background: linear-gradient(45deg, #10b981, #059669);
        }
        
        .badge-featured {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.info {
            background: #3b82f6;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid var(--accent-color);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Notification Container -->
    <div id="notification-container"></div>

    <!-- Enhanced Sidebar -->
    <div class="fixed inset-y-0 left-0 w-72 sidebar z-50 flex flex-col">
        <!-- Header -->
        <div class="flex items-center justify-center h-20 px-6 border-b border-white/10">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-crown text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-white font-bold text-xl">Admin Panel</h1>
                    <p class="text-white/70 text-sm">Enhanced Dashboard</p>
                </div>
            </div>
        </div>

        <!-- Navigation with Enhanced Scrolling -->
        <div class="sidebar-scroll">
            <nav class="mt-6 px-4">        
                <!-- MAIN DASHBOARD -->
                <div class="nav-group">
                    <div class="nav-group-title">MAIN DASHBOARD</div>
                    <a href="dashboard.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-tachometer-alt w-5"></i>
                        <span class="flex-1">Main Dashboard</span>
                        <span class="badge badge-new">Live</span>
                    </a>
                    <a href="dashboard-backup.html" class="nav-item active flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-chart-line w-5"></i>
                        <span class="flex-1">Enhanced Dashboard</span>
                        <span class="badge badge-featured">Current</span>
                    </a>
                    <a href="reports.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-chart-bar w-5"></i>
                        <span class="flex-1">Analytics & Reports</span>
                        <span class="badge" id="nav-reports-count">0</span>
                    </a>
                </div>
                
                <!-- USER MANAGEMENT -->
                <div class="nav-group">
                    <div class="nav-group-title">USER MANAGEMENT</div>
                    <a href="user-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-users w-5"></i>
                        <span class="flex-1">All Users</span>
                        <span class="badge" id="nav-users-count">0</span>
                    </a>
                    <a href="agents.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-user-tie w-5"></i>
                        <span class="flex-1">Agents</span>
                        <span class="badge" id="nav-agents-count">0</span>
                    </a>
                    <a href="agent-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-user-cog w-5"></i>
                        <span class="flex-1">Agent Management</span>
                    </a>
                    <a href="sellers.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-store w-5"></i>
                        <span class="flex-1">Sellers</span>
                        <span class="badge" id="nav-sellers-count">0</span>
                    </a>
                </div>
                
                <!-- PRODUCT & INVENTORY -->
                <div class="nav-group">
                    <div class="nav-group-title">PRODUCT & INVENTORY</div>
                    <a href="products.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-box w-5"></i>
                        <span class="flex-1">All Products</span>
                        <span class="badge" id="nav-products-count">0</span>
                    </a>
                    <a href="categories.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-list w-5"></i>
                        <span class="flex-1">Categories</span>
                    </a>
                    <a href="brands.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-trademark w-5"></i>
                        <span class="flex-1">Brand Management</span>
                    </a>
                    <a href="reviews.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-star w-5"></i>
                        <span class="flex-1">Product Reviews</span>
                        <span class="badge" id="nav-reviews-count">0</span>
                    </a>
                </div>
                
                <!-- ORDER MANAGEMENT -->
                <div class="nav-group">
                    <div class="nav-group-title">ORDER MANAGEMENT</div>
                    <a href="order-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-shopping-bag w-5"></i>
                        <span class="flex-1">Order Management</span>
                        <span class="badge" id="nav-orders-count">0</span>
                    </a>
                    <a href="shipping-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-truck w-5"></i>
                        <span class="flex-1">Shipping Management</span>
                    </a>
                    <a href="delivery-zones.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-map w-5"></i>
                        <span class="flex-1">Delivery Zones</span>
                    </a>
                </div>
                
                <!-- LOCAL MARKET & GROCERY -->
                <div class="nav-group">
                    <div class="nav-group-title">LOCAL MARKET & GROCERY</div>
                    <a href="local-market-admin.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-map-marker-alt w-5"></i>
                        <span class="flex-1">Local Market Dashboard</span>
                        <span class="badge badge-featured">Featured</span>
                    </a>
                    <a href="grocery-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-shopping-basket w-5"></i>
                        <span class="flex-1">Grocery Management</span>
                        <span class="badge badge-new">Fresh</span>
                    </a>
                </div>
                
                <!-- PAYMENT & FINANCIAL -->
                <div class="nav-group">
                    <div class="nav-group-title">PAYMENT & FINANCIAL</div>
                    <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-clipboard-check w-5"></i>
                        <span class="flex-1">Payment Approval</span>
                        <span class="badge" id="nav-pending-payments">0</span>
                    </a>
                    <a href="escrow-payment-settings.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-shield-alt w-5"></i>
                        <span class="flex-1">Escrow Settings</span>
                    </a>
                    <a href="tax-commission.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-percentage w-5"></i>
                        <span class="flex-1">Tax & Commission</span>
                        <span class="badge badge-new">Config</span>
                    </a>
                    <a href="delivery-tax-settings.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-calculator w-5"></i>
                        <span class="flex-1">Delivery & Tax Settings</span>
                        <span class="badge badge-featured">Config</span>
                    </a>
                </div>
                
                <!-- MARKETING & PROMOTIONS -->
                <div class="nav-group">
                    <div class="nav-group-title">MARKETING & PROMOTIONS</div>
                    <a href="marketing.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-bullhorn w-5"></i>
                        <span class="flex-1">Marketing Dashboard</span>
                    </a>
                    <a href="promotions.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-tag w-5"></i>
                        <span class="flex-1">Promotions</span>
                    </a>
                    <a href="ads-boosting-approval.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-star w-5"></i>
                        <span class="flex-1">Ads & Boosting</span>
                        <span class="badge" id="nav-ads-count">0</span>
                    </a>
                    <a href="announcements-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-bell w-5"></i>
                        <span class="flex-1">Announcements</span>
                    </a>
                </div>
                
                <!-- CONTENT & CMS -->
                <div class="nav-group">
                    <div class="nav-group-title">CONTENT & CMS</div>
                    <a href="cms-management.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-file-alt w-5"></i>
                        <span class="flex-1">CMS Management</span>
                        <span class="badge badge-new">New</span>
                    </a>
                    <a href="theme-customization.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-palette w-5"></i>
                        <span class="flex-1">Theme Customization</span>
                        <span class="badge badge-new">New</span>
                    </a>
                    <a href="email-sms-templates.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-envelope w-5"></i>
                        <span class="flex-1">Email & SMS Templates</span>
                        <span class="badge badge-new">New</span>
                    </a>
                    <a href="multi-currency-settings.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-globe w-5"></i>
                        <span class="flex-1">Multi-Currency Settings</span>
                        <span class="badge badge-new">7 Langs</span>
                    </a>
                </div>
                
                <!-- COMMUNICATION & SUPPORT -->
                <div class="nav-group">
                    <div class="nav-group-title">COMMUNICATION & SUPPORT</div>
                    <a href="live-chat-monitoring.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-comments w-5"></i>
                        <span class="flex-1">Live Chat Monitoring</span>
                        <span class="badge badge-featured">Active</span>
                    </a>
                    <a href="support-tickets.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-headset w-5"></i>
                        <span class="flex-1">Support Tickets</span>
                        <span class="badge" id="nav-tickets-count">0</span>
                    </a>
                </div>
                
                <!-- SYSTEM & SETTINGS -->
                <div class="nav-group">
                    <div class="nav-group-title">SYSTEM & SETTINGS</div>
                    <a href="system-settings.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-cog w-5"></i>
                        <span class="flex-1">System Settings</span>
                    </a>
                    <a href="settings.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-sliders-h w-5"></i>
                        <span class="flex-1">General Settings</span>
                    </a>
                    <a href="system-testing.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-flask w-5"></i>
                        <span class="flex-1">System Testing</span>
                        <span class="badge badge-new">New</span>
                    </a>
                    <a href="logs.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-list-alt w-5"></i>
                        <span class="flex-1">System Logs</span>
                    </a>
                    <a href="admin-logs-security.html" class="nav-item flex items-center space-x-3 px-4 py-3 text-white rounded-lg">
                        <i class="fas fa-shield-alt w-5"></i>
                        <span class="flex-1">Admin Logs & Security</span>
                        <span class="badge badge-featured">Secure</span>
                    </a>
                </div>
                
                <!-- Bottom Spacing -->
                <div class="h-8"></div>
            </nav>
        </div>
        
        <!-- Footer -->
        <div class="border-t border-white/10 p-4">
            <div class="flex items-center justify-between text-white/70 text-sm">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-circle text-green-400 text-xs"></i>
                    <span>System Online</span>
                </div>
                <div class="text-xs">
                    v2.1.0
                </div>
            </div>
            <button onclick="logout()" class="w-full mt-2 bg-red-500/20 hover:bg-red-500/30 text-white px-3 py-2 rounded-lg text-sm transition-colors">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="ml-72 p-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">Enhanced Dashboard</h1>
                <p class="text-white/70">Welcome back, Administrator</p>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="refreshDashboard()" class="bg-white/10 text-white px-4 py-2 rounded-lg hover:bg-white/20 transition-colors">
                    <i class="fas fa-refresh mr-2"></i>Refresh
                </button>
                <div class="flex items-center space-x-3 bg-white/10 px-4 py-2 rounded-lg">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div>
                        <div class="text-white font-medium">Admin User</div>
                        <div class="text-white/70 text-sm">Super Admin</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Stats Cards -->
        <div id="dashboard-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stat-card rounded-xl p-6 cursor-pointer" onclick="window.location.href='user-management.html'">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total Users</p>
                        <p class="text-white text-2xl font-bold" id="total-users">Loading...</p>
                        <p class="text-green-400 text-sm" id="users-change">+0% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-blue-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card rounded-xl p-6 cursor-pointer" onclick="window.location.href='order-management.html'">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total Orders</p>
                        <p class="text-white text-2xl font-bold" id="total-orders">Loading...</p>
                        <p class="text-green-400 text-sm" id="orders-change">+0% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shopping-cart text-green-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card rounded-xl p-6 cursor-pointer" onclick="window.location.href='reports.html'">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Total Revenue</p>
                        <p class="text-white text-2xl font-bold" id="total-revenue">Loading...</p>
                        <p class="text-green-400 text-sm" id="revenue-change">+0% vs last month</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-yellow-400 text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="stat-card rounded-xl p-6 cursor-pointer" onclick="window.location.href='manual-payment-approval.html'">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white/70 text-sm">Pending Approvals</p>
                        <p class="text-white text-2xl font-bold" id="pending-approvals">Loading...</p>
                        <p class="text-orange-400 text-sm">Requires attention</p>
                    </div>
                    <div class="w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clock text-red-400 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Revenue Chart -->
            <div class="glass-morphism p-6 rounded-xl">
                <h3 class="text-xl font-bold text-white mb-4">Revenue Trend (Last 30 Days)</h3>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>

            <!-- User Growth Chart -->
            <div class="glass-morphism p-6 rounded-xl">
                <h3 class="text-xl font-bold text-white mb-4">User Growth (Last 30 Days)</h3>
                <div class="chart-container">
                    <canvas id="userGrowthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- System Status & Recent Activities -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- System Status -->
            <div class="glass-morphism p-6 rounded-xl">
                <h3 class="text-xl font-bold text-white mb-4">System Status</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-server text-green-400"></i>
                            <span class="text-white">Server Status</span>
                        </div>
                        <span class="text-green-400 font-medium">Online</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-database text-green-400"></i>
                            <span class="text-white">Database</span>
                        </div>
                        <span class="text-green-400 font-medium">Connected</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-shield-alt text-green-400"></i>
                            <span class="text-white">Security</span>
                        </div>
                        <span class="text-green-400 font-medium">Active</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-cloud text-blue-400"></i>
                            <span class="text-white">Backup Status</span>
                        </div>
                        <span class="text-blue-400 font-medium">Synced</span>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="glass-morphism p-6 rounded-xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-white">Recent Activities</h3>
                    <button onclick="loadRecentActivities()" class="text-white/70 hover:text-white transition-colors">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div id="recent-activities" class="space-y-4">
                    <div class="text-center py-8">
                        <div class="loading-spinner mx-auto mb-4"></div>
                        <p class="text-white/70">Loading recent activities...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-morphism p-6 rounded-xl">
            <h3 class="text-xl font-bold text-white mb-4">Quick Actions</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <button onclick="window.location.href='user-management.html'" class="bg-blue-500/20 hover:bg-blue-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-users text-2xl mb-2"></i>
                    <div class="text-sm">Manage Users</div>
                </button>
                <button onclick="window.location.href='products.html'" class="bg-green-500/20 hover:bg-green-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-box text-2xl mb-2"></i>
                    <div class="text-sm">Products</div>
                </button>
                <button onclick="window.location.href='order-management.html'" class="bg-purple-500/20 hover:bg-purple-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-shopping-cart text-2xl mb-2"></i>
                    <div class="text-sm">Orders</div>
                </button>
                <button onclick="window.location.href='manual-payment-approval.html'" class="bg-orange-500/20 hover:bg-orange-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-credit-card text-2xl mb-2"></i>
                    <div class="text-sm">Payments</div>
                </button>
                <button onclick="window.location.href='reports.html'" class="bg-indigo-500/20 hover:bg-indigo-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-chart-bar text-2xl mb-2"></i>
                    <div class="text-sm">Reports</div>
                </button>
                <button onclick="window.location.href='settings.html'" class="bg-gray-500/20 hover:bg-gray-500/30 text-white p-4 rounded-lg text-center transition-colors">
                    <i class="fas fa-cog text-2xl mb-2"></i>
                    <div class="text-sm">Settings</div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let revenueChart = null;
        let userGrowthChart = null;
        let dashboardData = {};

        // Initialize enhanced dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Enhanced Admin Dashboard initializing...');
            
            // Check authentication first
            checkAuthentication();
            
            // Load dashboard data
            loadDashboardData();
            updateNavigationCounts();
            setupAutoRefresh();
        });

        // Check authentication and prevent redirect loops
        function checkAuthentication() {
            const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
            const userRole = localStorage.getItem('userRole');
            
            if (!token) {
                console.log('❌ No authentication token found, redirecting to login');
                window.location.href = '/auth/auth-admin.html';
                return false;
            }
            
            if (userRole !== 'admin') {
                console.log('❌ Insufficient permissions, user role:', userRole);
                showNotification('Access denied. Admin privileges required.', 'error');
                setTimeout(() => {
                    window.location.href = '/auth/auth-admin.html';
                }, 2000);
                return false;
            }
            
            console.log('✅ Authentication verified for admin user');
            return true;
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                console.log('📊 Loading enhanced dashboard data...');
                
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                if (!token) {
                    throw new Error('No authentication token found');
                }

                const response = await fetch('/api/admin/dashboard', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        handleTokenExpiry();
                        return;
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('✅ Enhanced dashboard data loaded:', data);

                if (data.success) {
                    dashboardData = data;
                    updateDashboardStats(data.stats);
                    updateCharts(data);
                    updateRecentActivities(data.recent_activities);
                } else {
                    throw new Error(data.message || 'Failed to load dashboard data');
                }

            } catch (error) {
                console.error('❌ Error loading enhanced dashboard:', error);
                showNotification('Failed to load dashboard data: ' + error.message, 'error');
                showFallbackData();
            }
        }

        // Update dashboard stats
        function updateDashboardStats(stats) {
            if (!stats) return;

            // Users
            if (stats.users) {
                document.getElementById('total-users').textContent = stats.users.total_users || 0;
                document.getElementById('users-change').textContent = `+${stats.users.growth_percentage || 0}% vs last month`;
            }

            // Orders
            if (stats.orders) {
                document.getElementById('total-orders').textContent = stats.orders.total_orders || 0;
                document.getElementById('orders-change').textContent = `+${stats.orders.growth_percentage || 0}% vs last month`;
                document.getElementById('total-revenue').textContent = formatCurrency(stats.orders.total_revenue || 0);
                document.getElementById('revenue-change').textContent = `+${stats.orders.revenue_growth || 0}% vs last month`;
            }

            // Approvals
            if (stats.approvals) {
                document.getElementById('pending-approvals').textContent = stats.approvals.pending_approvals || 0;
            }
        }

        // Update navigation counts
        async function updateNavigationCounts() {
            try {
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                if (!token) return;

                // Update various counts in navigation
                const counts = {
                    'nav-users-count': await getCount('/api/admin/users'),
                    'nav-agents-count': await getCount('/api/admin/agents'),
                    'nav-sellers-count': await getCount('/api/admin/sellers'),
                    'nav-products-count': await getCount('/api/admin/products'),
                    'nav-orders-count': await getCount('/api/admin/orders'),
                    'nav-reviews-count': await getCount('/api/admin/reviews'),
                    'nav-pending-payments': await getCount('/api/admin/payments', { status: 'pending' }),
                    'nav-tickets-count': await getCount('/api/admin/support-tickets'),
                    'nav-ads-count': await getCount('/api/admin/ads-boosting-approval')
                };

                Object.entries(counts).forEach(([id, count]) => {
                    const element = document.getElementById(id);
                    if (element && count !== null) {
                        element.textContent = count;
                    }
                });

            } catch (error) {
                console.error('Failed to update navigation counts:', error);
            }
        }

        // Get count from API
        async function getCount(endpoint, params = {}) {
            try {
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                const queryString = new URLSearchParams(params).toString();
                const url = queryString ? `${endpoint}?${queryString}` : endpoint;
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.total || data.count || (Array.isArray(data.data) ? data.data.length : 0);
                }
                return 0;
            } catch (error) {
                return 0;
            }
        }

        // Update charts
        function updateCharts(data) {
            updateRevenueChart(data);
            updateUserGrowthChart(data);
        }

        // Update revenue chart
        function updateRevenueChart(data) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            if (revenueChart) {
                revenueChart.destroy();
            }

            const chartData = data.analytics?.revenue_trend || generateSampleRevenue();

            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Revenue (FRW)',
                        data: chartData.data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Update user growth chart
        function updateUserGrowthChart(data) {
            const ctx = document.getElementById('userGrowthChart').getContext('2d');
            
            if (userGrowthChart) {
                userGrowthChart.destroy();
            }

            const chartData = data.analytics?.user_growth || generateSampleUserGrowth();

            userGrowthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'New Users',
                        data: chartData.data,
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Update recent activities
        function updateRecentActivities(activities) {
            const container = document.getElementById('recent-activities');
            
            if (!activities || activities.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-white/70">
                            <i class="fas fa-history text-2xl mb-4"></i>
                            <p>No recent activities</p>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.slice(0, 8).map(activity => `
                <div class="flex items-center space-x-4 p-3 bg-white/5 rounded-lg">
                    <div class="w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-${getActivityIcon(activity.type)} text-blue-400 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-white text-sm">${activity.description}</p>
                        <p class="text-white/50 text-xs">${new Date(activity.timestamp).toLocaleString()}</p>
                    </div>
                </div>
            `).join('');
        }

        // Get activity icon
        function getActivityIcon(type) {
            const icons = {
                'user_registration': 'user-plus',
                'order_placed': 'shopping-cart',
                'payment_approved': 'check-circle',
                'product_added': 'box',
                'user_login': 'sign-in-alt',
                'payment_pending': 'clock'
            };
            return icons[type] || 'info-circle';
        }

        // Generate sample data
        function generateSampleRevenue() {
            const labels = [];
            const data = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                data.push(Math.floor(Math.random() * 50000) + 10000);
            }
            
            return { labels, data };
        }

        function generateSampleUserGrowth() {
            const labels = [];
            const data = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                data.push(Math.floor(Math.random() * 20) + 5);
            }
            
            return { labels, data };
        }

        // Show fallback data
        function showFallbackData() {
            document.getElementById('total-users').textContent = '71';
            document.getElementById('users-change').textContent = '+12% vs last month';
            document.getElementById('total-orders').textContent = '4';
            document.getElementById('orders-change').textContent = '+25% vs last month';
            document.getElementById('total-revenue').textContent = formatCurrency(125000);
            document.getElementById('revenue-change').textContent = '+18% vs last month';
            document.getElementById('pending-approvals').textContent = '9';
            
            // Show fallback charts
            updateRevenueChart({});
            updateUserGrowthChart({});
            
            // Show fallback activities
            document.getElementById('recent-activities').innerHTML = `
                <div class="text-center py-8">
                    <div class="text-white/70">
                        <i class="fas fa-exclamation-triangle text-2xl mb-4"></i>
                        <p>Unable to load recent activities</p>
                        <p class="text-sm">Please check your connection and try again</p>
                    </div>
                </div>
            `;
        }

        // Refresh dashboard
        function refreshDashboard() {
            console.log('🔄 Refreshing enhanced dashboard...');
            showNotification('Refreshing dashboard data...', 'info');
            loadDashboardData();
            updateNavigationCounts();
        }

        // Load recent activities
        function loadRecentActivities() {
            console.log('🔄 Refreshing recent activities...');
            if (dashboardData.recent_activities) {
                updateRecentActivities(dashboardData.recent_activities);
            } else {
                loadDashboardData();
            }
        }

        // Setup auto refresh
        function setupAutoRefresh() {
            // Refresh dashboard data every 5 minutes
            setInterval(() => {
                console.log('🔄 Auto-refreshing enhanced dashboard...');
                loadDashboardData();
                updateNavigationCounts();
            }, 5 * 60 * 1000);
        }

        // Format currency
        function formatCurrency(amount) {
            if (!amount) return '0 FRW';
            return new Intl.NumberFormat('en-RW', {
                style: 'currency',
                currency: 'RWF',
                minimumFractionDigits: 0
            }).format(parseFloat(amount)).replace('RWF', 'FRW');
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Handle token expiry
        function handleTokenExpiry() {
            console.log('🔒 Token expired, redirecting to login');
            localStorage.removeItem('adminToken');
            localStorage.removeItem('token');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userInfo');
            showNotification('Session expired. Please login again.', 'error');
            setTimeout(() => {
                window.location.href = '/auth/auth-admin.html';
            }, 2000);
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('token');
                localStorage.removeItem('userRole');
                localStorage.removeItem('userInfo');
                window.location.href = '/auth/auth-admin.html';
            }
        }

        // Make functions globally available
        window.refreshDashboard = refreshDashboard;
        window.loadRecentActivities = loadRecentActivities;
        window.logout = logout;
        window.showNotification = showNotification;

        console.log('✅ Enhanced Admin Dashboard initialized successfully');
    </script>
</body>
</html>