<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home Background Ads - Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .admin-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .upload-area {
      border: 2px dashed #e2e8f0;
      border-radius: 12px;
      transition: all 0.3s ease;
      background: #f8fafc;
    }
    
    .upload-area.dragover {
      border-color: #3b82f6;
      background: #dbeafe;
      transform: scale(1.02);
    }
    
    .upload-area:hover {
      border-color: #6366f1;
      background: #f1f5f9;
    }
    
    .preview-container {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .preview-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .preview-container:hover .preview-overlay {
      opacity: 1;
    }
    
    .ad-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border: 1px solid #f1f5f9;
    }
    
    .ad-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    
    .ad-card.active {
      border-color: #10b981;
      box-shadow: 0 4px 20px rgba(16, 185, 129, 0.2);
    }
    
    .modal-overlay {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .loading-shimmer {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .type-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .type-default { background: #ddd6fe; color: #7c3aed; }
    .type-image { background: #dcfce7; color: #16a34a; }
    .type-video { background: #fef3c7; color: #d97706; }
    .type-slideshow { background: #ffe4e6; color: #dc2626; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="admin-gradient text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="dashboard.html" class="text-white hover:text-blue-200 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
          </a>
          <h1 class="text-2xl font-bold">Home Background Ads</h1>
          <span class="bg-white/20 px-3 py-1 rounded-full text-sm">Management Center</span>
        </div>
        <div class="flex items-center gap-4">
          <button id="stats-toggle" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
            <i class="fas fa-chart-line mr-2"></i>Statistics
          </button>
          <button id="create-ad-btn" class="bg-white text-indigo-600 font-bold px-6 py-2 rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
            <i class="fas fa-plus mr-2"></i>Create New Ad
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    <!-- Statistics Cards -->
    <div id="stats-section" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 fade-in">
      <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Ads</p>
            <p id="total-ads" class="text-3xl font-bold text-gray-900">0</p>
          </div>
          <div class="bg-blue-100 p-3 rounded-lg">
            <i class="fas fa-ad text-blue-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Active Ads</p>
            <p id="active-ads" class="text-3xl font-bold text-green-600">0</p>
          </div>
          <div class="bg-green-100 p-3 rounded-lg">
            <i class="fas fa-eye text-green-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Current Active</p>
            <p id="current-active" class="text-2xl font-bold text-purple-600">None</p>
          </div>
          <div class="bg-purple-100 p-3 rounded-lg">
            <i class="fas fa-star text-purple-600 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Media Files</p>
            <p id="media-count" class="text-3xl font-bold text-orange-600">0</p>
          </div>
          <div class="bg-orange-100 p-3 rounded-lg">
            <i class="fas fa-image text-orange-600 text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters & Search -->
    <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100 mb-8">
      <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="relative">
            <input type="text" id="search-ads" placeholder="Search ads..." 
                   class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
          </div>
          <select id="filter-type" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <option value="">All Types</option>
            <option value="default">Default</option>
            <option value="image">Image</option>
            <option value="video">Video</option>
            <option value="slideshow">Slideshow</option>
          </select>
          <select id="filter-status" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <button id="refresh-ads" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
          <i class="fas fa-sync-alt mr-2"></i>Refresh
        </button>
      </div>
    </div>

    <!-- Ads Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <div id="ads-container">
        <!-- Loading placeholders -->
        <div class="ad-card p-6">
          <div class="loading-shimmer h-40 rounded-lg mb-4"></div>
          <div class="loading-shimmer h-6 rounded mb-2"></div>
          <div class="loading-shimmer h-4 rounded"></div>
        </div>
        <div class="ad-card p-6">
          <div class="loading-shimmer h-40 rounded-lg mb-4"></div>
          <div class="loading-shimmer h-6 rounded mb-2"></div>
          <div class="loading-shimmer h-4 rounded"></div>
        </div>
        <div class="ad-card p-6">
          <div class="loading-shimmer h-40 rounded-lg mb-4"></div>
          <div class="loading-shimmer h-6 rounded mb-2"></div>
          <div class="loading-shimmer h-4 rounded"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Create/Edit Ad Modal -->
  <div id="ad-modal" class="fixed inset-0 z-50 modal-overlay hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
      <!-- Modal Header -->
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 rounded-t-2xl">
        <div class="flex items-center justify-between">
          <h2 id="modal-title" class="text-2xl font-bold text-gray-900">Create New Home Ad</h2>
          <button id="close-modal" class="text-gray-400 hover:text-gray-600 text-2xl">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <form id="ad-form" class="p-6 space-y-6">
        <!-- Basic Information -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Ad Title *</label>
            <input type="text" id="ad-title" name="title" required
                   placeholder="e.g., Discover Amazing Products"
                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Ad Type *</label>
            <select id="ad-type" name="type" required
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
              <option value="">Select Type</option>
              <option value="default">Default (Gradient)</option>
              <option value="image">Image Background</option>
              <option value="video">Video Background</option>
              <option value="slideshow">Image Slideshow</option>
            </select>
          </div>
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Subtitle</label>
          <input type="text" id="ad-subtitle" name="subtitle"
                 placeholder="Connect with trusted African sellers..."
                 class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
          <textarea id="ad-description" name="description" rows="3"
                    placeholder="Secure payments â€¢ Fast delivery â€¢ 24/7 support"
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
        </div>

        <!-- Media Upload Section -->
        <div id="media-upload-section" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-4">Upload Media</label>
          <div id="upload-area" class="upload-area p-8 text-center cursor-pointer">
            <div id="upload-content">
              <div class="mb-4">
                <i class="fas fa-cloud-upload-alt text-6xl text-gray-400"></i>
              </div>
              <p class="text-xl font-semibold text-gray-700 mb-2">Drop your file here</p>
              <p class="text-gray-500 mb-4">or click to browse</p>
              <p id="file-requirements" class="text-sm text-gray-400">
                Supported: Images (JPG, PNG, GIF) and Videos (MP4, WebM). Max size: 10MB
              </p>
            </div>
            <input type="file" id="media-file" name="content" accept="image/*,video/*" class="hidden">
          </div>
          
          <!-- Media Preview -->
          <div id="media-preview" class="hidden mt-4">
            <div class="preview-container">
              <div id="preview-content"></div>
              <div class="preview-overlay">
                <button type="button" id="remove-media" class="bg-red-500 text-white px-4 py-2 rounded-lg">
                  <i class="fas fa-trash mr-2"></i>Remove
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Statistics Section -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Platform Statistics</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Active Sellers</label>
              <input type="number" id="stats-sellers" name="activeSellers" value="500"
                     class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Products</label>
              <input type="number" id="stats-products" name="products" value="10000"
                     class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Happy Customers</label>
              <input type="number" id="stats-customers" name="happyCustomers" value="50000"
                     class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Countries</label>
              <input type="number" id="stats-countries" name="countries" value="7"
                     class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
          </div>
        </div>

        <!-- Button Configuration -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Primary Button</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Button Text</label>
                <input type="text" id="primary-btn-text" name="buttonText" value="Explore Products"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Button Link</label>
                <input type="text" id="primary-btn-link" name="buttonLink" value="#discover"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Secondary Button</h3>
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Button Text</label>
                <input type="text" id="secondary-btn-text" name="secondaryButtonText" value="Join Free Today"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">Button Link</label>
                <input type="text" id="secondary-btn-link" name="secondaryButtonLink" value="/auth/auth-buyer.html"
                       class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
              </div>
            </div>
          </div>
        </div>

        <!-- Styling Options -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Background Color/Gradient</label>
            <input type="text" id="background-color" name="backgroundColor" 
                   value="linear-gradient(135deg, #0e2038 0%, #23325c 50%, #1e3a8a 100%)"
                   placeholder="CSS background value"
                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Overlay Color</label>
            <input type="text" id="overlay-color" name="overlay" 
                   value="rgba(14, 32, 56, 0.7)"
                   placeholder="CSS color value"
                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          </div>
        </div>

        <!-- Status -->
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-3">
            <input type="checkbox" id="ad-active" name="isActive" checked
                   class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <span class="text-sm font-semibold text-gray-700">Active (visible to users)</span>
          </label>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center gap-4 pt-6 border-t border-gray-200">
          <button type="submit" id="save-ad-btn" 
                  class="bg-indigo-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
            <i class="fas fa-save mr-2"></i>Save Ad
          </button>
          <button type="button" id="preview-ad-btn" 
                  class="bg-gray-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-gray-700 transition-colors">
            <i class="fas fa-eye mr-2"></i>Preview
          </button>
          <button type="button" id="cancel-btn" 
                  class="bg-gray-300 text-gray-700 font-bold px-8 py-3 rounded-lg hover:bg-gray-400 transition-colors">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div id="delete-modal" class="fixed inset-0 z-50 modal-overlay hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
      <div class="p-6 text-center">
        <div class="bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Delete Home Ad</h3>
        <p class="text-gray-600 mb-6">Are you sure you want to delete this ad? This action cannot be undone.</p>
        <div class="flex gap-3 justify-center">
          <button id="confirm-delete" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
            Delete
          </button>
          <button id="cancel-delete" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 z-50 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-white rounded-xl p-8 text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
      <p class="text-gray-700 font-semibold">Processing...</p>
    </div>
  </div>

  <script>
    // ========== HOME ADS MANAGEMENT SYSTEM ==========
    let homeAds = [];
    let currentEditingAd = null;
    let filteredAds = [];

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸš€ Home Background Ads Management - System Initializing...');
      
      initializeEventListeners();
      loadHomeAds();
      loadStatistics();
    });

    // ========== EVENT LISTENERS ==========
    function initializeEventListeners() {
      // Modal controls
      document.getElementById('create-ad-btn').addEventListener('click', () => openCreateModal());
      document.getElementById('close-modal').addEventListener('click', () => closeModal());
      document.getElementById('cancel-btn').addEventListener('click', () => closeModal());
      
      // Form submission
      document.getElementById('ad-form').addEventListener('submit', handleSubmitAd);
      
      // Ad type change
      document.getElementById('ad-type').addEventListener('change', handleAdTypeChange);
      
      // File upload
      setupFileUpload();
      
      // Search and filters
      document.getElementById('search-ads').addEventListener('input', handleSearch);
      document.getElementById('filter-type').addEventListener('change', handleFilter);
      document.getElementById('filter-status').addEventListener('change', handleFilter);
      document.getElementById('refresh-ads').addEventListener('click', () => loadHomeAds());
      
      // Delete modal
      document.getElementById('cancel-delete').addEventListener('click', () => closeDeleteModal());
      
      // Close modal on overlay click
      document.getElementById('ad-modal').addEventListener('click', (e) => {
        if (e.target.id === 'ad-modal') closeModal();
      });
      
      document.getElementById('delete-modal').addEventListener('click', (e) => {
        if (e.target.id === 'delete-modal') closeDeleteModal();
      });
      
      // Stats toggle
      document.getElementById('stats-toggle').addEventListener('click', toggleStatsSection);
    }

    // ========== FILE UPLOAD FUNCTIONALITY ==========
    function setupFileUpload() {
      const uploadArea = document.getElementById('upload-area');
      const fileInput = document.getElementById('media-file');
      const removeBtn = document.getElementById('remove-media');

      // Click to upload
      uploadArea.addEventListener('click', () => fileInput.click());
      
      // Drag and drop
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });
      
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFileSelect(files[0]);
        }
      });
      
      // File input change
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileSelect(e.target.files[0]);
        }
      });
      
      // Remove media
      removeBtn.addEventListener('click', () => {
        clearMediaPreview();
      });
    }

    function handleFileSelect(file) {
      // Validate file
      const maxSize = 10 * 1024 * 1024; // 10MB
      if (file.size > maxSize) {
        showNotification('File too large. Maximum size is 10MB.', 'error');
        return;
      }
      
      const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/webm'];
      if (!allowedTypes.includes(file.type)) {
        showNotification('Invalid file type. Please upload an image or video.', 'error');
        return;
      }
      
      // Show preview
      showMediaPreview(file);
    }

    function showMediaPreview(file) {
      const previewContainer = document.getElementById('media-preview');
      const previewContent = document.getElementById('preview-content');
      const uploadArea = document.getElementById('upload-area');
      
      const reader = new FileReader();
      reader.onload = function(e) {
        let previewHTML = '';
        
        if (file.type.startsWith('image/')) {
          previewHTML = `<img src="${e.target.result}" alt="Preview" class="w-full h-48 object-cover rounded-lg">`;
        } else if (file.type.startsWith('video/')) {
          previewHTML = `
            <video controls class="w-full h-48 object-cover rounded-lg">
              <source src="${e.target.result}" type="${file.type}">
            </video>
          `;
        }
        
        previewContent.innerHTML = previewHTML;
        previewContainer.classList.remove('hidden');
        uploadArea.style.display = 'none';
      };
      
      reader.readAsDataURL(file);
    }

    function clearMediaPreview() {
      const previewContainer = document.getElementById('media-preview');
      const uploadArea = document.getElementById('upload-area');
      const fileInput = document.getElementById('media-file');
      
      previewContainer.classList.add('hidden');
      uploadArea.style.display = 'block';
      fileInput.value = '';
    }

    // ========== MODAL FUNCTIONS ==========
    function openCreateModal() {
      currentEditingAd = null;
      document.getElementById('modal-title').textContent = 'Create New Home Ad';
      document.getElementById('ad-form').reset();
      clearMediaPreview();
      document.getElementById('media-upload-section').classList.add('hidden');
      document.getElementById('ad-modal').classList.remove('hidden');
      document.getElementById('ad-modal').classList.add('flex');
    }

    function openEditModal(ad) {
      currentEditingAd = ad;
      document.getElementById('modal-title').textContent = 'Edit Home Ad';
      
      // Populate form with ad data
      document.getElementById('ad-title').value = ad.title || '';
      document.getElementById('ad-type').value = ad.type || '';
      document.getElementById('ad-subtitle').value = ad.subtitle || '';
      document.getElementById('ad-description').value = ad.description || '';
      document.getElementById('stats-sellers').value = ad.stats?.activeSellers || 500;
      document.getElementById('stats-products').value = ad.stats?.products || 10000;
      document.getElementById('stats-customers').value = ad.stats?.happyCustomers || 50000;
      document.getElementById('stats-countries').value = ad.stats?.countries || 7;
      document.getElementById('primary-btn-text').value = ad.buttonText || 'Explore Products';
      document.getElementById('primary-btn-link').value = ad.buttonLink || '#discover';
      document.getElementById('secondary-btn-text').value = ad.secondaryButtonText || 'Join Free Today';
      document.getElementById('secondary-btn-link').value = ad.secondaryButtonLink || '/auth/auth-buyer.html';
      document.getElementById('background-color').value = ad.backgroundColor || '';
      document.getElementById('overlay-color').value = ad.overlay || '';
      document.getElementById('ad-active').checked = ad.isActive || false;
      
      // Handle media upload section
      handleAdTypeChange();
      
      document.getElementById('ad-modal').classList.remove('hidden');
      document.getElementById('ad-modal').classList.add('flex');
    }

    function closeModal() {
      document.getElementById('ad-modal').classList.add('hidden');
      document.getElementById('ad-modal').classList.remove('flex');
      currentEditingAd = null;
    }

    function closeDeleteModal() {
      document.getElementById('delete-modal').classList.add('hidden');
      document.getElementById('delete-modal').classList.remove('flex');
    }

    // ========== AD TYPE HANDLING ==========
    function handleAdTypeChange() {
      const adType = document.getElementById('ad-type').value;
      const mediaSection = document.getElementById('media-upload-section');
      const fileRequirements = document.getElementById('file-requirements');
      
      if (adType === 'image' || adType === 'video' || adType === 'slideshow') {
        mediaSection.classList.remove('hidden');
        
        // Update file requirements based on type
        if (adType === 'video') {
          fileRequirements.textContent = 'Supported: Videos (MP4, WebM). Max size: 10MB. Muted videos work best for autoplay.';
          document.getElementById('media-file').accept = 'video/*';
        } else {
          fileRequirements.textContent = 'Supported: Images (JPG, PNG, GIF). Max size: 10MB. Recommended: 1920x1080 for best quality.';
          document.getElementById('media-file').accept = 'image/*';
        }
      } else {
        mediaSection.classList.add('hidden');
      }
    }

    // ========== FORM SUBMISSION ==========
    async function handleSubmitAd(e) {
      e.preventDefault();
      
      const formData = new FormData();
      const form = document.getElementById('ad-form');
      
      // Get form data
      const adData = {
        title: document.getElementById('ad-title').value,
        type: document.getElementById('ad-type').value,
        subtitle: document.getElementById('ad-subtitle').value,
        description: document.getElementById('ad-description').value,
        activeSellers: document.getElementById('stats-sellers').value,
        products: document.getElementById('stats-products').value,
        happyCustomers: document.getElementById('stats-customers').value,
        countries: document.getElementById('stats-countries').value,
        buttonText: document.getElementById('primary-btn-text').value,
        buttonLink: document.getElementById('primary-btn-link').value,
        secondaryButtonText: document.getElementById('secondary-btn-text').value,
        secondaryButtonLink: document.getElementById('secondary-btn-link').value,
        backgroundColor: document.getElementById('background-color').value,
        overlay: document.getElementById('overlay-color').value,
        isActive: document.getElementById('ad-active').checked
      };
      
      // Add form data to FormData
      Object.keys(adData).forEach(key => {
        formData.append(key, adData[key]);
      });
      
      // Add file if exists
      const fileInput = document.getElementById('media-file');
      if (fileInput.files.length > 0) {
        formData.append('content', fileInput.files[0]);
      }
      
      try {
        showLoading(true);
        
        let url = '/api/home-ads';
        let method = 'POST';
        
        if (currentEditingAd) {
          url = `/api/home-ads/${currentEditingAd.id}`;
          method = 'PUT';
        }
        
        const response = await fetch(url, {
          method: method,
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          showNotification(
            currentEditingAd ? 'Ad updated successfully!' : 'Ad created successfully!', 
            'success'
          );
          closeModal();
          loadHomeAds();
          loadStatistics();
        } else {
          showNotification(result.error || 'Failed to save ad', 'error');
        }
      } catch (error) {
        console.error('Error saving ad:', error);
        showNotification('Failed to save ad. Please try again.', 'error');
      } finally {
        showLoading(false);
      }
    }

    // ========== DATA LOADING FUNCTIONS ==========
    async function loadHomeAds() {
      try {
        showLoading(true);
        
        const response = await fetch('/api/home-ads');
        const data = await response.json();
        
        if (data.success) {
          homeAds = data.ads || [];
          filteredAds = [...homeAds];
          displayHomeAds();
        } else {
          showNotification('Failed to load home ads', 'error');
        }
      } catch (error) {
        console.error('Error loading home ads:', error);
        showNotification('Failed to load home ads', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function loadStatistics() {
      try {
        const response = await fetch('/api/home-ads/stats');
        const data = await response.json();
        
        if (data.success) {
          displayStatistics(data.stats);
        }
      } catch (error) {
        console.error('Error loading statistics:', error);
      }
    }

    function displayStatistics(stats) {
      document.getElementById('total-ads').textContent = stats.totalAds || 0;
      document.getElementById('active-ads').textContent = stats.activeAds || 0;
      document.getElementById('current-active').textContent = 
        stats.currentActiveId ? `Ad #${stats.currentActiveId}` : 'None';
      
      // Calculate media count (ads with content)
      const mediaCount = homeAds.filter(ad => ad.content).length;
      document.getElementById('media-count').textContent = mediaCount;
    }

    // ========== DISPLAY FUNCTIONS ==========
    function displayHomeAds() {
      const container = document.getElementById('ads-container');
      
      if (filteredAds.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="text-gray-400 text-6xl mb-4">
              <i class="fas fa-ad"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">No ads found</h3>
            <p class="text-gray-500 mb-4">Create your first home background ad to get started</p>
            <button onclick="openCreateModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
              <i class="fas fa-plus mr-2"></i>Create New Ad
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filteredAds.map(ad => createAdCard(ad)).join('');
    }

    function createAdCard(ad) {
      const activeClass = ad.isActive ? 'active' : '';
      const typeClass = `type-${ad.type}`;
      
      // Format creation date
      const createdDate = new Date(ad.createdAt).toLocaleDateString();
      
      // Get preview content
      let previewContent = '';
      if (ad.contentUrl && ad.type === 'image') {
        previewContent = `<img src="${ad.contentUrl}" alt="${ad.title}" class="w-full h-32 object-cover rounded-lg mb-3">`;
      } else if (ad.contentUrl && ad.type === 'video') {
        previewContent = `
          <video class="w-full h-32 object-cover rounded-lg mb-3" muted>
            <source src="${ad.contentUrl}" type="video/mp4">
          </video>
        `;
      } else {
        previewContent = `
          <div class="w-full h-32 rounded-lg mb-3 flex items-center justify-center" 
               style="background: ${ad.backgroundColor || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'}">
            <span class="text-white text-2xl font-bold">${ad.title?.charAt(0) || 'A'}</span>
          </div>
        `;
      }
      
      return `
        <div class="ad-card ${activeClass} p-6">
          ${previewContent}
          
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-bold text-lg text-gray-900 truncate">${ad.title}</h3>
            <span class="type-badge ${typeClass}">${ad.type}</span>
          </div>
          
          <p class="text-gray-600 text-sm mb-3 line-clamp-2">${ad.subtitle || 'No subtitle'}</p>
          
          <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
            <span>Created: ${createdDate}</span>
            <span class="flex items-center gap-1">
              <i class="fas fa-${ad.isActive ? 'eye text-green-500' : 'eye-slash text-gray-400'}"></i>
              ${ad.isActive ? 'Active' : 'Inactive'}
            </span>
          </div>
          
          <div class="flex items-center gap-2">
            <button onclick="openEditModal(${JSON.stringify(ad).replace(/"/g, '&quot;')})" 
                    class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
              <i class="fas fa-edit mr-1"></i>Edit
            </button>
            <button onclick="activateAd(${ad.id})" 
                    class="flex-1 bg-green-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors ${ad.isActive ? '' : 'opacity-50'}">
              <i class="fas fa-star mr-1"></i>Activate
            </button>
            <button onclick="deleteAd(${ad.id})" 
                    class="bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
    }

    // ========== AD ACTIONS ==========
    async function activateAd(adId) {
      try {
        showLoading(true);
        
        const response = await fetch(`/api/home-ads/${adId}/activate`, {
          method: 'PUT'
        });
        
        const result = await response.json();
        
        if (result.success) {
          showNotification('Ad activated successfully!', 'success');
          loadHomeAds();
          loadStatistics();
        } else {
          showNotification(result.error || 'Failed to activate ad', 'error');
        }
      } catch (error) {
        console.error('Error activating ad:', error);
        showNotification('Failed to activate ad', 'error');
      } finally {
        showLoading(false);
      }
    }

    function deleteAd(adId) {
      const ad = homeAds.find(a => a.id === adId);
      if (!ad) return;
      
      // Show confirmation modal
      document.getElementById('delete-modal').classList.remove('hidden');
      document.getElementById('delete-modal').classList.add('flex');
      
      // Set up confirm delete handler
      document.getElementById('confirm-delete').onclick = () => confirmDeleteAd(adId);
    }

    async function confirmDeleteAd(adId) {
      try {
        showLoading(true);
        
        const response = await fetch(`/api/home-ads/${adId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          showNotification('Ad deleted successfully!', 'success');
          closeDeleteModal();
          loadHomeAds();
          loadStatistics();
        } else {
          showNotification(result.error || 'Failed to delete ad', 'error');
        }
      } catch (error) {
        console.error('Error deleting ad:', error);
        showNotification('Failed to delete ad', 'error');
      } finally {
        showLoading(false);
      }
    }

    // ========== SEARCH & FILTER FUNCTIONS ==========
    function handleSearch() {
      applyFilters();
    }

    function handleFilter() {
      applyFilters();
    }

    function applyFilters() {
      const searchTerm = document.getElementById('search-ads').value.toLowerCase();
      const typeFilter = document.getElementById('filter-type').value;
      const statusFilter = document.getElementById('filter-status').value;
      
      filteredAds = homeAds.filter(ad => {
        // Search filter
        const matchesSearch = !searchTerm || 
          ad.title?.toLowerCase().includes(searchTerm) ||
          ad.subtitle?.toLowerCase().includes(searchTerm) ||
          ad.description?.toLowerCase().includes(searchTerm);
        
        // Type filter
        const matchesType = !typeFilter || ad.type === typeFilter;
        
        // Status filter
        const matchesStatus = !statusFilter || 
          (statusFilter === 'active' && ad.isActive) ||
          (statusFilter === 'inactive' && !ad.isActive);
        
        return matchesSearch && matchesType && matchesStatus;
      });
      
      displayHomeAds();
    }

    // ========== UTILITY FUNCTIONS ==========
    function toggleStatsSection() {
      const statsSection = document.getElementById('stats-section');
      const isHidden = statsSection.style.display === 'none';
      statsSection.style.display = isHidden ? 'grid' : 'none';
      
      const button = document.getElementById('stats-toggle');
      button.innerHTML = isHidden ? 
        '<i class="fas fa-chart-line mr-2"></i>Hide Statistics' :
        '<i class="fas fa-chart-line mr-2"></i>Show Statistics';
    }

    function showLoading(show) {
      const overlay = document.getElementById('loading-overlay');
      if (show) {
        overlay.classList.remove('hidden');
        overlay.classList.add('flex');
      } else {
        overlay.classList.add('hidden');
        overlay.classList.remove('flex');
      }
    }

    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `
        fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg text-white
        ${type === 'success' ? 'bg-green-600' : 
          type === 'error' ? 'bg-red-600' : 
          type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600'}
        transform translate-x-full transition-transform duration-300
      `;
      
      notification.innerHTML = `
        <div class="flex items-center gap-3">
          <i class="fas fa-${type === 'success' ? 'check-circle' : 
                            type === 'error' ? 'exclamation-circle' : 
                            type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-4 hover:opacity-75">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentElement) {
              notification.remove();
            }
          }, 300);
        }
      }, 5000);
    }

    // ========== INITIALIZATION ==========
    console.log('âœ… Home Ads Management - All Functions Loaded');
  </script>
</body>
</html>