<!DOCTYPE html>
<html lang="en" class="admin-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Management | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="admin-auth-check.js"></script>
    <script src="admin-utils.js"></script>
    <style>
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid #3b82f6;
        }
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            backdrop-filter: blur(10px);
        }
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        .form-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #3b82f6;
            outline: none;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .stat-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="flex h-screen">
    
        
        <!-- Sidebar -->
        <div class="sidebar w-64 p-6">
            <div class="text-white text-2xl font-bold mb-8">
                <i class="fas fa-shield-alt mr-2"></i>Admin Panel
            </div>
            
            <nav class="space-y-2">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="orders.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="reports.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>
            
            <nav class="space-y-2">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="orders.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="reports.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>
    
    <!-- Main Content -->
    <div class="flex-1 p-8 overflow-auto">
        
  <!-- Header -->
  <header class="glass-morphism border-b border-white/20">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="dashboard.html" class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
            <i class="fas fa-arrow-left text-white text-xl"></i>
          </a>
          <div>
            <h1 class="text-2xl font-bold text-white">Shipping Management</h1>
            <p class="text-white/70 text-sm">Manage shipping rates, packaging fees, and delivery zones</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <button id="add-zone-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition" onclick="showNotification('Feature in development', 'info')">
            i class="fas fa-plus mr-2"></i>Add Zone
          </button>
          <button id="add-package-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition" onclick="showNotification('Feature in development', 'info')">
            i class="fas fa-box mr-2"></i>Add Package
          </button>
          <button id="calculate-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition" onclick="showNotification('Feature in development', 'info')">
            i class="fas fa-calculator mr-2"></i>Calculate Rates
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-8">
    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="glass-morphism rounded-xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/70 text-sm">Active Zones</p>
            <p class="text-white text-2xl font-bold" id="active-zones">0</p>
          </div>
          <div class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center">
            <i class="fas fa-globe text-blue-400 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="glass-morphism rounded-xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/70 text-sm">Package Types</p>
            <p class="text-white text-2xl font-bold" id="package-types">0</p>
          </div>
          <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center">
            <i class="fas fa-box text-green-400 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="glass-morphism rounded-xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/70 text-sm">Avg Shipping Cost</p>
            <p class="text-white text-2xl font-bold" id="avg-shipping">$0</p>
          </div>
          <div class="w-12 h-12 bg-yellow-500/20 rounded-full flex items-center justify-center">
            <i class="fas fa-dollar-sign text-yellow-400 text-xl"></i>
          </div>
        </div>
      </div>
      
      <div class="glass-morphism rounded-xl p-6">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-white/70 text-sm">Fragile Items</p>
            <p class="text-white text-2xl font-bold" id="fragile-items">0</p>
          </div>
          <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-red-400 text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="glass-morphism rounded-xl p-6 mb-8">
      <div class="flex space-x-4 border-b border-white/20">
        <button class="tab-btn active px-4 py-2 text-white border-b-2 border-blue-400" data-tab="zones" onclick="showNotification('Feature in development', 'info')">
          i class="fas fa-globe mr-2"></i>Delivery Zones
        </button>
        <button class="tab-btn px-4 py-2 text-white/70 hover:text-white" data-tab="packages" onclick="showNotification('Feature in development', 'info')">
          i class="fas fa-box mr-2"></i>Package Types
        </button>
        <button class="tab-btn px-4 py-2 text-white/70 hover:text-white" data-tab="rates" onclick="showNotification('Feature in development', 'info')">
          i class="fas fa-calculator mr-2"></i>Shipping Rates
        </button>
        <button class="tab-btn px-4 py-2 text-white/70 hover:text-white" data-tab="calculator" onclick="showNotification('Feature in development', 'info')">
          i class="fas fa-tools mr-2"></i>Rate Calculator
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div id="tab-content">
      <!-- Delivery Zones Tab -->
      <div id="zones-tab" class="tab-content active">
        <div class="glass-morphism rounded-xl overflow-hidden">
          <div class="p-6 border-b border-white/20">
            <h3 class="text-xl font-bold text-white">Delivery Zones</h3>
            <p class="text-white/70 text-sm">Manage shipping zones and their rates</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-white/10">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Zone Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Countries</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Base Rate</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Delivery Time</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Status</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="zones-table-body" class="divide-y divide-white/10">
                <!-- Zones will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Package Types Tab -->
      <div id="packages-tab" class="tab-content hidden">
        <div class="glass-morphism rounded-xl overflow-hidden">
          <div class="p-6 border-b border-white/20">
            <h3 class="text-xl font-bold text-white">Package Types</h3>
            <p class="text-white/70 text-sm">Manage packaging options and fees</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-white/10">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Package Name</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Base Fee</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Fragile Fee</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Insurance</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Max Weight</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="packages-table-body" class="divide-y divide-white/10">
                <!-- Packages will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Shipping Rates Tab -->
      <div id="rates-tab" class="tab-content hidden">
        <div class="glass-morphism rounded-xl overflow-hidden">
          <div class="p-6 border-b border-white/20">
            <h3 class="text-xl font-bold text-white">Shipping Rates</h3>
            <p class="text-white/70 text-sm">View and manage shipping rate calculations</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-white/10">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Zone</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Weight Range</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Base Rate</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Additional Rate</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Delivery Time</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="rates-table-body" class="divide-y divide-white/10">
                <!-- Rates will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Rate Calculator Tab -->
      <div id="calculator-tab" class="tab-content hidden">
        <div class="glass-morphism rounded-xl p-6">
          <h3 class="text-xl font-bold text-white mb-6">Shipping Rate Calculator</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-white/70 text-sm mb-2">Origin Zone</label>
              <select id="origin-zone" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white">
                <option value="">Select Origin Zone</option>
              </select>
            </div>
            
            <div>
              <label class="block text-white/70 text-sm mb-2">Destination Zone</label>
              <select id="destination-zone" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white">
                <option value="">Select Destination Zone</option>
              </select>
            </div>
            
            <div>
              <label class="block text-white/70 text-sm mb-2">Weight (kg)</label>
              <input type="number" id="weight-input" step="0.01" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white" placeholder="Enter weight">
            </div>
            
            <div>
              <label class="block text-white/70 text-sm mb-2">Package Type</label>
              <select id="package-type" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white">
                <option value="">Select Package Type</option>
              </select>
            </div>
            
            <div>
              <label class="block text-white/70 text-sm mb-2">Is Fragile?</label>
              <select id="fragile-item" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
            
            <div>
              <label class="block text-white/70 text-sm mb-2">Urgent Delivery?</label>
              <select id="urgent-delivery" class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white">
                <option value="false">Standard</option>
                <option value="true">Urgent</option>
              </select>
            </div>
          </div>
          
          <div class="mt-6">
            <button id="calculate-rate-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition" onclick="showNotification('Feature in development', 'info')">
              i class="fas fa-calculator mr-2"></i>Calculate Rate
            </button>
          </div>
          
          <div id="calculation-result" class="mt-6 hidden">
            <div class="bg-white/10 rounded-lg p-6">
              <h4 class="text-lg font-bold text-white mb-4">Calculation Result</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-white/70 text-sm">Base Shipping Rate</p>
                  <p class="text-white text-xl font-bold" id="base-rate">$0.00</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Package Fee</p>
                  <p class="text-white text-xl font-bold" id="package-fee">$0.00</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Fragile Item Fee</p>
                  <p class="text-white text-xl font-bold" id="fragile-fee">$0.00</p>
                </div>
                <div>
                  <p class="text-white/70 text-sm">Urgent Delivery Fee</p>
                  <p class="text-white text-xl font-bold" id="urgent-fee">$0.00</p>
                </div>
                <div class="md:col-span-2">
                  <p class="text-white/70 text-sm">Total Shipping Cost</p>
                  <p class="text-white text-2xl font-bold" id="total-shipping">$0.00</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Zone Modal -->
  <div id="zone-modal" class="fixed inset-0 bg-black/50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl max-w-2xl w-full">
        <div class="p-6 border-b">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold text-gray-900">Add Delivery Zone</h3>
            <button id="close-zone-modal" class="text-gray-400 hover:text-gray-600" onclick="showNotification('Feature in development', 'info')">
              i class="fas fa-times text-xl"></i>
            </button>
          </div>
        </div>
        <div class="p-6">
          <form id="zone-form" method="POST" action="#">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Zone Name</label>
                <input type="text" id="zone-name" class="w-full border rounded-lg px-3 py-2" required pattern="[A-Za-z\s]{2,50}" title="Name must be 2-50 characters, letters and spaces only">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Base Rate ($)</label>
                <input type="number" id="base-rate-input" step="0.01" class="w-full border rounded-lg px-3 py-2" required pattern=".{1,}" title="This field is required">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Delivery Time (days)</label>
                <input type="number" id="delivery-time" class="w-full border rounded-lg px-3 py-2" required pattern=".{1,}" title="This field is required">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Urgent Multiplier</label>
                <input type="number" id="urgent-multiplier" step="0.1" class="w-full border rounded-lg px-3 py-2" value="1.5">
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Countries (JSON)</label>
                <textarea id="countries-input" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder='["Rwanda", "Kenya"]'></textarea>
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Cities (JSON)</label>
                <textarea id="cities-input" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder='["Kigali", "Nairobi"]'></textarea>
              </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
              <button type="button" id="cancel-zone" class="px-4 py-2 text-gray-600 hover:text-gray-800" onclick="handleCancel()">Cancel/button>
              <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Save Zone</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Package Modal -->
  <div id="package-modal" class="fixed inset-0 bg-black/50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl max-w-2xl w-full">
        <div class="p-6 border-b">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold text-gray-900">Add Package Type</h3>
            <button id="close-package-modal" class="text-gray-400 hover:text-gray-600" onclick="showNotification('Feature in development', 'info')">
              i class="fas fa-times text-xl"></i>
            </button>
          </div>
        </div>
        <div class="p-6">
          <form id="package-form" method="POST" action="#">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Package Name</label>
                <input type="text" id="package-name" class="w-full border rounded-lg px-3 py-2" required pattern="[A-Za-z\s]{2,50}" title="Name must be 2-50 characters, letters and spaces only">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Base Fee ($)</label>
                <input type="number" id="base-fee-input" step="0.01" class="w-full border rounded-lg px-3 py-2" required pattern=".{1,}" title="This field is required">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Fragile Fee ($)</label>
                <input type="number" id="fragile-fee-input" step="0.01" class="w-full border rounded-lg px-3 py-2" value="0">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Insurance Fee ($)</label>
                <input type="number" id="insurance-fee-input" step="0.01" class="w-full border rounded-lg px-3 py-2" value="0">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Max Weight (kg)</label>
                <input type="number" id="max-weight" step="0.01" class="w-full border rounded-lg px-3 py-2">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Max Dimensions</label>
                <input type="text" id="max-dimensions" class="w-full border rounded-lg px-3 py-2" placeholder="50x30x30">
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                <textarea id="package-description" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
              </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
              <button type="button" id="cancel-package" class="px-4 py-2 text-gray-600 hover:text-gray-800" onclick="handleCancel()">Cancel/button>
              <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save Package</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentZones = [];
    let currentPackages = [];
    let currentRates = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      loadShippingStatistics();
      loadZones();
      loadPackages();
      loadRates();
      setupEventListeners();
    });

    // Setup event listeners
    function setupEventListeners() {
      // Tab switching
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          switchTab(tabName);
        });
      });

      // Modal buttons
      document.getElementById('add-zone-btn').addEventListener('click', () => {
        document.getElementById('zone-modal').classList.remove('hidden');
      });

      document.getElementById('add-package-btn').addEventListener('click', () => {
        document.getElementById('package-modal').classList.remove('hidden');
      });

      document.getElementById('calculate-btn').addEventListener('click', () => {
        switchTab('calculator');
      });

      // Modal close buttons
      document.getElementById('close-zone-modal').addEventListener('click', () => {
        document.getElementById('zone-modal').classList.add('hidden');
      });

      document.getElementById('close-package-modal').addEventListener('click', () => {
        document.getElementById('package-modal').classList.add('hidden');
      });

      // Cancel buttons
      document.getElementById('cancel-zone').addEventListener('click', () => {
        document.getElementById('zone-modal').classList.add('hidden');
      });

      document.getElementById('cancel-package').addEventListener('click', () => {
        document.getElementById('package-modal').classList.add('hidden');
      });

      // Form submissions
      document.getElementById('zone-form').addEventListener('submit', handleZoneSubmit);
      document.getElementById('package-form').addEventListener('submit', handlePackageSubmit);
      document.getElementById('calculate-rate-btn').addEventListener('click', calculateShippingRate);
    }

    // Switch tabs
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active', 'border-blue-400');
        btn.classList.add('text-white/70');
      });
      
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-blue-400', 'text-white');
      document.querySelector(`[data-tab="${tabName}"]`).classList.remove('text-white/70');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      document.getElementById(`${tabName}-tab`).classList.remove('hidden');
    }

    // Load shipping statistics
    async function loadShippingStatistics() {
      try {
        const token = localStorage.getItem('authToken');
        const response = await 
                try {
                    const response = await fetch('${API_BASE_URL}/admin/shipping/stats', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    // Continue with successful response
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API call failed:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
                    showNotification('Operation failed. Please try again.', 'error');
                    throw error;
                };
        
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('active-zones').textContent = data.stats.active_zones || 0;
          document.getElementById('package-types').textContent = data.stats.package_types || 0;
          document.getElementById('avg-shipping').textContent = `${data.stats.avg_shipping || 0}`;
          document.getElementById('fragile-items').textContent = data.stats.fragile_items || 0;
        }
      } catch (error) {
        console.error('Error loading shipping statistics:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
      }
    }

    // Load zones
    async function loadZones() {
      try {
        const token = localStorage.getItem('authToken');
        const response = await 
                try {
                    const response = await fetch('${API_BASE_URL}/admin/shipping/zones', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    // Continue with successful response
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API call failed:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
                    showNotification('Operation failed. Please try again.', 'error');
                    throw error;
                };
        
        const data = await response.json();
        
        if (data.success) {
          currentZones = data.zones;
          renderZonesTable();
          populateZoneSelects();
        }
      } catch (error) {
        console.error('Error loading zones:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
      }
    }

    // Load packages
    async function loadPackages() {
      try {
        const token = localStorage.getItem('authToken');
        const response = await 
                try {
                    const response = await fetch('${API_BASE_URL}/admin/shipping/packages', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    // Continue with successful response
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API call failed:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
                    showNotification('Operation failed. Please try again.', 'error');
                    throw error;
                };
        
        const data = await response.json();
        
        if (data.success) {
          currentPackages = data.packages;
          renderPackagesTable();
          populatePackageSelects();
        }
      } catch (error) {
        console.error('Error loading packages:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
      }
    }

    // Load rates
    async function loadRates() {
      try {
        const token = localStorage.getItem('authToken');
        const response = await 
                try {
                    const response = await fetch('${API_BASE_URL}/admin/shipping/rates', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    // Continue with successful response
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API call failed:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
                    showNotification('Operation failed. Please try again.', 'error');
                    throw error;
                };
        
        const data = await response.json();
        
        if (data.success) {
          currentRates = data.rates;
          renderRatesTable();
        }
      } catch (error) {
        console.error('Error loading rates:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
      }
    }

    // Render zones table
    function renderZonesTable() {
      const tbody = document.getElementById('zones-table-body');
      tbody.innerHTML = '';

      currentZones.forEach(zone => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-white/5 transition';
        
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${zone.name}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${zone.countries ? JSON.parse(zone.countries).join(', ') : 'N/A'}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${zone.base_rate}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${zone.delivery_time_days} days</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 py-1 text-xs font-medium rounded-full ${zone.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
              ${zone.is_active ? 'Active' : 'Inactive'}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="editZone(${zone.id})" class="text-blue-400 hover:text-blue-300 mr-2">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="toggleZoneStatus(${zone.id})" class="text-green-400 hover:text-green-300 mr-2">
              <i class="fas fa-toggle-on"></i>
            </button>
            <button onclick="deleteZone(${zone.id})" class="text-red-400 hover:text-red-300">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // Render packages table
    function renderPackagesTable() {
      const tbody = document.getElementById('packages-table-body');
      tbody.innerHTML = '';

      currentPackages.forEach(package => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-white/5 transition';
        
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${package.name}</div>
            <div class="text-sm text-white/70">${package.description || ''}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${package.base_fee}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${package.fragile_fee}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${package.insurance_fee}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${package.max_weight || 'N/A'} kg</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="editPackage(${package.id})" class="text-blue-400 hover:text-blue-300 mr-2">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="togglePackageStatus(${package.id})" class="text-green-400 hover:text-green-300 mr-2">
              <i class="fas fa-toggle-on"></i>
            </button>
            <button onclick="deletePackage(${package.id})" class="text-red-400 hover:text-red-300">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // Render rates table
    function renderRatesTable() {
      const tbody = document.getElementById('rates-table-body');
      tbody.innerHTML = '';

      currentRates.forEach(rate => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-white/5 transition';
        
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${rate.zone}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${rate.min_weight} - ${rate.max_weight || '∞'} kg</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-white">${rate.base_rate}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${rate.additional_rate}/kg</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white/70">${rate.delivery_time} days</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button onclick="editRate(${rate.id})" class="text-blue-400 hover:text-blue-300 mr-2">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="deleteRate(${rate.id})" class="text-red-400 hover:text-red-300">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // Populate zone selects
    function populateZoneSelects() {
      const originSelect = document.getElementById('origin-zone');
      const destinationSelect = document.getElementById('destination-zone');
      
      if (originSelect && destinationSelect) {
        const options = '<option value="">Select Zone</option>' +
          currentZones.filter(zone => zone.is_active).map(zone => 
            `<option value="${zone.id}">${zone.name}</option>`
          ).join('');
        
        originSelect.innerHTML = options;
        destinationSelect.innerHTML = options;
      }
    }

    // Populate package selects
    function populatePackageSelects() {
      const packageSelect = document.getElementById('package-type');
      
      if (packageSelect) {
        packageSelect.innerHTML = '<option value="">Select Package Type</option>' +
          currentPackages.filter(pkg => pkg.is_active).map(pkg => 
            `<option value="${pkg.id}">${pkg.name} - ${pkg.base_fee}</option>`
          ).join('');
      }
    }

    // Handle zone form submission
    async function handleZoneSubmit(e) {
      e.preventDefault();
      
      const formData = {
        name: document.getElementById('zone-name').value,
        base_rate: parseFloat(document.getElementById('base-rate-input').value),
        delivery_time_days: parseInt(document.getElementById('delivery-time').value),
        urgent_delivery_multiplier: parseFloat(document.getElementById('urgent-multiplier').value),
        countries: JSON.parse(document.getElementById('countries-input').value || '[]'),
        cities: JSON.parse(document.getElementById('cities-input').value || '[]')
      };

      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('${API_BASE_URL}/admin/shipping/zones', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Zone created successfully', 'success');
          document.getElementById('zone-modal').classList.add('hidden');
          document.getElementById('zone-form').reset();
          loadZones();
          loadShippingStatistics();
        } else {
          showNotification(data.message || 'Error creating zone', 'error');
        }
      } catch (error) {
        console.error('Error creating zone:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Error creating zone', 'error');
      }
    }

    // Handle package form submission
    async function handlePackageSubmit(e) {
      e.preventDefault();
      
      const formData = {
        name: document.getElementById('package-name').value,
        description: document.getElementById('package-description').value,
        base_fee: parseFloat(document.getElementById('base-fee-input').value),
        fragile_fee: parseFloat(document.getElementById('fragile-fee-input').value),
        insurance_fee: parseFloat(document.getElementById('insurance-fee-input').value),
        max_weight: parseFloat(document.getElementById('max-weight').value) || null,
        max_dimensions: document.getElementById('max-dimensions').value
      };

      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('${API_BASE_URL}/admin/shipping/packages', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Package created successfully', 'success');
          document.getElementById('package-modal').classList.add('hidden');
          document.getElementById('package-form').reset();
          loadPackages();
          loadShippingStatistics();
        } else {
          showNotification(data.message || 'Error creating package', 'error');
        }
      } catch (error) {
        console.error('Error creating package:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Error creating package', 'error');
      }
    }

    // Calculate shipping rate
    async function calculateShippingRate() {
      const originZone = document.getElementById('origin-zone').value;
      const destinationZone = document.getElementById('destination-zone').value;
      const weight = parseFloat(document.getElementById('weight-input').value);
      const packageType = document.getElementById('package-type').value;
      const isFragile = document.getElementById('fragile-item').value === 'true';
      const isUrgent = document.getElementById('urgent-delivery').value === 'true';

      if (!originZone || !destinationZone || !weight || !packageType) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }

      try {
        const token = localStorage.getItem('authToken');
        const response = await fetch('${API_BASE_URL}/admin/shipping/calculate', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            origin_zone: originZone,
            destination_zone: destinationZone,
            weight,
            package_type: packageType,
            is_fragile: isFragile,
            is_urgent: isUrgent
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('base-rate').textContent = `${data.calculation.base_rate}`;
          document.getElementById('package-fee').textContent = `${data.calculation.package_fee}`;
          document.getElementById('fragile-fee').textContent = `${data.calculation.fragile_fee}`;
          document.getElementById('urgent-fee').textContent = `${data.calculation.urgent_fee}`;
          document.getElementById('total-shipping').textContent = `${data.calculation.total_cost}`;
          document.getElementById('calculation-result').classList.remove('hidden');
        } else {
          showNotification(data.message || 'Error calculating rate', 'error');
        }
      } catch (error) {
        console.error('Error calculating rate:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Error calculating rate', 'error');
      }
    }

    // Utility functions
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      let bgColor = 'bg-blue-500';
      let icon = 'ℹ️';
      
      if (type === 'success') {
        bgColor = 'bg-green-500';
        icon = '✅';
      } else if (type === 'error') {
        bgColor = 'bg-red-500';
        icon = '❌';
      } else if (type === 'warning') {
        bgColor = 'bg-yellow-500';
        icon = '⚠️';
      }
      
      notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white ${bgColor} shadow-lg flex items-center gap-2`;
      notification.innerHTML = `<span>${icon}</span><span>${message}</span>`;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Placeholder functions for edit/delete operations
    function editZone(id) {
      showNotification('Edit zone functionality Feature available', 'info');
    }

    function toggleZoneStatus(id) {
      showNotification('Toggle zone status functionality Feature available', 'info');
    }

    function deleteZone(id) {
      if (confirm('Are you sure you want to delete this zone?')) {
        showNotification('Delete zone functionality Feature available', 'info');
      }
    }

    function editPackage(id) {
      showNotification('Edit package functionality Feature available', 'info');
    }

    function togglePackageStatus(id) {
      showNotification('Toggle package status functionality Feature available', 'info');
    }

    function deletePackage(id) {
      if (confirm('Are you sure you want to delete this package?')) {
        showNotification('Delete package functionality Feature available', 'info');
      }
    }

    function editRate(id) {
      showNotification('Edit rate functionality Feature available', 'info');
    }

    function deleteRate(id) {
      if (confirm('Are you sure you want to delete this rate?')) {
        showNotification('Delete rate functionality Feature available', 'info');
      }
    }
  
    // Error handling utilities
    function showError(message) {
        console.error('Error:', message);
        if (window.adminAuth && window.adminAuth.showNotification) {
            window.adminAuth.showNotification(message, 'error');
        } else {
            alert('Error: ' + message);
        }
    }

    function showSuccess(message) {
        console.log('Success:', message);
        if (window.adminAuth && window.adminAuth.showNotification) {
            window.adminAuth.showNotification(message, 'success');
        }
    }

    function showLoading(elementId, message = 'Loading...') {
        const element = document.getElementById(elementId);
        if (element) {
            element.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-white/70">${message}</p>
                </div>
            `;
        }
    }
</script>

    </div>
</div>

<script>
// Unified Admin API Integration for shipping-management.html
class AdminAPI {
    constructor() {
        this.baseUrl = '/api/admin';
        this.token = localStorage.getItem('adminToken');
    }
    
    async request(endpoint, options = {}) {
        const url = this.baseUrl + endpoint;
        const config = {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + this.token,
                ...options.headers
            },
            ...options
        };
        
        try {
            showLoading(true);
            const response = await fetch(url, config);
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            showLoading(false);
            return data;
        } catch (error) {
            showLoading(false);
            showError('API Error: ' + error.message);
            throw error;
        }
    }
    
    // Page-specific methods
    
    async getData() {
        return await this.request('/data');
    }
}

// Initialize API
const adminAPI = new AdminAPI();

// Load data when page loads
document.addEventListener('DOMContentLoaded', async function() {
    try {
        await loadPageData();
    } catch (error) {
        console.error('Failed to load page data:', error);
        showError('Failed to load data. Please refresh the page.');
    }
});

async function loadPageData() {
    // Implement page-specific data loading
    console.log('Loading data for shipping-management.html...');
    
    
    // Generic data loading
    console.log('Loading data for shipping-management.html...');
}

function refreshData() {
    loadPageData();
}
</script>
</body>
</html>