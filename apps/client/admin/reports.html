<!DOCTYPE html>
<html lang="en" class="admin-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="admin-auth-check.js"></script>
    <script src="admin-utils.js"></script>
    <style>
        :root {
            --primary-color: #080b3b;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        .sidebar {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid #3b82f6;
        }
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        .report-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .report-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .chart-container {
            position: relative;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
        }
        .status-badge {
            @apply px-3 py-1 rounded-full text-xs font-medium;
        }
        .status-generated { @apply bg-green-500/20 text-green-400; }
        .status-processing { @apply bg-yellow-500/20 text-yellow-400; }
        .status-failed { @apply bg-red-500/20 text-red-400; }
        .status-scheduled { @apply bg-blue-500/20 text-blue-400; }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .tab-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-color);
        }
        .live-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            display: inline-block;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .real-time-badge {
            background: linear-gradient(45deg, #22c55e, #16a34a);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-weight: 600;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
        }
        .trend-up {
            color: #22c55e;
        }
        .trend-down {
            color: #ef4444;
        }
        .trend-neutral {
            color: #6b7280;
        }
        .filter-chip {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #93c5fd;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-chip:hover {
            background: rgba(59, 130, 246, 0.3);
        }
        .filter-chip.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        .export-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .export-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        .date-picker {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
        }
        .report-preview {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }
        .data-table {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
        }
        .data-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            text-align: left;
            color: white;
            font-weight: 600;
        }
        .data-table td {
            padding: 1rem;
            color: rgba(255, 255, 255, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .scheduler-grid {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .schedule-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .schedule-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }
    </style>
</head>

<body class="gradient-bg min-h-screen">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar w-64 lg:w-80 flex-shrink-0 hidden md:flex flex-col">
            <div class="p-6 border-b border-white/10">
                <h2 class="text-xl font-bold text-white">Admin Panel</h2>
            </div>
            
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="payment-credentials.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-wallet"></i>
                    <span>Payment Credentials</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="order-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="categories.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tags"></i>
                    <span>Categories</span>
                </a>
                <a href="brands.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-trademark"></i>
                    <span>Brands</span>
                </a>
                <a href="reviews.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-star"></i>
                    <span>Reviews</span>
                </a>
                <a href="sellers.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-store"></i>
                    <span>Sellers</span>
                </a>
                <a href="support-tickets.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Support Tickets</span>
                </a>
                <a href="logs.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-file-alt"></i>
                    <span>System Logs</span>
                </a>
                <a href="promotions.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tags"></i>
                    <span>Promotions</span>
                </a>
                <a href="cms-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-edit"></i>
                    <span>CMS Management</span>
                </a>
                <a href="notification-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="backup-restore.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-database"></i>
                    <span>Backup & Restore</span>
                </a>
                <a href="security-api.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shield-alt"></i>
                    <span>Security & API</span>
                </a>
                <a href="performance-analytics.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-line"></i>
                    <span>Performance & Analytics</span>
                </a>
                <a href="system-integrations.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-plug"></i>
                    <span>System Integrations</span>
                </a>
                <a href="file-manager.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-folder-open"></i>
                    <span>File Manager</span>
                </a>
                <a href="email-templates.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-envelope-open-text"></i>
                    <span>Email Templates</span>
                </a>
                <a href="tax-currency-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-coins"></i>
                    <span>Tax & Currency</span>
                </a>
                <a href="shipping-delivery.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-truck"></i>
                    <span>Shipping & Delivery</span>
                </a>
                <a href="import-export.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Import/Export</span>
                </a>
                <a href="reports.html" class="nav-item active flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-4 sm:p-6 lg:p-8 overflow-auto">
            
            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2 flex items-center">
                        Reports & Analytics
                        <span class="live-indicator ml-3"></span>
                        <span class="real-time-badge ml-2">Live Data</span>
                    </h1>
                    <p class="text-white/70">Comprehensive business intelligence and reporting dashboard</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                    <button onclick="generateCustomReport()" class="bg-green-500 hover:bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-plus mr-2"></i>Custom Report
                    </button>
                    <button onclick="scheduleReport()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-calendar mr-2"></i>Schedule
                    </button>
                    <button onclick="exportAllReports()" class="bg-purple-500 hover:bg-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-download mr-2"></i>Export All
                    </button>
                </div>
            </div>

            <!-- Date Range Filter -->
            <div class="glass-morphism rounded-xl p-4 mb-6">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-white/70 text-sm">Date Range:</label>
                        <input type="date" id="start-date" class="date-picker">
                        <span class="text-white/50">to</span>
                        <input type="date" id="end-date" class="date-picker">
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="setDateRange('today')" class="filter-chip">Today</button>
                        <button onclick="setDateRange('week')" class="filter-chip active">This Week</button>
                        <button onclick="setDateRange('month')" class="filter-chip">This Month</button>
                        <button onclick="setDateRange('quarter')" class="filter-chip">Quarter</button>
                        <button onclick="setDateRange('year')" class="filter-chip">Year</button>
                    </div>
                    
                    <button onclick="applyDateFilter()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-filter mr-2"></i>Apply Filter
                    </button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="flex flex-wrap gap-2 mb-6">
                <div class="tab-btn active" data-tab="overview" onclick="switchTab('overview')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-chart-pie"></i>
                        <span class="text-white font-medium">Overview</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="sales" onclick="switchTab('sales')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-dollar-sign"></i>
                        <span class="text-white font-medium">Sales Reports</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="customers" onclick="switchTab('customers')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-users"></i>
                        <span class="text-white font-medium">Customer Analytics</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="inventory" onclick="switchTab('inventory')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-boxes"></i>
                        <span class="text-white font-medium">Inventory Reports</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="financial" onclick="switchTab('financial')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-chart-line"></i>
                        <span class="text-white font-medium">Financial</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="scheduled" onclick="switchTab('scheduled')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-calendar-alt"></i>
                        <span class="text-white font-medium">Scheduled</span>
                    </div>
                </div>
            </div>

            <!-- Tab Contents -->
            
            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <!-- Key Performance Indicators -->
                <div class="mb-8">
                    <h2 class="text-xl font-bold text-white mb-4">Key Performance Indicators</h2>
                    <div class="kpi-grid" id="kpi-container">
                        <!-- KPIs will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Charts -->
                <div class="mb-8">
                    <h2 class="text-xl font-bold text-white mb-4">Performance Charts</h2>
                    <div class="chart-grid">
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Revenue Trend</h3>
                            <div class="chart-container">
                                <canvas id="revenue-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Order Volume</h3>
                            <div class="chart-container">
                                <canvas id="orders-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Top Categories</h3>
                            <div class="chart-container">
                                <canvas id="categories-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">User Growth</h3>
                            <div class="chart-container">
                                <canvas id="users-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Reports -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div id="quick-reports-container">
                        <!-- Quick reports will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sales Tab -->
            <div id="sales-tab" class="tab-content">
                <div class="space-y-6">
                    <!-- Sales Metrics -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Sales Performance</h3>
                        <div id="sales-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <!-- Sales metrics will be populated -->
                        </div>
                    </div>

                    <!-- Sales Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Daily Sales</h3>
                            <div class="chart-container">
                                <canvas id="daily-sales-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Sales by Region</h3>
                            <div class="chart-container">
                                <canvas id="regional-sales-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Top Products -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Top Selling Products</h3>
                        <div class="data-table" id="top-products-table">
                            <!-- Table will be populated -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Analytics Tab -->
            <div id="customers-tab" class="tab-content">
                <div class="space-y-6">
                    <!-- Customer Metrics -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Customer Insights</h3>
                        <div id="customer-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <!-- Customer metrics will be populated -->
                        </div>
                    </div>

                    <!-- Customer Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Customer Acquisition</h3>
                            <div class="chart-container">
                                <canvas id="acquisition-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Customer Lifetime Value</h3>
                            <div class="chart-container">
                                <canvas id="ltv-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Segments -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Customer Segments</h3>
                        <div id="customer-segments" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- Segments will be populated -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory-tab" class="tab-content">
                <div class="space-y-6">
                    <!-- Inventory Metrics -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Inventory Overview</h3>
                        <div id="inventory-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <!-- Inventory metrics will be populated -->
                        </div>
                    </div>

                    <!-- Stock Alerts -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Stock Alerts</h3>
                        <div id="stock-alerts" class="space-y-3">
                            <!-- Stock alerts will be populated -->
                        </div>
                    </div>

                    <!-- Inventory Movement -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Inventory Movement</h3>
                        <div class="chart-container">
                            <canvas id="inventory-movement-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Tab -->
            <div id="financial-tab" class="tab-content">
                <div class="space-y-6">
                    <!-- Financial Summary -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Financial Summary</h3>
                        <div id="financial-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <!-- Financial metrics will be populated -->
                        </div>
                    </div>

                    <!-- P&L Chart -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Profit & Loss</h3>
                        <div class="chart-container">
                            <canvas id="pl-chart"></canvas>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Payment Methods</h3>
                            <div class="chart-container">
                                <canvas id="payment-methods-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="glass-morphism rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Cash Flow</h3>
                            <div class="chart-container">
                                <canvas id="cashflow-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scheduled Reports Tab -->
            <div id="scheduled-tab" class="tab-content">
                <div class="space-y-6">
                    <!-- Scheduler -->
                    <div class="glass-morphism rounded-xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-white">Scheduled Reports</h3>
                            <button onclick="addScheduledReport()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
                                <i class="fas fa-plus mr-2"></i>Add Schedule
                            </button>
                        </div>
                        
                        <div id="scheduled-reports" class="scheduler-grid">
                            <!-- Scheduled reports will be populated -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Generator Modal -->
    <div id="report-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="glass-morphism p-6 sm:p-8 rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl sm:text-2xl font-bold text-white">Generate Custom Report</h2>
                <button onclick="closeReportModal()" class="text-white/70 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Report Configuration -->
                <div>
                    <form id="report-form" class="space-y-4">
                        <div>
                            <label class="block text-white/70 text-sm mb-2">Report Type *</label>
                            <select id="report-type" required class="w-full p-3 rounded-lg form-input" onchange="updateReportFields()">
                                <option value="">Select Report Type</option>
                                <option value="sales">Sales Report</option>
                                <option value="customers">Customer Report</option>
                                <option value="inventory">Inventory Report</option>
                                <option value="financial">Financial Report</option>
                                <option value="performance">Performance Report</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-white/70 text-sm mb-2">Report Name *</label>
                            <input type="text" id="report-name" required class="w-full p-3 rounded-lg form-input" placeholder="Enter report name">
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-white/70 text-sm mb-2">Start Date</label>
                                <input type="date" id="report-start-date" class="w-full p-3 rounded-lg form-input">
                            </div>
                            <div>
                                <label class="block text-white/70 text-sm mb-2">End Date</label>
                                <input type="date" id="report-end-date" class="w-full p-3 rounded-lg form-input">
                            </div>
                        </div>

                        <div>
                            <label class="block text-white/70 text-sm mb-2">Export Format</label>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="export-format" value="pdf" checked>
                                    <span class="text-white text-sm">PDF</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="export-format" value="excel">
                                    <span class="text-white text-sm">Excel</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="export-format" value="csv">
                                    <span class="text-white text-sm">CSV</span>
                                </label>
                                <label class="flex items-center space-x-2">
                                    <input type="radio" name="export-format" value="json">
                                    <span class="text-white text-sm">JSON</span>
                                </label>
                            </div>
                        </div>

                        <div id="report-fields" class="space-y-3">
                            <!-- Dynamic fields will be added based on report type -->
                        </div>

                        <div class="flex space-x-3 pt-6 border-t border-white/10">
                            <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                <i class="fas fa-play mr-2"></i>Generate Report
                            </button>
                            <button type="button" onclick="previewReport()" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg">
                                <i class="fas fa-eye mr-2"></i>Preview
                            </button>
                            <button type="button" onclick="closeReportModal()" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Report Preview -->
                <div>
                    <h3 class="text-lg font-bold text-white mb-4">Report Preview</h3>
                    <div id="report-preview" class="report-preview">
                        <div class="text-center text-white/60 py-8">
                            <i class="fas fa-file-alt text-3xl mb-3"></i>
                            <p>Configure report settings to see preview</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // Global variables
    let currentTab = 'overview';
    let currentDateRange = 'week';
    let charts = {};
    let reportData = {};

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('📊 Reports & Analytics initializing...');
        
        // Check authentication first
        if (!checkAuthentication()) return;
        
        // Set default date range
        setDateRange('week');
        
        // Load data
        loadAllData();
        setupEventListeners();
        
        console.log('✅ Reports & Analytics initialized');
    });

    // Check authentication
    function checkAuthentication() {
        const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
        const userRole = localStorage.getItem('userRole');
        
        if (!token) {
            console.log('❌ No authentication token found');
            window.location.href = '/auth/auth-admin.html';
            return false;
        }
        
        if (userRole !== 'admin') {
            console.log('❌ Insufficient permissions');
            window.location.href = '/auth/auth-admin.html';
            return false;
        }
        
        console.log('✅ Authentication verified');
        return true;
    }

    // Setup event listeners
    function setupEventListeners() {
        // Form submissions
        document.getElementById('report-form').addEventListener('submit', handleReportGeneration);
        
        // Date inputs
        document.getElementById('start-date').addEventListener('change', applyDateFilter);
        document.getElementById('end-date').addEventListener('change', applyDateFilter);
    }

    // Load all data
    async function loadAllData() {
        await Promise.all([
            loadKPIs(),
            loadCharts(),
            loadQuickReports(),
            loadScheduledReports()
        ]);
    }

    // Load KPIs
    function loadKPIs() {
        const kpis = [
            {
                title: 'Total Revenue',
                value: '$2,456,789',
                change: '+12.5%',
                trend: 'up',
                icon: 'fas fa-dollar-sign',
                color: 'green'
            },
            {
                title: 'Total Orders',
                value: '15,842',
                change: '+8.3%',
                trend: 'up',
                icon: 'fas fa-shopping-cart',
                color: 'blue'
            },
            {
                title: 'Active Customers',
                value: '8,945',
                change: '+15.7%',
                trend: 'up',
                icon: 'fas fa-users',
                color: 'purple'
            },
            {
                title: 'Conversion Rate',
                value: '3.2%',
                change: '-0.5%',
                trend: 'down',
                icon: 'fas fa-chart-line',
                color: 'yellow'
            },
            {
                title: 'Average Order Value',
                value: '$155.23',
                change: '+4.1%',
                trend: 'up',
                icon: 'fas fa-receipt',
                color: 'teal'
            },
            {
                title: 'Customer Satisfaction',
                value: '4.7/5',
                change: '+0.3',
                trend: 'up',
                icon: 'fas fa-star',
                color: 'orange'
            }
        ];

        const container = document.getElementById('kpi-container');
        container.innerHTML = kpis.map(kpi => `
            <div class="metric-card">
                <div class="flex items-center justify-between mb-3">
                    <div class="w-10 h-10 bg-${kpi.color}-500/20 rounded-lg flex items-center justify-center">
                        <i class="${kpi.icon} text-${kpi.color}-400"></i>
                    </div>
                    <div class="text-right">
                        <span class="trend-${kpi.trend} text-sm font-medium">
                            <i class="fas fa-arrow-${kpi.trend === 'up' ? 'up' : 'down'} mr-1"></i>
                            ${kpi.change}
                        </span>
                    </div>
                </div>
                <h3 class="text-white/70 text-sm mb-1">${kpi.title}</h3>
                <p class="text-white text-2xl font-bold">${kpi.value}</p>
            </div>
        `).join('');
    }

    // Load charts
    function loadCharts() {
        // Revenue Chart
        const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
        charts.revenue = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [{
                    label: 'Revenue',
                    data: [185000, 195000, 210000, 198000, 225000, 245000, 256000],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    },
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    }
                }
            }
        });

        // Orders Chart
        const ordersCtx = document.getElementById('orders-chart').getContext('2d');
        charts.orders = new Chart(ordersCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Orders',
                    data: [125, 178, 234, 198, 267, 345, 289],
                    backgroundColor: '#22c55e',
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    }
                }
            }
        });

        // Categories Chart
        const categoriesCtx = document.getElementById('categories-chart').getContext('2d');
        charts.categories = new Chart(categoriesCtx, {
            type: 'doughnut',
            data: {
                labels: ['Electronics', 'Fashion', 'Home', 'Books', 'Sports'],
                datasets: [{
                    data: [35, 25, 20, 12, 8],
                    backgroundColor: [
                        '#3b82f6',
                        '#22c55e',
                        '#f59e0b',
                        '#ef4444',
                        '#8b5cf6'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: 'rgba(255, 255, 255, 0.7)' }
                    }
                }
            }
        });

        // Users Chart
        const usersCtx = document.getElementById('users-chart').getContext('2d');
        charts.users = new Chart(usersCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [{
                    label: 'New Users',
                    data: [342, 456, 523, 498, 645, 721, 834],
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    },
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                    }
                }
            }
        });
    }

    // Load quick reports
    function loadQuickReports() {
        const quickReports = [
            {
                title: 'Daily Sales Summary',
                description: 'Complete overview of today\'s sales performance',
                icon: 'fas fa-chart-bar',
                color: 'blue',
                lastGenerated: '2 hours ago',
                status: 'ready'
            },
            {
                title: 'Inventory Alert Report',
                description: 'Products with low stock levels',
                icon: 'fas fa-exclamation-triangle',
                color: 'red',
                lastGenerated: '30 minutes ago',
                status: 'ready'
            },
            {
                title: 'Top Customers Report',
                description: 'Highest value customers this month',
                icon: 'fas fa-crown',
                color: 'yellow',
                lastGenerated: '1 hour ago',
                status: 'ready'
            },
            {
                title: 'Financial Summary',
                description: 'P&L and cash flow summary',
                icon: 'fas fa-dollar-sign',
                color: 'green',
                lastGenerated: 'Generating...',
                status: 'processing'
            },
            {
                title: 'Performance Metrics',
                description: 'Key performance indicators dashboard',
                icon: 'fas fa-tachometer-alt',
                color: 'purple',
                lastGenerated: '3 hours ago',
                status: 'ready'
            },
            {
                title: 'Marketing Analytics',
                description: 'Campaign performance and ROI analysis',
                icon: 'fas fa-bullhorn',
                color: 'teal',
                lastGenerated: '4 hours ago',
                status: 'ready'
            }
        ];

        const container = document.getElementById('quick-reports-container');
        container.innerHTML = quickReports.map(report => `
            <div class="report-card glass-morphism rounded-lg p-6" onclick="generateQuickReport('${report.title}')">
                <div class="flex items-start justify-between mb-4">
                    <div class="w-12 h-12 bg-${report.color}-500/20 rounded-lg flex items-center justify-center">
                        <i class="${report.icon} text-${report.color}-400 text-xl"></i>
                    </div>
                    <span class="status-badge status-${report.status === 'ready' ? 'generated' : 'processing'}">
                        ${report.status === 'ready' ? 'Ready' : 'Processing'}
                    </span>
                </div>
                <h3 class="text-white font-semibold mb-2">${report.title}</h3>
                <p class="text-white/60 text-sm mb-4">${report.description}</p>
                <div class="flex justify-between items-center text-xs text-white/50">
                    <span>Last: ${report.lastGenerated}</span>
                    <button class="text-blue-400 hover:text-blue-300">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    // Load scheduled reports
    function loadScheduledReports() {
        const scheduledReports = [
            {
                id: 1,
                name: 'Weekly Sales Report',
                type: 'sales',
                frequency: 'weekly',
                nextRun: '2025-01-20 09:00',
                status: 'active',
                recipients: ['admin@africandeals.com', 'manager@africandeals.com'],
                format: 'pdf'
            },
            {
                id: 2,
                name: 'Monthly Financial Summary',
                type: 'financial',
                frequency: 'monthly',
                nextRun: '2025-02-01 08:00',
                status: 'active',
                recipients: ['finance@africandeals.com'],
                format: 'excel'
            },
            {
                id: 3,
                name: 'Daily Inventory Check',
                type: 'inventory',
                frequency: 'daily',
                nextRun: '2025-01-18 06:00',
                status: 'paused',
                recipients: ['warehouse@africandeals.com'],
                format: 'csv'
            }
        ];

        const container = document.getElementById('scheduled-reports');
        container.innerHTML = scheduledReports.map(report => `
            <div class="schedule-item">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="text-white font-medium">${report.name}</h4>
                        <p class="text-white/60 text-sm">${capitalizeFirst(report.type)} Report • ${capitalizeFirst(report.frequency)}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="status-badge status-${report.status === 'active' ? 'generated' : 'failed'}">
                            ${capitalizeFirst(report.status)}
                        </span>
                        <button onclick="toggleSchedule(${report.id})" 
                                class="text-${report.status === 'active' ? 'yellow' : 'green'}-400 hover:text-${report.status === 'active' ? 'yellow' : 'green'}-300">
                            <i class="fas fa-${report.status === 'active' ? 'pause' : 'play'}"></i>
                        </button>
                        <button onclick="editSchedule(${report.id})" class="text-blue-400 hover:text-blue-300">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteSchedule(${report.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div>
                        <span class="text-white/50">Next Run:</span>
                        <p class="text-white">${formatDateTime(report.nextRun)}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Format:</span>
                        <p class="text-white">${report.format.toUpperCase()}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Recipients:</span>
                        <p class="text-white">${report.recipients.length} users</p>
                    </div>
                    <div>
                        <span class="text-white/50">ID:</span>
                        <p class="text-white">#${report.id}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Tab switching
    function switchTab(tab) {
        currentTab = tab;
        
        // Update active tab
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
        
        // Show/hide tab content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tab}-tab`).classList.add('active');

        // Load tab-specific data
        loadTabData(tab);
    }

    // Load tab-specific data
    function loadTabData(tab) {
        switch(tab) {
            case 'sales':
                loadSalesData();
                break;
            case 'customers':
                loadCustomerData();
                break;
            case 'inventory':
                loadInventoryData();
                break;
            case 'financial':
                loadFinancialData();
                break;
        }
    }

    // Load sales data
    function loadSalesData() {
        const salesMetrics = [
            { title: 'Total Sales', value: '$2,456,789', change: '+12.5%', trend: 'up' },
            { title: 'Orders Count', value: '15,842', change: '+8.3%', trend: 'up' },
            { title: 'Avg Order Value', value: '$155.23', change: '+4.1%', trend: 'up' },
            { title: 'Conversion Rate', value: '3.2%', change: '-0.5%', trend: 'down' }
        ];

        const container = document.getElementById('sales-metrics');
        container.innerHTML = salesMetrics.map(metric => `
            <div class="metric-card">
                <h3 class="text-white/70 text-sm mb-1">${metric.title}</h3>
                <p class="text-white text-2xl font-bold mb-2">${metric.value}</p>
                <span class="trend-${metric.trend} text-sm">
                    <i class="fas fa-arrow-${metric.trend === 'up' ? 'up' : 'down'} mr-1"></i>
                    ${metric.change}
                </span>
            </div>
        `).join('');

        // Load charts if not already loaded
        setTimeout(() => {
            if (!charts.dailySales) {
                const ctx = document.getElementById('daily-sales-chart')?.getContext('2d');
                if (ctx) {
                    charts.dailySales = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Daily Sales',
                                data: [12500, 15600, 18900, 16800, 22100, 28500, 24700],
                                borderColor: '#22c55e',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                                },
                                x: {
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: 'rgba(255, 255, 255, 0.7)' }
                                }
                            }
                        }
                    });
                }
            }

            if (!charts.regionalSales) {
                const ctx = document.getElementById('regional-sales-chart')?.getContext('2d');
                if (ctx) {
                    charts.regionalSales = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Rwanda', 'Kenya', 'Uganda', 'Tanzania', 'Other'],
                            datasets: [{
                                data: [45, 25, 15, 10, 5],
                                backgroundColor: ['#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { color: 'rgba(255, 255, 255, 0.7)' }
                                }
                            }
                        }
                    });
                }
            }
        }, 100);

        // Load top products table
        const topProducts = [
            { name: 'iPhone 15 Pro', category: 'Electronics', sales: '$125,450', units: 245, growth: '+15.2%' },
            { name: 'Samsung Galaxy S24', category: 'Electronics', sales: '$98,720', units: 198, growth: '+12.8%' },
            { name: 'MacBook Air M3', category: 'Electronics', sales: '$87,340', units: 87, growth: '+8.5%' },
            { name: 'Nike Air Max', category: 'Fashion', sales: '$56,890', units: 312, growth: '+22.1%' },
            { name: 'Adidas Ultraboost', category: 'Fashion', sales: '$43,560', units: 267, growth: '+18.9%' }
        ];

        const tableContainer = document.getElementById('top-products-table');
        tableContainer.innerHTML = `
            <table class="w-full">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Category</th>
                        <th>Sales</th>
                        <th>Units</th>
                        <th>Growth</th>
                    </tr>
                </thead>
                <tbody>
                    ${topProducts.map(product => `
                        <tr>
                            <td class="font-medium">${product.name}</td>
                            <td>${product.category}</td>
                            <td class="font-bold text-green-400">${product.sales}</td>
                            <td>${product.units}</td>
                            <td class="text-green-400">${product.growth}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    // Load customer data
    function loadCustomerData() {
        const customerMetrics = [
            { title: 'Total Customers', value: '28,945', change: '+15.7%', trend: 'up' },
            { title: 'New This Month', value: '1,245', change: '+22.3%', trend: 'up' },
            { title: 'Retention Rate', value: '87.5%', change: '+2.1%', trend: 'up' },
            { title: 'Avg Lifetime Value', value: '$435.67', change: '+8.9%', trend: 'up' }
        ];

        const container = document.getElementById('customer-metrics');
        container.innerHTML = customerMetrics.map(metric => `
            <div class="metric-card">
                <h3 class="text-white/70 text-sm mb-1">${metric.title}</h3>
                <p class="text-white text-2xl font-bold mb-2">${metric.value}</p>
                <span class="trend-${metric.trend} text-sm">
                    <i class="fas fa-arrow-${metric.trend === 'up' ? 'up' : 'down'} mr-1"></i>
                    ${metric.change}
                </span>
            </div>
        `).join('');

        // Customer segments
        const segments = [
            { name: 'VIP Customers', count: '1,245', percentage: '4.3%', color: 'bg-yellow-500/20 text-yellow-400' },
            { name: 'Regular Customers', count: '18,967', percentage: '65.5%', color: 'bg-green-500/20 text-green-400' },
            { name: 'New Customers', count: '8,733', percentage: '30.2%', color: 'bg-blue-500/20 text-blue-400' }
        ];

        const segmentContainer = document.getElementById('customer-segments');
        segmentContainer.innerHTML = segments.map(segment => `
            <div class="metric-card">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-white font-medium">${segment.name}</h3>
                    <span class="px-2 py-1 rounded text-xs ${segment.color}">${segment.percentage}</span>
                </div>
                <p class="text-white text-2xl font-bold">${segment.count}</p>
            </div>
        `).join('');
    }

    // Load inventory data
    function loadInventoryData() {
        const inventoryMetrics = [
            { title: 'Total Products', value: '15,420', change: '+3.2%', trend: 'up' },
            { title: 'Low Stock Items', value: '234', change: '+12.5%', trend: 'up' },
            { title: 'Out of Stock', value: '45', change: '-15.3%', trend: 'down' },
            { title: 'Total Value', value: '$2.4M', change: '+8.7%', trend: 'up' }
        ];

        const container = document.getElementById('inventory-metrics');
        container.innerHTML = inventoryMetrics.map(metric => `
            <div class="metric-card">
                <h3 class="text-white/70 text-sm mb-1">${metric.title}</h3>
                <p class="text-white text-2xl font-bold mb-2">${metric.value}</p>
                <span class="trend-${metric.trend} text-sm">
                    <i class="fas fa-arrow-${metric.trend === 'up' ? 'up' : 'down'} mr-1"></i>
                    ${metric.change}
                </span>
            </div>
        `).join('');

        // Stock alerts
        const stockAlerts = [
            { product: 'iPhone 15 Pro 256GB', stock: 5, threshold: 10, category: 'Electronics' },
            { product: 'Samsung Galaxy S24', stock: 8, threshold: 15, category: 'Electronics' },
            { product: 'Nike Air Max 270', stock: 3, threshold: 20, category: 'Fashion' },
            { product: 'Adidas Ultraboost 22', stock: 12, threshold: 25, category: 'Fashion' },
            { product: 'Apple MacBook Air M3', stock: 2, threshold: 5, category: 'Electronics' }
        ];

        const alertContainer = document.getElementById('stock-alerts');
        alertContainer.innerHTML = stockAlerts.map(alert => `
            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="text-white font-medium">${alert.product}</h4>
                    <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded">${alert.category}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-white/70">Stock: <span class="text-yellow-400 font-medium">${alert.stock}</span></span>
                    <span class="text-white/70">Threshold: ${alert.threshold}</span>
                </div>
            </div>
        `).join('');
    }

    // Load financial data
    function loadFinancialData() {
        const financialMetrics = [
            { title: 'Total Revenue', value: '$2,456,789', change: '+12.5%', trend: 'up' },
            { title: 'Net Profit', value: '$489,357', change: '+18.2%', trend: 'up' },
            { title: 'Operating Costs', value: '$1,245,632', change: '+5.8%', trend: 'up' },
            { title: 'Profit Margin', value: '19.9%', change: '+3.1%', trend: 'up' }
        ];

        const container = document.getElementById('financial-metrics');
        container.innerHTML = financialMetrics.map(metric => `
            <div class="metric-card">
                <h3 class="text-white/70 text-sm mb-1">${metric.title}</h3>
                <p class="text-white text-2xl font-bold mb-2">${metric.value}</p>
                <span class="trend-${metric.trend} text-sm">
                    <i class="fas fa-arrow-${metric.trend === 'up' ? 'up' : 'down'} mr-1"></i>
                    ${metric.change}
                </span>
            </div>
        `).join('');
    }

    // Date range functions
    function setDateRange(range) {
        currentDateRange = range;
        
        // Update active filter chip
        document.querySelectorAll('.filter-chip').forEach(chip => chip.classList.remove('active'));
        event?.target?.classList?.add('active') || document.querySelector(`[onclick="setDateRange('${range}')"]`)?.classList?.add('active');
        
        const endDate = new Date();
        let startDate = new Date();
        
        switch(range) {
            case 'today':
                startDate = new Date();
                break;
            case 'week':
                startDate.setDate(endDate.getDate() - 7);
                break;
            case 'month':
                startDate.setMonth(endDate.getMonth() - 1);
                break;
            case 'quarter':
                startDate.setMonth(endDate.getMonth() - 3);
                break;
            case 'year':
                startDate.setFullYear(endDate.getFullYear() - 1);
                break;
        }
        
        // Update date inputs
        document.getElementById('start-date').value = startDate.toISOString().split('T')[0];
        document.getElementById('end-date').value = endDate.toISOString().split('T')[0];
    }

    function applyDateFilter() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        
        console.log('Applying date filter:', startDate, 'to', endDate);
        
        // Reload data with new date range
        loadAllData();
        
        showToast('Date filter applied successfully', 'success');
    }

    // Report generation functions
    function generateCustomReport() {
        document.getElementById('report-modal').classList.remove('hidden');
        document.getElementById('report-modal').classList.add('flex');
    }

    function closeReportModal() {
        document.getElementById('report-modal').classList.add('hidden');
        document.getElementById('report-modal').classList.remove('flex');
        document.getElementById('report-form').reset();
    }

    function updateReportFields() {
        const reportType = document.getElementById('report-type').value;
        const fieldsContainer = document.getElementById('report-fields');
        
        const fieldsByType = {
            sales: [
                { label: 'Include Revenue Breakdown', type: 'checkbox', id: 'include-revenue' },
                { label: 'Group by Category', type: 'checkbox', id: 'group-category' },
                { label: 'Show Trends', type: 'checkbox', id: 'show-trends' }
            ],
            customers: [
                { label: 'Include Customer Segments', type: 'checkbox', id: 'include-segments' },
                { label: 'Show Acquisition Sources', type: 'checkbox', id: 'show-sources' },
                { label: 'Include Lifetime Value', type: 'checkbox', id: 'include-ltv' }
            ],
            inventory: [
                { label: 'Include Stock Levels', type: 'checkbox', id: 'include-stock' },
                { label: 'Show Movement History', type: 'checkbox', id: 'show-movement' },
                { label: 'Alert Items Only', type: 'checkbox', id: 'alert-only' }
            ],
            financial: [
                { label: 'Include P&L Statement', type: 'checkbox', id: 'include-pl' },
                { label: 'Show Cash Flow', type: 'checkbox', id: 'show-cashflow' },
                { label: 'Include Tax Details', type: 'checkbox', id: 'include-tax' }
            ]
        };
        
        const fields = fieldsByType[reportType] || [];
        
        fieldsContainer.innerHTML = fields.map(field => `
            <label class="flex items-center space-x-2">
                <input type="${field.type}" id="${field.id}" ${field.type === 'checkbox' ? 'checked' : ''}>
                <span class="text-white text-sm">${field.label}</span>
            </label>
        `).join('');
    }

    function previewReport() {
        const reportType = document.getElementById('report-type').value;
        const reportName = document.getElementById('report-name').value;
        
        if (!reportType || !reportName) {
            showToast('Please select report type and enter name', 'warning');
            return;
        }
        
        const previewContainer = document.getElementById('report-preview');
        previewContainer.innerHTML = `
            <div class="text-white/70 text-sm mb-3">Report Preview: ${reportName}</div>
            <div class="space-y-2 text-white/60">
                <div>Type: ${capitalizeFirst(reportType)} Report</div>
                <div>Generated: ${new Date().toLocaleString()}</div>
                <div>Records: ${Math.floor(Math.random() * 10000) + 1000}</div>
                <div>---</div>
                <div>Sample Data:</div>
                <div class="pl-4 space-y-1 font-mono text-xs">
                    <div>Date: ${new Date().toLocaleDateString()}</div>
                    <div>Total Revenue: $${(Math.random() * 100000).toFixed(2)}</div>
                    <div>Orders: ${Math.floor(Math.random() * 1000)}</div>
                    <div>Customers: ${Math.floor(Math.random() * 500)}</div>
                    <div>Average Order Value: $${(Math.random() * 200).toFixed(2)}</div>
                </div>
                <div class="mt-4 text-xs">
                    * This is a preview. Actual report will contain complete data.
                </div>
            </div>
        `;
    }

    async function handleReportGeneration(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const reportData = {
            type: document.getElementById('report-type').value,
            name: document.getElementById('report-name').value,
            startDate: document.getElementById('report-start-date').value,
            endDate: document.getElementById('report-end-date').value,
            format: formData.get('export-format')
        };
        
        try {
            console.log('Generating report:', reportData);
            
            showToast('Report generation started...', 'info');
            
            // Simulate report generation
            setTimeout(() => {
                showToast('Report generated successfully!', 'success');
                closeReportModal();
            }, 2000);
            
        } catch (error) {
            console.error('Error generating report:', error);
            showToast('Error generating report: ' + error.message, 'error');
        }
    }

    function generateQuickReport(reportName) {
        console.log('Generating quick report:', reportName);
        showToast(`Generating ${reportName}...`, 'info');
        
        setTimeout(() => {
            showToast('Quick report generated!', 'success');
        }, 1500);
    }

    function scheduleReport() {
        showToast('Schedule report feature ready', 'info');
    }

    function addScheduledReport() {
        showToast('Add scheduled report feature ready', 'info');
    }

    function toggleSchedule(id) {
        showToast(`Schedule toggled for report #${id}`, 'info');
    }

    function editSchedule(id) {
        showToast(`Edit schedule for report #${id}`, 'info');
    }

    function deleteSchedule(id) {
        if (confirm('Are you sure you want to delete this scheduled report?')) {
            showToast(`Scheduled report #${id} deleted`, 'success');
        }
    }

    function exportAllReports() {
        showToast('Exporting all reports...', 'info');
    }

    // Utility functions
    function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function formatDateTime(dateTime) {
        return new Date(dateTime).toLocaleString();
    }

    function showToast(message, type = 'info') {
        console.log(`[${type.toUpperCase()}] ${message}`);
        
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg text-white ${
            type === 'success' ? 'bg-green-500' : 
            type === 'error' ? 'bg-red-500' : 
            type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
        }`;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // Make functions globally available
    window.switchTab = switchTab;
    window.setDateRange = setDateRange;
    window.applyDateFilter = applyDateFilter;
    window.generateCustomReport = generateCustomReport;
    window.closeReportModal = closeReportModal;
    window.updateReportFields = updateReportFields;
    window.previewReport = previewReport;
    window.generateQuickReport = generateQuickReport;
    window.scheduleReport = scheduleReport;
    window.addScheduledReport = addScheduledReport;
    window.toggleSchedule = toggleSchedule;
    window.editSchedule = editSchedule;
    window.deleteSchedule = deleteSchedule;
    window.exportAllReports = exportAllReports;

</script>

</body>
</html>