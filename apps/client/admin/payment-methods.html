<!DOCTYPE html>
<html lang="en" class="admin-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Methods | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="admin-auth-check.js"></script>
    <script src="admin-utils.js"></script>
    <style>
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid #3b82f6;
        }
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            backdrop-filter: blur(10px);
        }
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        .form-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #3b82f6;
            outline: none;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .stat-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="flex h-screen">
    
        
        <!-- Sidebar -->
        <div class="sidebar w-64 p-6">
            <div class="text-white text-2xl font-bold mb-8">
                <i class="fas fa-shield-alt mr-2"></i>Admin Panel
            </div>
            
            <nav class="space-y-2">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="payment-credentials.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-wallet"></i>
                    <span>Payment Credentials</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="orders.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="reports.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>
            
            <nav class="space-y-2">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="payment-credentials.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-wallet"></i>
                    <span>Payment Credentials</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="orders.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="reports.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>
    
    <!-- Main Content -->
    <div class="flex-1 p-8 overflow-auto">
        
  
  <!-- Navigation preserved - each page has unique navigation -->

  
  <!-- Navigation preserved - each page has unique navigation -->

  
  
  
  <!-- Header Component -->
  <div id="admin-header"></div>

  <main class="pt-16 pb-8">
    <div class="max-w-7xl mx-auto px-4">
      <!-- Page Header -->
      <div class="mb-8">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Payment Methods</h1>
            <p class="text-gray-600">Manage available payment methods for your platform</p>
          </div>
          <button id="add-method-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" onclick="showNotification('Feature in development', 'info')">
            <span class="mr-2">+</span>Add Payment Method
          </button>
        </div>
      </div>

      <!-- Payment System Configuration -->
      <div class="mb-8 bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Payment System Configuration</h2>
          <p class="text-gray-600 mt-1">Configure how your platform handles payments</p>
        </div>
        
        <div class="p-6 space-y-6">
          <!-- Payment Mode Toggle -->
          <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200">
            <div>
              <h3 class="font-semibold text-blue-900">Payment Mode</h3>
              <p class="text-sm text-blue-700 mt-1">Choose between manual payment handling or automated escrow system</p>
            </div>
            <div class="flex items-center space-x-4">
              <label class="flex items-center">
                <input type="radio" name="paymentMode" value="manual" class="mr-2 text-blue-600">
                <span class="text-sm font-medium">Manual Payments</span>
              </label>
              <label class="flex items-center">
                <input type="radio" name="paymentMode" value="escrow" class="mr-2 text-blue-600">
                <span class="text-sm font-medium">Automated Escrow</span>
              </label>
            </div>
          </div>
          
          <!-- Manual Payment Configuration -->
          <div id="manual-payment-config" class="space-y-4">
            <h3 class="text-lg font-semibold text-gray-900">African Deals Domain Payment Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="add-mobile-number" class="block text-sm font-medium text-gray-700 mb-1">Mobile Money Number</label>
                <input type="tel" id="add-mobile-number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="+250788910639">
              </div>
              <div>
                <label for="add-momo-code" class="block text-sm font-medium text-gray-700 mb-1">MoMo Pay Code</label>
                <input type="text" id="add-momo-code" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="*182*8*1* #">
              </div>
            </div>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-yellow-800">Manual Payment Mode Active</h3>
                  <div class="mt-2 text-sm text-yellow-700">
                    <p>When manual payment is enabled, buyers will pay to your African Deals Domain account, and you'll manually approve/release payments to sellers and agents after delivery confirmation.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- API Configuration -->
          <div id="api-payment-config" class="space-y-4 hidden">
            <h3 class="text-lg font-semibold text-gray-900">Payment API Configuration</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Stripe -->
              <div class="border border-gray-200 rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-gray-900">Stripe</h4>
                  <label class="flex items-center">
                    <input type="checkbox" id="stripe-enabled" class="mr-2">
                    <span class="text-sm">Enable</span>
                  </label>
                </div>
                <div class="space-y-3">
                  <input type="text" id="stripe-public-key" placeholder="Stripe Public Key" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <input type="password" id="stripe-secret-key" placeholder="Stripe Secret Key" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
              
              <!-- MTN -->
              <div class="border border-gray-200 rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-gray-900">MTN Mobile Money</h4>
                  <label class="flex items-center">
                    <input type="checkbox" id="mtn-enabled" class="mr-2">
                    <span class="text-sm">Enable</span>
                  </label>
                </div>
                <div class="space-y-3">
                  <input type="text" id="mtn-api-key" placeholder="MTN API Key" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <input type="text" id="mtn-user-id" placeholder="MTN User ID" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
              
              <!-- Airtel -->
              <div class="border border-gray-200 rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-gray-900">Airtel Money</h4>
                  <label class="flex items-center">
                    <input type="checkbox" id="airtel-enabled" class="mr-2">
                    <span class="text-sm">Enable</span>
                  </label>
                </div>
                <div class="space-y-3">
                  <input type="text" id="airtel-api-key" placeholder="Airtel API Key" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <input type="text" id="airtel-client-id" placeholder="Airtel Client ID" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
              
              <!-- PayPal -->
              <div class="border border-gray-200 rounded-lg p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="font-semibold text-gray-900">PayPal</h4>
                  <label class="flex items-center">
                    <input type="checkbox" id="paypal-enabled" class="mr-2">
                    <span class="text-sm">Enable</span>
                  </label>
                </div>
                <div class="space-y-3">
                  <input type="text" id="paypal-client-id" placeholder="PayPal Client ID" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <input type="password" id="paypal-client-secret" placeholder="PayPal Client Secret" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
              </div>
            </div>
          </div>
          
          <!-- Save Configuration -->
          <div class="pt-4 border-t border-gray-200">
            <button id="save-payment-config" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors" onclick="handleSave()">
              Save Payment Configuration
            /button>
          </div>
        </div>
      </div>

      <!-- Payment Methods List -->
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Payment Methods</h2>
        </div>
        
        <div id="payment-methods-list" class="divide-y divide-gray-200">
          <!-- Payment methods will be loaded here -->
        </div>
      </div>

      <!-- Pending Transactions -->
      <div class="mt-8 bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-gray-900">Pending Manual Payments</h2>
        </div>
        
        <div id="pending-transactions-list" class="divide-y divide-gray-200">
          <!-- Pending transactions will be loaded here -->
        </div>
      </div>
    </div>
  </main>

  <!-- Add/Edit Payment Method Modal -->
  <div id="payment-method-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200">
          <h3 id="modal-title" class="text-xl font-semibold text-gray-900">Add Payment Method</h3>
        </div>
        
        <form id="payment-method-form" class="p-6 space-y-6" method="POST" action="#">
          <input type="hidden" id="method-id" name="id">
          
          <!-- Basic Information -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="method-name" class="block text-sm font-medium text-gray-700 mb-1">Method Name *</label>
              <input type="text" id="method-name" name="name" required pattern="[A-Za-z\s]{2,50}" title="Name must be 2-50 characters, letters and spaces only" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
              <label for="method-provider" class="block text-sm font-medium text-gray-700 mb-1">Provider *</label>
              <select id="method-provider" name="provider" required 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="">Select Provider</option>
                <option value="MTN_MOMO">MTN Mobile Money</option>
                <option value="AIRTEL_MONEY">Airtel Money</option>
                <option value="PAYPAL">PayPal</option>
                <option value="STRIPE">Stripe</option>
                <option value="BANK_TRANSFER">Bank Transfer</option>
                <option value="CRYPTO">Cryptocurrency</option>
                <option value="OTHER">Other</option>
              </select>
            </div>
          </div>

          <!-- Status and Order -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="flex items-center">
                <input type="checkbox" id="method-active" name="active" class="mr-2">
                <span class="text-sm font-medium text-gray-700">Active</span>
              </label>
            </div>
            <div>
              <label for="method-sort-order" class="block text-sm font-medium text-gray-700 mb-1">Sort Order</label>
              <input type="number" id="method-sort-order" name="sort_order" min="0" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
          </div>

          <!-- API Configuration -->
          <div>
            <label for="method-api-url" class="block text-sm font-medium text-gray-700 mb-1">API URL</label>
            <input type="url" id="method-api-url" name="api_url" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                   placeholder="https://api.example.com/payments">
          </div>

          <!-- Credentials -->
          <div>
            <label for="method-credentials" class="block text-sm font-medium text-gray-700 mb-1">API Credentials (JSON)</label>
            <textarea id="method-credentials" name="credentials" rows="4" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder='{"api_key": "your_api_key", "secret": "your_secret"}'></textarea>
            <p class="text-xs text-gray-500 mt-1">Enter API credentials as JSON format</p>
          </div>

          <!-- Description -->
          <div>
            <label for="method-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea id="method-description" name="description" rows="3" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Brief description of this payment method"></textarea>
          </div>

          <!-- Instructions -->
          <div>
            <label for="method-instructions" class="block text-sm font-medium text-gray-700 mb-1">User Instructions</label>
            <textarea id="method-instructions" name="instructions" rows="4" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder="Instructions for users on how to use this payment method"></textarea>
          </div>

          <!-- Logo Upload -->
          <div>
            <label for="method-logo" class="block text-sm font-medium text-gray-700 mb-1">Logo</label>
            <input type="file" id="method-logo" name="logo" accept="image/*" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <p class="text-xs text-gray-500 mt-1">Upload a logo for this payment method (max 2MB)</p>
            <div id="current-logo" class="mt-2 hidden">
              <img id="current-logo-img" src="" alt="Current logo" class="h-16 w-auto">
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
            <button type="button" id="cancel-btn" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors" onclick="handleCancel()">
              Cancel
            /button>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              Save Payment Method
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Transaction Details Modal -->
  <div id="transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200">
          <h3 class="text-xl font-semibold text-gray-900">Transaction Details</h3>
        </div>
        
        <div id="transaction-details" class="p-6">
          <!-- Transaction details will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen">
      <div class="bg-white rounded-lg p-6 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
        <p class="text-gray-600">Processing...</p>
      </div>
    </div>
  </div>

  <script>
    // Load header component
    try {
                        const response = await fetch('/admin/shared-components.html', { headers: { 'Authorization': `Bearer ${localStorage.getItem('token') || localStorage.getItem('authToken')}`, 'Content-Type': 'application/json' } });
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response;
                    } catch (error) {
                        console.error('API Error:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
                        showNotification('Operation failed. Please try again.', 'error');
                        throw error;
                    }
      .then(res => res.text())
      .then(html => {
        document.getElementById('admin-header').innerHTML = html;
      });

    let currentEditingId = null;

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadPaymentSystemConfig();
      loadPaymentMethods();
      loadPendingTransactions();
      setupEventListeners();
    });

    function setupEventListeners() {
      // Add payment method button
      document.getElementById('add-method-btn').addEventListener('click', () => {
        openPaymentMethodModal();
      });

      // Cancel button
      document.getElementById('cancel-btn').addEventListener('click', () => {
        closePaymentMethodModal();
      });

      // Form submission
      document.getElementById('payment-method-form').addEventListener('submit', handleFormSubmit);

      // Close modals when clicking outside
      document.getElementById('payment-method-modal').addEventListener('click', (e) => {
        if (e.target.id === 'payment-method-modal') {
          closePaymentMethodModal();
        }
      });

      document.getElementById('transaction-modal').addEventListener('click', (e) => {
        if (e.target.id === 'transaction-modal') {
          closeTransactionModal();
        }
      });
      
      // Payment system configuration event listeners
      const paymentModeRadios = document.querySelectorAll('input[name="paymentMode"]');
      paymentModeRadios.forEach(radio => {
        radio.addEventListener('change', handlePaymentModeChange);
      });
      
      document.getElementById('save-payment-config').addEventListener('click', savePaymentSystemConfig);
    }

    async function loadPaymentMethods() {
      try {
        const data = await window.authHelper.get('${API_BASE_URL}/payment-methods');
        renderPaymentMethods(data.payment_methods);
      } catch (error) {
        console.error('Error loading payment methods:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to load payment methods', 'error');
      }
    }

    function renderPaymentMethods(methods) {
      const container = document.getElementById('payment-methods-list');
      
      if (methods.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-gray-500">
            <p>No payment methods configured yet.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = methods.map(method => `
        <div class="p-6 hover:bg-gray-50 transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              ${method.logo_url ? `
                <img src="${method.logo_url}" loading="lazy" alt="${method.name}" class="h-12 w-12 object-contain">
              ` : `
                <div class="h-12 w-12 bg-gray-200 rounded-lg flex items-center justify-center">
                  <span class="text-gray-500 text-xs">${method.name.charAt(0)}</span>
                </div>
              `}
              <div>
                <h3 class="font-semibold text-gray-900">${method.name}</h3>
                <p class="text-sm text-gray-600">${method.provider}</p>
                ${method.description ? `<p class="text-sm text-gray-500 mt-1">${method.description}</p>` : ''}
              </div>
            </div>
            
            <div class="flex items-center space-x-3">
              <span class="px-2 py-1 text-xs rounded-full ${method.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                ${method.active ? 'Active' : 'Inactive'}
              </span>
              
              <button onclick="togglePaymentMethod(${method.id})" 
                      class="px-3 py-1 text-sm ${method.active ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'} rounded-lg transition-colors">
                ${method.active ? 'Disable' : 'Enable'}
              </button>
              
              <button onclick="editPaymentMethod(${method.id})" 
                      class="px-3 py-1 text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg transition-colors">
                Edit
              </button>
              
              <button onclick="deletePaymentMethod(${method.id})" 
                      class="px-3 py-1 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors">
                Delete
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    async function loadPendingTransactions() {
      try {
        const data = await window.authHelper.get('${API_BASE_URL}/payment-transactions?status=pending_confirmation');
        renderPendingTransactions(data.transactions);
      } catch (error) {
        console.error('Error loading pending transactions:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to load pending transactions', 'error');
      }
    }

    function renderPendingTransactions(transactions) {
      const container = document.getElementById('pending-transactions-list');
      
      if (transactions.length === 0) {
        container.innerHTML = `
          <div class="p-8 text-center text-gray-500">
            <p>No pending manual payments.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = transactions.map(transaction => `
        <div class="p-6 hover:bg-gray-50 transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center space-x-4">
                <div>
                  <h3 class="font-semibold text-gray-900">Order #${transaction.order_number}</h3>
                  <p class="text-sm text-gray-600">Buyer: ${transaction.buyer_name}</p>
                  <p class="text-sm text-gray-500">Amount: ${transaction.amount} ${transaction.currency}</p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Sender: ${transaction.sender_name}</p>
                  <p class="text-sm text-gray-600">Phone: ${transaction.sender_phone}</p>
                  <p class="text-sm text-gray-600">Transaction ID: ${transaction.transaction_id}</p>
                </div>
              </div>
              <p class="text-xs text-gray-500 mt-2">Submitted: ${new Date(transaction.created_at).toLocaleString()}</p>
            </div>
            
            <div class="flex items-center space-x-3">
              <button onclick="viewTransaction(${transaction.id})" 
                      class="px-3 py-1 text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg transition-colors">
                View Details
              </button>
              
              <button onclick="approveTransaction(${transaction.id})" 
                      class="px-3 py-1 text-sm bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition-colors">
                Approve
              </button>
              
              <button onclick="rejectTransaction(${transaction.id})" 
                      class="px-3 py-1 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors">
                Reject
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function openPaymentMethodModal(method = null) {
      currentEditingId = method ? method.id : null;
      
      document.getElementById('modal-title').textContent = method ? 'Edit Payment Method' : 'Add Payment Method';
      
      if (method) {
        document.getElementById('method-id').value = method.id;
        document.getElementById('method-name').value = method.name;
        document.getElementById('method-provider').value = method.provider;
        document.getElementById('method-active').checked = method.active;
        document.getElementById('method-sort-order').value = method.sort_order || 0;
        document.getElementById('method-api-url').value = method.api_url || '';
        document.getElementById('method-credentials').value = method.credentials ? JSON.stringify(method.credentials, null, 2) : '';
        document.getElementById('method-description').value = method.description || '';
        document.getElementById('method-instructions').value = method.instructions || '';
        
        if (method.logo_url) {
          document.getElementById('current-logo').classList.remove('hidden');
          document.getElementById('current-logo-img').src = method.logo_url;
        }
      } else {
        document.getElementById('payment-method-form').reset();
        document.getElementById('current-logo').classList.add('hidden');
      }
      
      document.getElementById('payment-method-modal').classList.remove('hidden');
    }

    function closePaymentMethodModal() {
      document.getElementById('payment-method-modal').classList.add('hidden');
      currentEditingId = null;
    }

    async function handleFormSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const loadingOverlay = document.getElementById('loading-overlay');
      
      try {
        loadingOverlay.classList.remove('hidden');
        
        const url = currentEditingId ? '${API_BASE_URL}/payment-methods/${currentEditingId}` : '${API_BASE_URL}/payment-methods';
        const method = currentEditingId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: window.authHelper.getAuthHeaders(),
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification(currentEditingId ? 'Payment method updated successfully' : 'Payment method created successfully', 'success');
          closePaymentMethodModal();
          loadPaymentMethods();
        } else {
          showNotification(data.error || 'Failed to save payment method', 'error');
        }
      } catch (error) {
        console.error('Error saving payment method:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to save payment method', 'error');
      } finally {
        loadingOverlay.classList.add('hidden');
      }
    }

    async function editPaymentMethod(id) {
      try {
        const data = await window.authHelper.get('${API_BASE_URL}/payment-methods/${id}`);
        openPaymentMethodModal(data.payment_method);
      } catch (error) {
        console.error('Error loading payment method:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to load payment method', 'error');
      }
    }

    async function togglePaymentMethod(id) {
      try {
        const data = await window.authHelper.post('${API_BASE_URL}/payment-methods/${id}/toggle`);
        showNotification(data.message, 'success');
        loadPaymentMethods();
      } catch (error) {
        console.error('Error toggling payment method:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to toggle payment method', 'error');
      }
    }

    async function deletePaymentMethod(id) {
      if (!confirm('Are you sure you want to delete this payment method? This action cannot be undone.')) {
        return;
      }
      
      try {
        const data = await window.authHelper.delete('${API_BASE_URL}/payment-methods/${id}`);
        showNotification(data.message, 'success');
        loadPaymentMethods();
      } catch (error) {
        console.error('Error deleting payment method:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to delete payment method', 'error');
      }
    }

    async function viewTransaction(id) {
      try {
        const data = await window.authHelper.get('${API_BASE_URL}/payment-transactions/${id}`);
        renderTransactionDetails(data.transaction);
        document.getElementById('transaction-modal').classList.remove('hidden');
      } catch (error) {
        console.error('Error loading transaction:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to load transaction details', 'error');
      }
    }

    function renderTransactionDetails(transaction) {
      const container = document.getElementById('transaction-details');
      
      container.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900">Transaction Information</h4>
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
              <p><span class="font-medium">Order:</span> #${transaction.order_number}</p>
              <p><span class="font-medium">Amount:</span> ${transaction.amount} ${transaction.currency}</p>
              <p><span class="font-medium">Status:</span> 
                <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">
                  ${transaction.status.replace('_', ' ').toUpperCase()}
                </span>
              </p>
              <p><span class="font-medium">Submitted:</span> ${new Date(transaction.created_at).toLocaleString()}</p>
            </div>
            
            <h4 class="font-semibold text-gray-900">Buyer Information</h4>
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
              <p><span class="font-medium">Name:</span> ${transaction.buyer_name}</p>
              <p><span class="font-medium">Email:</span> ${transaction.buyer_email}</p>
            </div>
            
            <h4 class="font-semibold text-gray-900">Payment Details</h4>
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
              <p><span class="font-medium">Sender Name:</span> ${transaction.sender_name}</p>
              <p><span class="font-medium">Sender Phone:</span> ${transaction.sender_phone}</p>
              <p><span class="font-medium">Transaction ID:</span> ${transaction.transaction_id}</p>
            </div>
          </div>
          
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900">Payment Screenshot</h4>
            ${transaction.screenshot_url ? `
              <div class="border rounded-lg overflow-hidden">
                <img src="${transaction.screenshot_url}" loading="lazy" alt="Payment screenshot" class="w-full h-auto">
              </div>
            ` : '<p class="text-gray-500">No screenshot uploaded</p>'}
            
            <div class="space-y-3">
              <div>
                <label for="admin-notes" class="block text-sm font-medium text-gray-700 mb-1">Admin Notes</label>
                <textarea id="admin-notes" rows="4" 
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          placeholder="Add notes about this transaction...">${transaction.admin_notes || ''}</textarea>
              </div>
              
              <div class="flex space-x-3">
                <button onclick="approveTransactionWithNotes(${transaction.id})" 
                        class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                  Approve Payment
                </button>
                <button onclick="rejectTransactionWithNotes(${transaction.id})" 
                        class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                  Reject Payment
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function closeTransactionModal() {
      document.getElementById('transaction-modal').classList.add('hidden');
    }

    async function approveTransaction(id) {
      if (!confirm('Are you sure you want to approve this payment?')) {
        return;
      }
      
      try {
        const data = await window.authHelper.post('${API_BASE_URL}/payment-transactions/${id}/approve`);
        showNotification(data.message, 'success');
        loadPendingTransactions();
      } catch (error) {
        console.error('Error approving transaction:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to approve transaction', 'error');
      }
    }

    async function approveTransactionWithNotes(id) {
      const notes = document.getElementById('admin-notes').value;
      
      if (!confirm('Are you sure you want to approve this payment?')) {
        return;
      }
      
      try {
        const data = await window.authHelper.post('${API_BASE_URL}/payment-transactions/${id}/approve`, {
          admin_notes: notes
        });
        showNotification(data.message, 'success');
        closeTransactionModal();
        loadPendingTransactions();
      } catch (error) {
        console.error('Error approving transaction:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to approve transaction', 'error');
      }
    }

    async function rejectTransaction(id) {
      const reason = prompt('Please provide a reason for rejection:');
      if (!reason) return;
      
      try {
        const data = await window.authHelper.post('${API_BASE_URL}/payment-transactions/${id}/reject`, {
          admin_notes: reason
        });
        showNotification(data.message, 'success');
        loadPendingTransactions();
      } catch (error) {
        console.error('Error rejecting transaction:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to reject transaction', 'error');
      }
    }

    async function rejectTransactionWithNotes(id) {
      const notes = document.getElementById('admin-notes').value;
      
      if (!notes.trim()) {
        showNotification('Please provide a reason for rejection', 'error');
        return;
      }
      
      if (!confirm('Are you sure you want to reject this payment?')) {
        return;
      }
      
      try {
        const data = await window.authHelper.post('${API_BASE_URL}/payment-transactions/${id}/reject`, {
          admin_notes: notes
        });
        showNotification(data.message, 'success');
        closeTransactionModal();
        loadPendingTransactions();
      } catch (error) {
        console.error('Error rejecting transaction:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to reject transaction', 'error');
      }
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
      }`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }
    
    // Payment System Configuration Functions
    async function loadPaymentSystemConfig() {
      try {
        const response = await safeApiCall('${API_BASE_URL}/admin/payment-system-config');
        if (response && response.success) {
          const config = response.config;
          
          // Set payment mode
          const isManualMode = config.manual_payment_enabled === 'true';
          document.querySelector(`input[name="paymentMode"][value="${isManualMode ? 'manual' : 'escrow'}"]`).checked = true;
          
          // Set African Deals Domain details
          document.getElementById('add-mobile-number').value = config.add_mobile_number || '+250788910639';
          document.getElementById('add-momo-code').value = config.add_momo_code || '*182*8*1* #';
          
          // Set API configurations
          document.getElementById('stripe-enabled').checked = config.stripe_enabled === 'true';
          document.getElementById('stripe-public-key').value = config.stripe_public_key || '';
          document.getElementById('stripe-secret-key').value = config.stripe_secret_key || '';
          
          document.getElementById('mtn-enabled').checked = config.mtn_enabled === 'true';
          document.getElementById('mtn-api-key').value = config.mtn_api_key || '';
          document.getElementById('mtn-user-id').value = config.mtn_user_id || '';
          
          document.getElementById('airtel-enabled').checked = config.airtel_enabled === 'true';
          document.getElementById('airtel-api-key').value = config.airtel_api_key || '';
          document.getElementById('airtel-client-id').value = config.airtel_client_id || '';
          
          document.getElementById('paypal-enabled').checked = config.paypal_enabled === 'true';
          document.getElementById('paypal-client-id').value = config.paypal_client_id || '';
          document.getElementById('paypal-client-secret').value = config.paypal_client_secret || '';
          
          // Update UI based on current mode
          handlePaymentModeChange();
        }
      } catch (error) {
        console.error('Error loading payment system config:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to load payment configuration', 'error');
      }
    }
    
    function handlePaymentModeChange() {
      const manualModeSelected = document.querySelector('input[name="paymentMode"][value="manual"]').checked;
      const manualConfig = document.getElementById('manual-payment-config');
      const apiConfig = document.getElementById('api-payment-config');
      
      if (manualModeSelected) {
        manualConfig.classList.remove('hidden');
        apiConfig.classList.add('hidden');
      } else {
        manualConfig.classList.add('hidden');
        apiConfig.classList.remove('hidden');
      }
    }
    
    async function savePaymentSystemConfig() {
      try {
        const manualModeSelected = document.querySelector('input[name="paymentMode"][value="manual"]').checked;
        
        const configData = {
          manual_payment_enabled: manualModeSelected ? 'true' : 'false',
          escrow_payment_enabled: manualModeSelected ? 'false' : 'true',
          add_mobile_number: document.getElementById('add-mobile-number').value,
          add_momo_code: document.getElementById('add-momo-code').value,
          stripe_enabled: document.getElementById('stripe-enabled').checked ? 'true' : 'false',
          stripe_public_key: document.getElementById('stripe-public-key').value,
          stripe_secret_key: document.getElementById('stripe-secret-key').value,
          mtn_enabled: document.getElementById('mtn-enabled').checked ? 'true' : 'false',
          mtn_api_key: document.getElementById('mtn-api-key').value,
          mtn_user_id: document.getElementById('mtn-user-id').value,
          airtel_enabled: document.getElementById('airtel-enabled').checked ? 'true' : 'false',
          airtel_api_key: document.getElementById('airtel-api-key').value,
          airtel_client_id: document.getElementById('airtel-client-id').value,
          paypal_enabled: document.getElementById('paypal-enabled').checked ? 'true' : 'false',
          paypal_client_id: document.getElementById('paypal-client-id').value,
          paypal_client_secret: document.getElementById('paypal-client-secret').value
        };
        
        const response = await safeApiCall('${API_BASE_URL}/admin/payment-system-config', {
          method: 'PUT',
          body: JSON.stringify(configData)
        });
        
        if (response && response.success) {
          showNotification('Payment system configuration saved successfully', 'success');
          // Reload the page after a short delay to reflect changes
          setTimeout(() => {
            window.location.reload();
          }, 1500);
        } else {
          showNotification(response?.message || 'Failed to save payment configuration', 'error');
        }
      } catch (error) {
        console.error('Error saving payment system config:', error);
                
                // Enhanced error reporting
                if (error) {
                    const errorDetails = {
                        message: error.message || 'Unknown error',
                        stack: error.stack,
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    };
                    
                    console.error('Detailed error information:', errorDetails);
                    
                    // Show user-friendly notification
                    showNotification(
                        error.message || 'An error occurred. Please try again.',
                        'error'
                    );
                }
        showNotification('Failed to save payment configuration', 'error');
      }
    }
  </script>

  <!-- Navigation utilities for this page -->
  <script>
    // Page-specific navigation setup
    document.addEventListener('DOMContentLoaded', function() {
      // Set page type and mode
      document.body.setAttribute('data-page-type', 'admin');
      
      
      
      // Add navigation helpers to existing elements
      enhanceExistingNavigation();
      
      // Setup page-specific navigation
      setupPageNavigation();
    });
    
    function enhanceExistingNavigation() {
      // Add data-route attributes to links that don't have them
      const links = document.querySelectorAll('a[href]:not([data-route])');
      links.forEach(link => {
        const href = link.getAttribute('href');
        if (href && !href.startsWith('http') && !href.startsWith('mailto:') && !href.startsWith('tel:')) {
          const route = getRouteForHref(href);
          if (route) {
            link.setAttribute('data-route', route);
          }
        }
      });
      
      // Add journey actions to buttons
      const buttons = document.querySelectorAll('button, .btn, [role="button"]');
      buttons.forEach(button => {
        const text = button.textContent.toLowerCase();
        
        if (text.includes('add') && text.includes('cart')) {
          button.setAttribute('data-journey-action', 'add-to-cart');
        } else if (text.includes('checkout')) {
          button.setAttribute('data-journey-action', 'proceed-checkout');
        } else if (text.includes('place') && text.includes('order')) {
          button.setAttribute('data-journey-action', 'complete-payment');
        } else if (text.includes('login') || text.includes('sign in')) {
          button.setAttribute('data-quick-nav', 'login');
        } else if (text.includes('logout') || text.includes('sign out')) {
          button.setAttribute('data-quick-nav', 'logout');
        }
      });
    }
    
    function setupPageNavigation() {
      // Page-specific navigation setup
      const pageType = 'admin';
      
      // Add mode indicators if they exist
      const modeIndicators = document.querySelectorAll('.mode-indicator');
      modeIndicators.forEach(indicator => {
        const currentMode = window.navUtils ? window.navUtils.getCurrentMode() : 'marketplace';
        indicator.className = `mode-indicator mode-${currentMode}`;
        indicator.textContent = currentMode === 'marketplace' ? 'Marketplace' : 'Local Market';
      });
      
      // Add quick navigation buttons if they exist
      const homeButtons = document.querySelectorAll('[data-nav="home"], .home-btn');
      homeButtons.forEach(btn => btn.setAttribute('data-quick-nav', 'home'));
      
      const backButtons = document.querySelectorAll('[data-nav="back"], .back-btn');
      backButtons.forEach(btn => btn.setAttribute('data-quick-nav', 'back'));
      
      const dashboardButtons = document.querySelectorAll('[data-nav="dashboard"], .dashboard-btn');
      dashboardButtons.forEach(btn => btn.setAttribute('data-quick-nav', 'dashboard'));
    }
    
    function getRouteForHref(href) {
      // Basic route mapping
      const routeMap = {
        '/': 'home',
        '/public/index.html': 'home',
        '/public/about.html': 'public.about',
        '/public/contact.html': 'public.contact',
        '/public/products.html': 'public.product-list',
        '/public/product-detail.html': 'public.product-detail',
        '/buyer/buyers-home.html': 'buyer.dashboard',
        '/buyer/cart.html': 'buyer.cart',
        '/buyer/checkout.html': 'buyer.checkout',
        '/buyer/orders.html': 'buyer.orders',
        '/seller/dashboard.html': 'seller.dashboard',
        '/seller/add-product.html': 'seller.add-product',
        '/agent/dashboard.html': 'agent.dashboard',
        '/admin/dashboard.html': 'admin.dashboard',
        '/auth/auth-buyer.html': 'auth.login',
        '/auth/auth-seller.html': 'auth.login-seller',
        '/auth/auth-agent.html': 'auth.login-agent',
        '/grocery/local-market-home.html': 'local-market.home',
        '/grocery/cart.html': 'local-market.cart'
      };
      
      return routeMap[href] || null;
    }
    
    // Wait for flexible navigation system to be ready
    window.addEventListener('flexibleNavigationReady', function() {
      console.log('✅ Flexible navigation ready on admin\payment-methods.html');
      
      // Start appropriate journey if needed
      
    });
  
    // Error handling utilities
    function showError(message) {
        console.error('Error:', message);
        if (window.adminAuth && window.adminAuth.showNotification) {
            window.adminAuth.showNotification(message, 'error');
        } else {
            alert('Error: ' + message);
        }
    }

    function showSuccess(message) {
        console.log('Success:', message);
        if (window.adminAuth && window.adminAuth.showNotification) {
            window.adminAuth.showNotification(message, 'success');
        }
    }

    function showLoading(elementId, message = 'Loading...') {
        const element = document.getElementById(elementId);
        if (element) {
            element.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-white/70">${message}</p>
                </div>
            `;
        }
    }
</script>


    </div>
</div>

<script>
// Unified Admin API Integration for payment-methods.html
class AdminAPI {
    constructor() {
        this.baseUrl = '/api/admin';
        this.token = localStorage.getItem('adminToken');
    }
    
    async request(endpoint, options = {}) {
        const url = this.baseUrl + endpoint;
        const config = {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + this.token,
                ...options.headers
            },
            ...options
        };
        
        try {
            showLoading(true);
            const response = await fetch(url, config);
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            showLoading(false);
            return data;
        } catch (error) {
            showLoading(false);
            showError('API Error: ' + error.message);
            throw error;
        }
    }
    
    // Page-specific methods
    
    async getData() {
        return await this.request('/data');
    }
}

// Initialize API
const adminAPI = new AdminAPI();

// Load data when page loads
document.addEventListener('DOMContentLoaded', async function() {
    try {
        await loadPageData();
    } catch (error) {
        console.error('Failed to load page data:', error);
        showError('Failed to load data. Please refresh the page.');
    }
});

async function loadPageData() {
    // Implement page-specific data loading
    console.log('Loading data for payment-methods.html...');
    
    
    // Generic data loading
    console.log('Loading data for payment-methods.html...');
}

function refreshData() {
    loadPageData();
}
</script>
</body>
</html>