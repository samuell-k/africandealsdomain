<!DOCTYPE html>
<html lang="en" class="admin-page">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analytics & Business Intelligence | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="admin-auth-check.js"></script>
    <script src="admin-utils.js"></script>
    <style>
        :root {
            --primary-color: #080b3b;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        .sidebar {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-item {
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid #3b82f6;
        }
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #3b82f6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        .metric-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
        }
        .status-badge {
            @apply px-3 py-1 rounded-full text-xs font-medium;
        }
        .status-up { @apply bg-green-500/20 text-green-400; }
        .status-down { @apply bg-red-500/20 text-red-400; }
        .status-stable { @apply bg-blue-500/20 text-blue-400; }
        .status-warning { @apply bg-yellow-500/20 text-yellow-400; }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-btn {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .tab-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent-color);
        }
        .live-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            display: inline-block;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .real-time-badge {
            background: linear-gradient(45deg, #22c55e, #16a34a);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-weight: 600;
        }
        .trend-up { color: #22c55e; }
        .trend-down { color: #ef4444; }
        .trend-stable { color: #6b7280; }
        .insight-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .insight-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.05);
        }
        .kpi-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: scale(1.02);
        }
        .heat-map {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin: 1rem 0;
        }
        .heat-cell {
            aspect-ratio: 1;
            border-radius: 2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .heat-cell:hover {
            transform: scale(1.1);
        }
        .heat-low { background: rgba(59, 130, 246, 0.3); }
        .heat-medium { background: rgba(59, 130, 246, 0.6); }
        .heat-high { background: rgba(59, 130, 246, 0.9); }
        .funnel-stage {
            background: linear-gradient(90deg, transparent 0%, rgba(59, 130, 246, 0.2) 50%, transparent 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            position: relative;
        }
        .funnel-stage::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            background: linear-gradient(90deg, #3b82f6, transparent);
            border-radius: 8px 0 0 8px;
        }
        .cohort-table {
            overflow-x: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .cohort-cell {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: background-color 0.3s ease;
        }
        .cohort-cell:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .metric-icon {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 12px;
            margin-right: 1rem;
        }
        .forecast-container {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .ai-insight {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .segment-chip {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border-radius: 1rem;
            font-size: 0.75rem;
            margin: 0.125rem;
        }
        .export-btn {
            transition: all 0.3s ease;
        }
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="gradient-bg min-h-screen">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="sidebar w-64 lg:w-80 flex-shrink-0 hidden md:flex flex-col">
            <div class="p-6 border-b border-white/10">
                <h2 class="text-xl font-bold text-white">Admin Panel</h2>
            </div>
            
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <a href="dashboard.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="user-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="manual-payment-approval.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Approval</span>
                </a>
                <a href="payment-credentials.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-wallet"></i>
                    <span>Payment Credentials</span>
                </a>
                <a href="products.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </a>
                <a href="order-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="agents.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-user-tie"></i>
                    <span>Agents</span>
                </a>
                <a href="categories.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tags"></i>
                    <span>Categories</span>
                </a>
                <a href="brands.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-trademark"></i>
                    <span>Brands</span>
                </a>
                <a href="reviews.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-star"></i>
                    <span>Reviews</span>
                </a>
                <a href="sellers.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-store"></i>
                    <span>Sellers</span>
                </a>
                <a href="support-tickets.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Support Tickets</span>
                </a>
                <a href="logs.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-file-alt"></i>
                    <span>System Logs</span>
                </a>
                <a href="promotions.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-tags"></i>
                    <span>Promotions</span>
                </a>
                <a href="cms-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-edit"></i>
                    <span>CMS Management</span>
                </a>
                <a href="notification-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="backup-restore.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-database"></i>
                    <span>Backup & Restore</span>
                </a>
                <a href="security-api.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-shield-alt"></i>
                    <span>Security & API</span>
                </a>
                <a href="performance-analytics.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-line"></i>
                    <span>Performance & Analytics</span>
                </a>
                <a href="system-integrations.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-plug"></i>
                    <span>System Integrations</span>
                </a>
                <a href="file-manager.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-folder-open"></i>
                    <span>File Manager</span>
                </a>
                <a href="email-templates.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-envelope-open-text"></i>
                    <span>Email Templates</span>
                </a>
                <a href="tax-currency-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-coins"></i>
                    <span>Tax & Currency</span>
                </a>
                <a href="shipping-delivery.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-truck"></i>
                    <span>Shipping & Delivery</span>
                </a>
                <a href="import-export.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Import/Export</span>
                </a>
                <a href="inventory-management.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-warehouse"></i>
                    <span>Inventory Management</span>
                </a>
                <a href="customer-support.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-headset"></i>
                    <span>Customer Support</span>
                </a>
                <a href="data-analytics.html" class="nav-item active flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-pie"></i>
                    <span>Data Analytics</span>
                </a>
                <a href="reports.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="settings.html" class="nav-item flex items-center space-x-3 p-3 rounded-lg text-white">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-4 sm:p-6 lg:p-8 overflow-auto">
            
            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2 flex items-center">
                        Data Analytics & Business Intelligence
                        <span class="live-indicator ml-3"></span>
                        <span class="real-time-badge ml-2">Real-Time</span>
                    </h1>
                    <p class="text-white/70">Comprehensive business insights, metrics, and predictive analytics</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                    <button onclick="generateReport()" class="export-btn bg-green-500 hover:bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-file-export mr-2"></i>Export Report
                    </button>
                    <button onclick="scheduleReport()" class="export-btn bg-blue-500 hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-clock mr-2"></i>Schedule
                    </button>
                    <button onclick="refreshData()" class="export-btn bg-purple-500 hover:bg-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg transition text-sm flex items-center justify-center">
                        <i class="fas fa-refresh mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <!-- Time Range Selector -->
            <div class="glass-morphism rounded-xl p-4 mb-6">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="setTimeRange('24h')" class="time-range-btn bg-blue-500/20 text-blue-400 px-3 py-2 rounded-lg text-sm border border-blue-500/30">
                            Last 24h
                        </button>
                        <button onclick="setTimeRange('7d')" class="time-range-btn bg-white/10 text-white/70 px-3 py-2 rounded-lg text-sm border border-white/20">
                            Last 7 days
                        </button>
                        <button onclick="setTimeRange('30d')" class="time-range-btn bg-white/10 text-white/70 px-3 py-2 rounded-lg text-sm border border-white/20">
                            Last 30 days
                        </button>
                        <button onclick="setTimeRange('90d')" class="time-range-btn bg-white/10 text-white/70 px-3 py-2 rounded-lg text-sm border border-white/20">
                            Last 90 days
                        </button>
                        <button onclick="setTimeRange('1y')" class="time-range-btn bg-white/10 text-white/70 px-3 py-2 rounded-lg text-sm border border-white/20">
                            Last Year
                        </button>
                    </div>
                    <div class="flex space-x-2">
                        <input type="date" id="start-date" class="form-input px-3 py-2 rounded-lg text-sm">
                        <input type="date" id="end-date" class="form-input px-3 py-2 rounded-lg text-sm">
                        <button onclick="applyCustomRange()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm">
                            Apply
                        </button>
                    </div>
                </div>
            </div>

            <!-- Key Metrics -->
            <div class="grid grid-cols-1 lg:grid-cols-6 gap-4 sm:gap-6 mb-6">
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('revenue')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Total Revenue</h3>
                        <div class="metric-icon bg-green-500/20 text-green-400">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="total-revenue">$2.4M</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-up">+12.5%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
                
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('orders')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Total Orders</h3>
                        <div class="metric-icon bg-blue-500/20 text-blue-400">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="total-orders">15.6K</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-up">+8.3%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
                
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('customers')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Active Customers</h3>
                        <div class="metric-icon bg-purple-500/20 text-purple-400">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="active-customers">8.9K</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-up">+15.7%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
                
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('aov')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Avg Order Value</h3>
                        <div class="metric-icon bg-yellow-500/20 text-yellow-400">
                            <i class="fas fa-receipt"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="avg-order-value">$156</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-up">+3.2%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
                
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('conversion')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Conversion Rate</h3>
                        <div class="metric-icon bg-red-500/20 text-red-400">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="conversion-rate">3.4%</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-down">-0.8%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
                
                <div class="metric-card glass-morphism rounded-xl p-4 sm:p-6" onclick="drillDown('traffic')">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-white/70 text-sm">Website Traffic</h3>
                        <div class="metric-icon bg-orange-500/20 text-orange-400">
                            <i class="fas fa-eye"></i>
                        </div>
                    </div>
                    <p class="text-white text-2xl font-bold" id="website-traffic">458K</p>
                    <div class="flex items-center space-x-2 mt-2">
                        <span class="status-badge status-up">+22.1%</span>
                        <span class="text-white/60 text-xs">vs last period</span>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="flex flex-wrap gap-2 mb-6">
                <div class="tab-btn active" data-tab="overview" onclick="switchTab('overview')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-chart-pie"></i>
                        <span class="text-white font-medium">Overview</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="sales" onclick="switchTab('sales')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-chart-line"></i>
                        <span class="text-white font-medium">Sales Analytics</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="customers" onclick="switchTab('customers')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-users-cog"></i>
                        <span class="text-white font-medium">Customer Analytics</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="products" onclick="switchTab('products')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-box-open"></i>
                        <span class="text-white font-medium">Product Analytics</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="marketing" onclick="switchTab('marketing')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-bullhorn"></i>
                        <span class="text-white font-medium">Marketing Analytics</span>
                    </div>
                </div>
                <div class="tab-btn" data-tab="forecasting" onclick="switchTab('forecasting')">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-crystal-ball"></i>
                        <span class="text-white font-medium">AI Forecasting</span>
                    </div>
                </div>
            </div>

            <!-- Tab Contents -->
            
            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    
                    <!-- Revenue Chart -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Revenue Trend</h3>
                        <canvas id="revenue-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Top Performing Products -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Top Performing Products</h3>
                        <div id="top-products-analytics" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Traffic Sources -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Traffic Sources</h3>
                        <canvas id="traffic-sources-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Recent AI Insights -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">AI-Powered Insights</h3>
                        <div id="ai-insights-container" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Analytics Tab -->
            <div id="sales-tab" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    
                    <!-- Sales Funnel -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Sales Funnel</h3>
                        <div id="sales-funnel" class="space-y-2">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Sales by Category -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Sales by Category</h3>
                        <canvas id="sales-category-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Revenue Breakdown -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Revenue Breakdown</h3>
                        <div id="revenue-breakdown" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Analytics Tab -->
            <div id="customers-tab" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    
                    <!-- Customer Segmentation -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Customer Segmentation</h3>
                        <div id="customer-segments" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Customer Lifetime Value -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Customer Lifetime Value</h3>
                        <canvas id="clv-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Cohort Analysis -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Cohort Retention Analysis</h3>
                        <div id="cohort-analysis" class="cohort-table">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Geographic Distribution -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Geographic Distribution</h3>
                        <canvas id="geographic-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Product Analytics Tab -->
            <div id="products-tab" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    
                    <!-- Product Performance -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Product Performance Matrix</h3>
                        <div id="product-performance-matrix">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Category Trends -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Category Trends</h3>
                        <canvas id="category-trends-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Inventory Health -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Inventory Health Score</h3>
                        <div id="inventory-health" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Price Optimization -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Price Optimization Insights</h3>
                        <div id="price-optimization" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marketing Analytics Tab -->
            <div id="marketing-tab" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    
                    <!-- Campaign Performance -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Campaign Performance</h3>
                        <div id="campaign-performance" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Attribution Analysis -->
                    <div class="chart-container">
                        <h3 class="text-xl font-bold text-white mb-4">Attribution Analysis</h3>
                        <canvas id="attribution-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Email Marketing Metrics -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Email Marketing Metrics</h3>
                        <div id="email-metrics" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Social Media Analytics -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Social Media Analytics</h3>
                        <div id="social-media-analytics" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Forecasting Tab -->
            <div id="forecasting-tab" class="tab-content">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                    
                    <!-- Revenue Forecast -->
                    <div class="forecast-container">
                        <h3 class="text-xl font-bold text-white mb-4">Revenue Forecast (Next 90 Days)</h3>
                        <canvas id="revenue-forecast-chart" class="w-full" style="max-height: 300px;"></canvas>
                    </div>

                    <!-- Demand Forecasting -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Demand Forecasting</h3>
                        <div id="demand-forecast" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Predictive Insights -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Predictive Insights</h3>
                        <div id="predictive-insights" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="glass-morphism rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Risk Assessment</h3>
                        <div id="risk-assessment" class="space-y-3">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // Global variables
    let currentTab = 'overview';
    let currentTimeRange = '24h';
    let charts = {};
    let analyticsData = {};

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ðŸ“Š Data Analytics & Business Intelligence initializing...');
        
        // Check authentication first
        if (!checkAuthentication()) return;
        
        // Load data and initialize charts
        loadAllAnalyticsData();
        setupEventListeners();
        
        console.log('âœ… Data Analytics & Business Intelligence initialized');
    });

    // Check authentication
    function checkAuthentication() {
        const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
        const userRole = localStorage.getItem('userRole');
        
        if (!token) {
            console.log('âŒ No authentication token found');
            window.location.href = '/auth/auth-admin.html';
            return false;
        }
        
        if (userRole !== 'admin') {
            console.log('âŒ Insufficient permissions');
            window.location.href = '/auth/auth-admin.html';
            return false;
        }
        
        console.log('âœ… Authentication verified');
        return true;
    }

    // Setup event listeners
    function setupEventListeners() {
        // Time range buttons
        document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.addEventListener('click', (e) => setTimeRange(e.target.textContent.toLowerCase()));
        });
    }

    // Load all analytics data
    async function loadAllAnalyticsData() {
        try {
            await Promise.all([
                loadRevenueData(),
                loadCustomerData(),
                loadProductData(),
                loadMarketingData(),
                loadAIInsights(),
                initializeCharts()
            ]);
        } catch (error) {
            console.error('âŒ Error loading analytics data:', error);
            showToast('Error loading analytics data', 'error');
        }
    }

    // Load revenue data
    async function loadRevenueData() {
        try {
            console.log('ðŸ’° Loading revenue data...');
            
            // Mock revenue data
            analyticsData.revenue = {
                total: 2400000,
                growth: 12.5,
                monthly: [
                    { month: 'Jan', revenue: 180000, orders: 1200 },
                    { month: 'Feb', revenue: 195000, orders: 1350 },
                    { month: 'Mar', revenue: 210000, orders: 1400 },
                    { month: 'Apr', revenue: 225000, orders: 1520 },
                    { month: 'May', revenue: 240000, orders: 1600 },
                    { month: 'Jun', revenue: 260000, orders: 1750 },
                    { month: 'Jul', revenue: 285000, orders: 1890 },
                    { month: 'Aug', revenue: 320000, orders: 2100 }
                ],
                breakdown: [
                    { category: 'Electronics', amount: 960000, percentage: 40 },
                    { category: 'Clothing', amount: 720000, percentage: 30 },
                    { category: 'Home & Garden', amount: 480000, percentage: 20 },
                    { category: 'Sports', amount: 240000, percentage: 10 }
                ]
            };
            
            renderRevenueBreakdown();
            
        } catch (error) {
            console.error('âŒ Error loading revenue data:', error);
        }
    }

    // Load customer data
    async function loadCustomerData() {
        try {
            console.log('ðŸ‘¥ Loading customer data...');
            
            analyticsData.customers = {
                total: 8900,
                growth: 15.7,
                segments: [
                    { name: 'VIP Customers', count: 890, value: 1200000, ltv: 1348 },
                    { name: 'Regular Buyers', count: 3560, value: 800000, ltv: 224 },
                    { name: 'Occasional Buyers', count: 2670, value: 300000, ltv: 112 },
                    { name: 'New Customers', count: 1780, value: 100000, ltv: 56 }
                ],
                geographic: [
                    { country: 'Rwanda', customers: 3200, revenue: 960000 },
                    { country: 'Kenya', customers: 2100, revenue: 630000 },
                    { country: 'Uganda', customers: 1800, revenue: 540000 },
                    { country: 'Tanzania', customers: 1200, revenue: 180000 },
                    { country: 'Other', customers: 600, revenue: 90000 }
                ],
                cohort: generateCohortData()
            };
            
            renderCustomerSegments();
            renderCohortAnalysis();
            
        } catch (error) {
            console.error('âŒ Error loading customer data:', error);
        }
    }

    // Load product data
    async function loadProductData() {
        try {
            console.log('ðŸ“¦ Loading product data...');
            
            analyticsData.products = {
                topPerforming: [
                    { name: 'iPhone 15 Pro Max', revenue: 450000, units: 890, margin: 28.5 },
                    { name: 'Samsung Galaxy S24', revenue: 380000, units: 1200, margin: 32.1 },
                    { name: 'Nike Air Max 270', revenue: 320000, units: 2100, margin: 45.2 },
                    { name: 'Dell XPS 13', revenue: 280000, units: 150, margin: 22.8 },
                    { name: 'Organic Coffee Beans', revenue: 180000, units: 8900, margin: 65.3 }
                ],
                inventory: {
                    healthy: 78,
                    warning: 15,
                    critical: 7
                },
                trends: [
                    { category: 'Electronics', trend: 12.5, forecast: 'up' },
                    { category: 'Clothing', trend: -3.2, forecast: 'down' },
                    { category: 'Home & Garden', trend: 8.7, forecast: 'up' },
                    { category: 'Sports', trend: 15.3, forecast: 'up' }
                ]
            };
            
            renderTopProducts();
            renderInventoryHealth();
            renderPriceOptimization();
            
        } catch (error) {
            console.error('âŒ Error loading product data:', error);
        }
    }

    // Load marketing data
    async function loadMarketingData() {
        try {
            console.log('ðŸ“¢ Loading marketing data...');
            
            analyticsData.marketing = {
                campaigns: [
                    { name: 'Summer Sale 2025', roi: 385, spend: 25000, revenue: 96250, clicks: 45600, conversions: 1520 },
                    { name: 'Back to School', roi: 420, spend: 18000, revenue: 75600, clicks: 32400, conversions: 1180 },
                    { name: 'Black Friday Prep', roi: 520, spend: 35000, revenue: 182000, clicks: 78900, conversions: 2890 },
                    { name: 'New Year Launch', roi: 280, spend: 12000, revenue: 33600, clicks: 18700, conversions: 650 }
                ],
                channels: [
                    { name: 'Google Ads', traffic: 145600, conversions: 4950, cost: 28000 },
                    { name: 'Facebook Ads', traffic: 89300, conversions: 2890, cost: 18500 },
                    { name: 'Instagram Ads', traffic: 67800, conversions: 1980, cost: 15200 },
                    { name: 'Email Marketing', traffic: 34200, conversions: 2340, cost: 2800 }
                ],
                email: {
                    delivered: 145000,
                    opened: 43500,
                    clicked: 8700,
                    converted: 1740
                },
                social: {
                    facebook: { followers: 25600, engagement: 4.2, reach: 189000 },
                    instagram: { followers: 18900, engagement: 6.8, reach: 156000 },
                    twitter: { followers: 12300, engagement: 2.1, reach: 67000 }
                }
            };
            
            renderCampaignPerformance();
            renderEmailMetrics();
            renderSocialMediaAnalytics();
            
        } catch (error) {
            console.error('âŒ Error loading marketing data:', error);
        }
    }

    // Load AI insights
    async function loadAIInsights() {
        try {
            console.log('ðŸ¤– Loading AI insights...');
            
            analyticsData.ai = {
                insights: [
                    {
                        type: 'opportunity',
                        title: 'Revenue Optimization Opportunity',
                        message: 'Electronics category shows 23% higher conversion rates on weekends. Consider increasing weekend promotions.',
                        impact: 'high',
                        confidence: 94
                    },
                    {
                        type: 'warning',
                        title: 'Inventory Risk Alert',
                        message: 'Nike Air Max 270 inventory will be depleted in 8 days based on current sales velocity.',
                        impact: 'medium',
                        confidence: 87
                    },
                    {
                        type: 'trend',
                        title: 'Customer Behavior Trend',
                        message: 'Mobile checkout completion rate improved 15% after recent UX updates.',
                        impact: 'positive',
                        confidence: 91
                    },
                    {
                        type: 'prediction',
                        title: 'Seasonal Demand Forecast',
                        message: 'Home & Garden category expected to surge 45% in next 30 days based on historical patterns.',
                        impact: 'high',
                        confidence: 88
                    }
                ],
                forecasts: {
                    revenue: {
                        next30days: 890000,
                        next60days: 1780000,
                        next90days: 2670000,
                        confidence: 86
                    },
                    demand: [
                        { product: 'iPhone 15 Pro Max', forecast: 156, confidence: 92 },
                        { product: 'Samsung Galaxy S24', forecast: 234, confidence: 89 },
                        { product: 'Nike Air Max 270', forecast: 445, confidence: 94 },
                        { product: 'Dell XPS 13', forecast: 34, confidence: 78 }
                    ]
                }
            };
            
            renderAIInsights();
            renderDemandForecast();
            renderPredictiveInsights();
            renderRiskAssessment();
            
        } catch (error) {
            console.error('âŒ Error loading AI insights:', error);
        }
    }

    // Initialize charts
    async function initializeCharts() {
        try {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: analyticsData.revenue.monthly.map(d => d.month),
                    datasets: [{
                        label: 'Revenue',
                        data: analyticsData.revenue.monthly.map(d => d.revenue),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: getChartOptions('Revenue ($)')
            });

            // Traffic Sources Chart
            const trafficCtx = document.getElementById('traffic-sources-chart').getContext('2d');
            charts.traffic = new Chart(trafficCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Organic Search', 'Paid Ads', 'Social Media', 'Direct', 'Referral'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#8b5cf6'
                        ]
                    }]
                },
                options: getDoughnutOptions()
            });

            // Sales by Category Chart
            const salesCategoryCtx = document.getElementById('sales-category-chart').getContext('2d');
            charts.salesCategory = new Chart(salesCategoryCtx, {
                type: 'bar',
                data: {
                    labels: analyticsData.revenue.breakdown.map(d => d.category),
                    datasets: [{
                        label: 'Revenue',
                        data: analyticsData.revenue.breakdown.map(d => d.amount),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)'
                    }]
                },
                options: getChartOptions('Revenue ($)')
            });

            // Customer Lifetime Value Chart
            const clvCtx = document.getElementById('clv-chart').getContext('2d');
            charts.clv = new Chart(clvCtx, {
                type: 'radar',
                data: {
                    labels: analyticsData.customers.segments.map(s => s.name),
                    datasets: [{
                        label: 'Customer Lifetime Value',
                        data: analyticsData.customers.segments.map(s => s.ltv),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)'
                    }]
                },
                options: getRadarOptions()
            });

            // Geographic Distribution Chart
            const geoCtx = document.getElementById('geographic-chart').getContext('2d');
            charts.geographic = new Chart(geoCtx, {
                type: 'polarArea',
                data: {
                    labels: analyticsData.customers.geographic.map(g => g.country),
                    datasets: [{
                        data: analyticsData.customers.geographic.map(g => g.customers),
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#8b5cf6'
                        ]
                    }]
                },
                options: getPolarOptions()
            });

            // Category Trends Chart
            const trendsCtx = document.getElementById('category-trends-chart').getContext('2d');
            charts.categoryTrends = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: analyticsData.products.trends.map((trend, index) => ({
                        label: trend.category,
                        data: generateTrendData(trend.trend),
                        borderColor: getColorByIndex(index),
                        fill: false
                    }))
                },
                options: getChartOptions('Growth %')
            });

            // Attribution Analysis Chart
            const attributionCtx = document.getElementById('attribution-chart').getContext('2d');
            charts.attribution = new Chart(attributionCtx, {
                type: 'horizontalBar',
                data: {
                    labels: analyticsData.marketing.channels.map(c => c.name),
                    datasets: [{
                        label: 'Conversions',
                        data: analyticsData.marketing.channels.map(c => c.conversions),
                        backgroundColor: 'rgba(16, 185, 129, 0.8)'
                    }]
                },
                options: getChartOptions('Conversions')
            });

            // Revenue Forecast Chart
            const forecastCtx = document.getElementById('revenue-forecast-chart').getContext('2d');
            charts.forecast = new Chart(forecastCtx, {
                type: 'line',
                data: {
                    labels: ['Current', '30 Days', '60 Days', '90 Days'],
                    datasets: [{
                        label: 'Predicted Revenue',
                        data: [320000, 890000, 1780000, 2670000],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        borderDash: [5, 5]
                    }]
                },
                options: getChartOptions('Revenue ($)')
            });
            
            console.log('âœ… All charts initialized successfully');
            
        } catch (error) {
            console.error('âŒ Error initializing charts:', error);
        }
    }

    // Render functions
    function renderTopProducts() {
        const container = document.getElementById('top-products-analytics');
        
        const productsHTML = analyticsData.products.topPerforming.map((product, index) => `
            <div class="insight-card glass-morphism rounded-lg p-4" onclick="drillDownProduct('${product.name}')">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            ${index + 1}
                        </div>
                        <h4 class="text-white font-medium">${product.name}</h4>
                    </div>
                    <span class="text-green-400 font-bold">$${formatNumber(product.revenue)}</span>
                </div>
                <div class="grid grid-cols-3 gap-2 text-xs">
                    <div>
                        <span class="text-white/50">Units:</span>
                        <p class="text-white font-medium">${formatNumber(product.units)}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Margin:</span>
                        <p class="text-white font-medium">${product.margin}%</p>
                    </div>
                    <div>
                        <span class="text-white/50">Avg Price:</span>
                        <p class="text-white font-medium">$${(product.revenue / product.units).toFixed(0)}</p>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = productsHTML;
    }

    function renderAIInsights() {
        const container = document.getElementById('ai-insights-container');
        
        const insightsHTML = analyticsData.ai.insights.map(insight => `
            <div class="ai-insight" onclick="exploreInsight('${insight.type}')">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 ${getInsightColor(insight.type)}/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-${getInsightIcon(insight.type)} ${getInsightColor(insight.type)}-400"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-white font-medium text-sm mb-1">${insight.title}</h4>
                        <p class="text-white/70 text-xs mb-2">${insight.message}</p>
                        <div class="flex items-center space-x-3 text-xs">
                            <span class="text-${getImpactColor(insight.impact)}-400 font-medium">
                                ${insight.impact.toUpperCase()} IMPACT
                            </span>
                            <span class="text-white/50">
                                ${insight.confidence}% confidence
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = insightsHTML;
    }

    function renderSalesFunnel() {
        const container = document.getElementById('sales-funnel');
        
        const funnelData = [
            { stage: 'Website Visitors', count: 458000, rate: 100 },
            { stage: 'Product Views', count: 156000, rate: 34.1 },
            { stage: 'Add to Cart', count: 45600, rate: 9.9 },
            { stage: 'Checkout Started', count: 18240, rate: 4.0 },
            { stage: 'Orders Completed', count: 15600, rate: 3.4 }
        ];
        
        const funnelHTML = funnelData.map((stage, index) => `
            <div class="funnel-stage" style="width: ${stage.rate}%; margin-left: ${(100 - stage.rate) / 2}%;">
                <div class="flex justify-between items-center">
                    <span class="text-white font-medium text-sm">${stage.stage}</span>
                    <div class="text-right">
                        <span class="text-white font-bold">${formatNumber(stage.count)}</span>
                        <span class="text-white/60 text-xs ml-2">(${stage.rate}%)</span>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = funnelHTML;
    }

    function renderRevenueBreakdown() {
        const container = document.getElementById('revenue-breakdown');
        
        const breakdownHTML = analyticsData.revenue.breakdown.map(item => `
            <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                    <span class="text-white font-medium">${item.category}</span>
                </div>
                <div class="text-right">
                    <div class="text-white font-bold">$${formatNumber(item.amount)}</div>
                    <div class="text-white/60 text-xs">${item.percentage}%</div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = breakdownHTML;
    }

    function renderCustomerSegments() {
        const container = document.getElementById('customer-segments');
        
        const segmentsHTML = analyticsData.customers.segments.map(segment => `
            <div class="kpi-card" onclick="analyzeSegment('${segment.name}')">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="text-white font-semibold">${segment.name}</h4>
                    <div class="segment-chip">${formatNumber(segment.count)} customers</div>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div>
                        <span class="text-white/70">Total Value:</span>
                        <p class="text-white font-bold">$${formatNumber(segment.value)}</p>
                    </div>
                    <div>
                        <span class="text-white/70">Avg LTV:</span>
                        <p class="text-white font-bold">$${segment.ltv}</p>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = segmentsHTML;
    }

    function renderCohortAnalysis() {
        const container = document.getElementById('cohort-analysis');
        const cohortData = analyticsData.customers.cohort;
        
        let tableHTML = '<table class="w-full text-xs"><thead><tr><th class="cohort-cell text-white/70">Cohort</th>';
        
        // Header months
        for (let i = 0; i < 6; i++) {
            tableHTML += `<th class="cohort-cell text-white/70">Month ${i + 1}</th>`;
        }
        tableHTML += '</tr></thead><tbody>';
        
        // Data rows
        cohortData.forEach(cohort => {
            tableHTML += `<tr><td class="cohort-cell text-white font-medium">${cohort.month}</td>`;
            cohort.retention.forEach(rate => {
                const opacity = rate / 100;
                tableHTML += `<td class="cohort-cell text-white" style="background-color: rgba(59, 130, 246, ${opacity})">${rate}%</td>`;
            });
            tableHTML += '</tr>';
        });
        
        tableHTML += '</tbody></table>';
        container.innerHTML = tableHTML;
    }

    function renderCampaignPerformance() {
        const container = document.getElementById('campaign-performance');
        
        const campaignsHTML = analyticsData.marketing.campaigns.map(campaign => `
            <div class="insight-card glass-morphism rounded-lg p-4" onclick="analyzeCampaign('${campaign.name}')">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="text-white font-semibold text-sm">${campaign.name}</h4>
                    <span class="status-badge status-${campaign.roi > 400 ? 'up' : campaign.roi > 300 ? 'stable' : 'warning'}">
                        ${campaign.roi}% ROI
                    </span>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs">
                    <div>
                        <span class="text-white/50">Spend:</span>
                        <p class="text-white font-medium">$${formatNumber(campaign.spend)}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Revenue:</span>
                        <p class="text-white font-medium">$${formatNumber(campaign.revenue)}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Clicks:</span>
                        <p class="text-white font-medium">${formatNumber(campaign.clicks)}</p>
                    </div>
                    <div>
                        <span class="text-white/50">Conversions:</span>
                        <p class="text-white font-medium">${formatNumber(campaign.conversions)}</p>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = campaignsHTML;
    }

    function renderEmailMetrics() {
        const container = document.getElementById('email-metrics');
        const email = analyticsData.marketing.email;
        
        const metricsHTML = `
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div class="text-center p-3 bg-white/5 rounded-lg">
                    <div class="text-white text-lg font-bold">${((email.opened / email.delivered) * 100).toFixed(1)}%</div>
                    <div class="text-white/60 text-xs">Open Rate</div>
                </div>
                <div class="text-center p-3 bg-white/5 rounded-lg">
                    <div class="text-white text-lg font-bold">${((email.clicked / email.opened) * 100).toFixed(1)}%</div>
                    <div class="text-white/60 text-xs">Click Rate</div>
                </div>
                <div class="text-center p-3 bg-white/5 rounded-lg">
                    <div class="text-white text-lg font-bold">${((email.converted / email.clicked) * 100).toFixed(1)}%</div>
                    <div class="text-white/60 text-xs">Conversion Rate</div>
                </div>
                <div class="text-center p-3 bg-white/5 rounded-lg">
                    <div class="text-white text-lg font-bold">${formatNumber(email.delivered)}</div>
                    <div class="text-white/60 text-xs">Delivered</div>
                </div>
            </div>
        `;
        
        container.innerHTML = metricsHTML;
    }

    function renderSocialMediaAnalytics() {
        const container = document.getElementById('social-media-analytics');
        const social = analyticsData.marketing.social;
        
        const socialHTML = `
            <div class="space-y-3">
                ${Object.entries(social).map(([platform, data]) => `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <i class="fab fa-${platform} text-xl text-blue-400"></i>
                            <div>
                                <div class="text-white font-medium capitalize">${platform}</div>
                                <div class="text-white/60 text-xs">${formatNumber(data.followers)} followers</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-white font-bold">${data.engagement}%</div>
                            <div class="text-white/60 text-xs">Engagement</div>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        
        container.innerHTML = socialHTML;
    }

    function renderInventoryHealth() {
        const container = document.getElementById('inventory-health');
        const health = analyticsData.products.inventory;
        
        const healthHTML = `
            <div class="space-y-4">
                <div class="text-center">
                    <div class="text-white/70 text-sm mb-2">Overall Health Score</div>
                    <div class="text-white font-bold text-3xl">${health.healthy}%</div>
                    <div class="text-green-400 text-sm">Healthy</div>
                </div>
                
                <div class="grid grid-cols-3 gap-2 text-sm">
                    <div class="text-center p-3 bg-green-500/20 rounded-lg">
                        <div class="text-green-400 font-bold">${health.healthy}%</div>
                        <div class="text-white/70 text-xs">Healthy</div>
                    </div>
                    <div class="text-center p-3 bg-yellow-500/20 rounded-lg">
                        <div class="text-yellow-400 font-bold">${health.warning}%</div>
                        <div class="text-white/70 text-xs">Warning</div>
                    </div>
                    <div class="text-center p-3 bg-red-500/20 rounded-lg">
                        <div class="text-red-400 font-bold">${health.critical}%</div>
                        <div class="text-white/70 text-xs">Critical</div>
                    </div>
                </div>
                
                <div class="pt-4 border-t border-white/10">
                    <button onclick="viewInventoryDetails()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                        <i class="fas fa-eye mr-2"></i>View Detailed Analysis
                    </button>
                </div>
            </div>
        `;
        
        container.innerHTML = healthHTML;
    }

    function renderPriceOptimization() {
        const container = document.getElementById('price-optimization');
        
        const optimizationHTML = `
            <div class="space-y-3">
                <div class="ai-insight">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-lightbulb text-yellow-400"></i>
                        <span class="text-white font-medium text-sm">Price Optimization Opportunities</span>
                    </div>
                    <p class="text-white/70 text-xs">3 products identified for price adjustments with potential 8.5% revenue increase</p>
                </div>
                
                <div class="ai-insight">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-chart-line text-green-400"></i>
                        <span class="text-white font-medium text-sm">Dynamic Pricing Active</span>
                    </div>
                    <p class="text-white/70 text-xs">12 products using AI-driven dynamic pricing with 15% margin improvement</p>
                </div>
                
                <div class="ai-insight">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                        <span class="text-white font-medium text-sm">Competitive Pricing Alert</span>
                    </div>
                    <p class="text-white/70 text-xs">5 products priced 10%+ above market average - consider adjustment</p>
                </div>
            </div>
        `;
        
        container.innerHTML = optimizationHTML;
    }

    function renderDemandForecast() {
        const container = document.getElementById('demand-forecast');
        
        const demandHTML = analyticsData.ai.forecasts.demand.map(item => `
            <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                <div>
                    <div class="text-white font-medium text-sm">${item.product}</div>
                    <div class="text-white/60 text-xs">${item.confidence}% confidence</div>
                </div>
                <div class="text-right">
                    <div class="text-white font-bold">${item.forecast}</div>
                    <div class="text-white/60 text-xs">units/week</div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = demandHTML;
    }

    function renderPredictiveInsights() {
        const container = document.getElementById('predictive-insights');
        
        const insights = [
            { icon: 'fas fa-trending-up', title: 'Revenue Growth', prediction: 'Q4 revenue expected to exceed targets by 12%', confidence: 89 },
            { icon: 'fas fa-users', title: 'Customer Acquisition', prediction: 'New customer growth rate will increase 18% next month', confidence: 84 },
            { icon: 'fas fa-boxes', title: 'Inventory Optimization', prediction: '23% reduction in overstock risk with current AI recommendations', confidence: 91 }
        ];
        
        const insightsHTML = insights.map(insight => `
            <div class="ai-insight">
                <div class="flex items-start space-x-3">
                    <i class="${insight.icon} text-purple-400"></i>
                    <div>
                        <h5 class="text-white font-medium text-sm mb-1">${insight.title}</h5>
                        <p class="text-white/70 text-xs mb-2">${insight.prediction}</p>
                        <span class="text-purple-400 text-xs">${insight.confidence}% confidence</span>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = insightsHTML;
    }

    function renderRiskAssessment() {
        const container = document.getElementById('risk-assessment');
        
        const risks = [
            { level: 'low', title: 'Market Volatility', description: 'Current market conditions are stable', score: 15 },
            { level: 'medium', title: 'Supply Chain', description: 'Minor delays possible in electronics category', score: 45 },
            { level: 'high', title: 'Seasonal Demand', description: 'Holiday season may cause inventory shortages', score: 75 }
        ];
        
        const risksHTML = risks.map(risk => `
            <div class="ai-insight border-l-4 border-${risk.level === 'low' ? 'green' : risk.level === 'medium' ? 'yellow' : 'red'}-500">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white font-medium text-sm">${risk.title}</span>
                    <span class="status-badge status-${risk.level === 'low' ? 'up' : risk.level === 'medium' ? 'warning' : 'down'}">
                        ${risk.score}% risk
                    </span>
                </div>
                <p class="text-white/70 text-xs">${risk.description}</p>
            </div>
        `).join('');
        
        container.innerHTML = risksHTML;
    }

    // Tab switching
    function switchTab(tab) {
        currentTab = tab;
        
        // Update active tab
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
        
        // Show/hide tab content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(`${tab}-tab`).classList.add('active');

        // Load tab-specific data
        if (tab === 'sales' && !document.getElementById('sales-funnel').innerHTML) {
            renderSalesFunnel();
        }
    }

    // Time range functions
    function setTimeRange(range) {
        currentTimeRange = range;
        
        // Update active button
        document.querySelectorAll('.time-range-btn').forEach(btn => {
            btn.classList.remove('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
            btn.classList.add('bg-white/10', 'text-white/70', 'border-white/20');
        });
        
        event.target.classList.remove('bg-white/10', 'text-white/70', 'border-white/20');
        event.target.classList.add('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
        
        // Refresh data based on time range
        showToast(`Analytics updated for ${range}`, 'success');
    }

    function applyCustomRange() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        
        if (!startDate || !endDate) {
            showToast('Please select both start and end dates', 'warning');
            return;
        }
        
        showToast('Custom date range applied', 'success');
    }

    // Helper functions
    function generateCohortData() {
        return [
            { month: 'Aug 2025', retention: [100, 45, 32, 28, 25, 23] },
            { month: 'Jul 2025', retention: [100, 48, 35, 31, 28, 26] },
            { month: 'Jun 2025', retention: [100, 52, 38, 34, 30, 28] },
            { month: 'May 2025', retention: [100, 49, 36, 32, 29, 27] },
            { month: 'Apr 2025', retention: [100, 46, 33, 29, 26, 24] }
        ];
    }

    function generateTrendData(baseValue) {
        return Array.from({ length: 4 }, (_, i) => baseValue + (Math.random() - 0.5) * 10);
    }

    function getChartOptions(yAxisLabel) {
        return {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                y: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    title: {
                        display: true,
                        text: yAxisLabel,
                        color: '#ffffff'
                    }
                }
            }
        };
    }

    function getDoughnutOptions() {
        return {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: { color: '#ffffff' }
                }
            }
        };
    }

    function getRadarOptions() {
        return {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                r: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                    angleLines: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            }
        };
    }

    function getPolarOptions() {
        return {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                r: {
                    ticks: { color: '#ffffff' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            }
        };
    }

    function getColorByIndex(index) {
        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
        return colors[index % colors.length];
    }

    function getInsightColor(type) {
        const colors = {
            'opportunity': 'text-green-500',
            'warning': 'text-yellow-500',
            'trend': 'text-blue-500',
            'prediction': 'text-purple-500'
        };
        return colors[type] || 'text-gray-500';
    }

    function getInsightIcon(type) {
        const icons = {
            'opportunity': 'lightbulb',
            'warning': 'exclamation-triangle',
            'trend': 'chart-line',
            'prediction': 'crystal-ball'
        };
        return icons[type] || 'info-circle';
    }

    function getImpactColor(impact) {
        const colors = {
            'high': 'text-red-500',
            'medium': 'text-yellow-500',
            'low': 'text-green-500',
            'positive': 'text-green-500'
        };
        return colors[impact] || 'text-gray-500';
    }

    function formatNumber(num) {
        if (num >= 1000000) {
            return (num / 1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K';
        }
        return num.toString();
    }

    function showToast(message, type = 'info') {
        console.log(`[${type.toUpperCase()}] ${message}`);
        
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg text-white ${
            type === 'success' ? 'bg-green-500' : 
            type === 'error' ? 'bg-red-500' : 
            type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
        }`;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    // Make functions globally available
    window.switchTab = switchTab;
    window.setTimeRange = setTimeRange;
    window.applyCustomRange = applyCustomRange;
    window.drillDown = (metric) => showToast(`Drilling down into ${metric} analytics`, 'info');
    window.drillDownProduct = (product) => showToast(`Analyzing ${product} performance`, 'info');
    window.exploreInsight = (type) => showToast(`Exploring ${type} insights`, 'info');
    window.analyzeSegment = (segment) => showToast(`Analyzing ${segment}`, 'info');
    window.analyzeCampaign = (campaign) => showToast(`Analyzing ${campaign} campaign`, 'info');
    window.viewInventoryDetails = () => showToast('Opening inventory analysis', 'info');
    window.generateReport = () => showToast('Generating comprehensive analytics report', 'success');
    window.scheduleReport = () => showToast('Report scheduling opened', 'info');
    window.refreshData = () => { loadAllAnalyticsData(); showToast('Analytics data refreshed', 'success'); };

</script>

</body>
</html>