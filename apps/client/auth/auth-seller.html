<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Auth | ADD Physical Products</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .brand { color: #0e2038; }
    .brand-bg { background: linear-gradient(120deg, #0e2038 0%, #23325c 100%); }
    .icon-bg { background: #f3f4f6; border-radius: 1rem; }
    @media (max-width: 900px) {
      .auth-cols { flex-direction: column; }
      .auth-left, .auth-right { width: 100% !important; min-width: 0; }
      .auth-left { border-radius: 1.5rem 1.5rem 0 0; }
      .auth-right { border-radius: 0 0 1.5rem 1.5rem; }
    }
    .tab-btn { transition: background 0.2s, color 0.2s; }
    .tab-btn.active { background: #0e2038; color: #fff; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-50">
  <main class="w-full max-w-4xl mx-auto flex auth-cols rounded-2xl shadow-lg overflow-hidden bg-white" style="min-height: 600px;">
    <!-- LEFT: Welcome, Illustration, Icon -->
    <section class="auth-left flex flex-col justify-center items-center p-8 gap-6" style="width:44%; min-width:320px; background:linear-gradient(135deg,#0e2038 0%,#1a2e4a 50%,#314b75 100%);">
      <div class="icon-bg p-4 mb-2 flex items-center justify-center" aria-label="Seller Icon">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none"><circle cx="32" cy="32" r="32" fill="#e5e9f2"/><rect x="16" y="32" width="32" height="20" rx="6" fill="#fff" stroke="#0e2038" stroke-width="2"/><rect x="26" y="32" width="12" height="6" rx="2" fill="#0e2038" opacity=".15"/></svg>
        <div class="w-28 h-28 flex items-center justify-center relative z-10">
          <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_1pxqjqps.json" background="transparent" speed="1" style="width:100px;height:100px;" loop autoplay></lottie-player>
        </div>
      </div>
      <h2 class="text-2xl font-extrabold text-white mb-2 text-center">Seller Portal</h2>
      <p class="text-base text-center text-white">Sign in or register to manage your products and orders.</p>
      <svg width="120" height="80" viewBox="0 0 120 80" fill="none" class="mt-4" aria-hidden="true"><ellipse cx="60" cy="70" rx="50" ry="8" fill="#e5e9f2"/><rect x="35" y="30" width="50" height="30" rx="8" fill="#fff" stroke="#0e2038" stroke-width="2"/><rect x="50" y="40" width="20" height="10" rx="2" fill="#0e2038" opacity=".15"/></svg>
    </section>
    <!-- RIGHT: Form -->
    <section class="auth-right flex flex-col justify-center items-center p-8 gap-4" style="width:56%; min-width:320px; background:#fff;">
      <div class="flex items-center gap-2 mb-4">
        <img src="/public/images/logo.png" alt="ADD Physical Product Logo" class="h-12 w-12 rounded-xl shadow bg-white" />
        <span class="font-extrabold text-xl tracking-tight brand">ADD Physical Products</span>
      </div>
      <div class="flex gap-2 mb-4 w-full">
        <button id="tab-signin" class="tab-btn flex-1 py-2 rounded font-bold active">Sign In</button>
        <button id="tab-signup" class="tab-btn flex-1 py-2 rounded font-bold">Sign Up</button>
      </div>
      <div id="seller-signin-form" class="w-full">
        <h1 class="text-xl font-bold mb-2 brand">Seller Sign In</h1>
        <div id="seller-signin-error" class="text-red-600 text-sm mb-2" style="display:none;"></div>
        <form id="seller-signin-ajax" class="flex flex-col gap-4" autocomplete="on" method="POST" action="#">
          <label for="email" class="brand font-semibold">Email</label>
          <input id="email" name="email" type="email" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Please enter a valid email address" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <label for="password" class="brand font-semibold">Password</label>
          <div class="relative">
            <input id="password" name="password" type="password" required pattern=".{8,}" title="Password must be at least 8 characters long" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none w-full pr-10" />
            <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center" onclick="showNotification('Feature in development', 'info')">
              <svg id="eye-icon" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z' />
                <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z' />
              </svg>
            </button>
          </div>
          <button id="seller-signin-btn" type="submit" class="w-full py-2 rounded font-bold mt-2 flex items-center justify-center gap-2" style="background:linear-gradient(90deg,#0e2038 0%,#23325c 100%);color:#fff;">
            <span>Sign In</span>
            <svg id="seller-signin-spinner" class="animate-spin h-5 w-5 text-white ml-2" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
          </button>
          <div class="mt-3 text-center">
            <a href="/auth/forgot-password.html" class="text-sm brand hover:underline">Forgot your password?</a>
          </div>
        </form>
      </div>
      <div id="seller-signup-form" class="w-full hidden">
        <h1 class="text-xl font-bold mb-2 brand">Seller Sign Up</h1>
        <div id="seller-signup-error" class="text-red-600 text-sm mb-2" style="display:none;"></div>
        <form id="seller-signup-ajax" class="flex flex-col gap-4" autocomplete="on" method="POST" action="#">
          <label for="signup-name" class="brand font-semibold">Full Name</label>
          <input id="signup-name" name="name" type="text" required pattern="[A-Za-z\s]{2,50}" title="Name must be 2-50 characters, letters and spaces only" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <label for="signup-email" class="brand font-semibold">Email</label>
          <input id="signup-email" name="email" type="email" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Please enter a valid email address" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <label for="signup-phone" class="brand font-semibold">Phone</label>
          <input id="signup-phone" name="phone" type="text" required pattern="[+]?[0-9]{10,15}" title="Please enter a valid phone number (10-15 digits)" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <label for="signup-password" class="brand font-semibold">Password</label>
          <input id="signup-password" name="password" type="password" required pattern=".{8,}" title="Password must be at least 8 characters long" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <label for="signup-confirm" class="brand font-semibold">Confirm Password</label>
          <input id="signup-confirm" name="confirm" type="password" required pattern=".{8,}" title="Password must be at least 8 characters long" class="px-4 py-2 border border-[#0e2038] rounded focus:ring-2 focus:ring-[#0e2038] outline-none" />
          <button id="seller-signup-btn" type="submit" class="w-full py-2 rounded font-bold mt-2 flex items-center justify-center gap-2" style="background:linear-gradient(90deg,#0e2038 0%,#23325c 100%);color:#fff;">
            <span>Sign Up</span>
            <svg id="seller-signup-spinner" class="animate-spin h-5 w-5 text-white ml-2" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
          </button>
        </form>
      </div>
      <div class="mt-4 text-center">
        <a href="/" class="brand hover:underline">Back to Home</a>
      </div>
    </section>
  </main>
  <script defer src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <script>
  // Tab toggle
  const tabSignin = document.getElementById('tab-signin');
  const tabSignup = document.getElementById('tab-signup');
  const signinForm = document.getElementById('seller-signin-form');
  const signupForm = document.getElementById('seller-signup-form');
  tabSignin.onclick = function() {
    tabSignin.classList.add('active');
    tabSignup.classList.remove('active');
    signinForm.classList.remove('hidden');
    signupForm.classList.add('hidden');
  };
  tabSignup.onclick = function() {
    tabSignup.classList.add('active');
    tabSignin.classList.remove('active');
    signupForm.classList.remove('hidden');
    signinForm.classList.add('hidden');
  };
  // Normalize storage keys early
  (function normalizeAuthStorage(){
    const token = localStorage.getItem('authToken') || localStorage.getItem('token');
    const userStr = localStorage.getItem('userData') || localStorage.getItem('user');
    if (token) { localStorage.setItem('authToken', token); localStorage.setItem('token', token); }
    if (userStr) { localStorage.setItem('userData', userStr); localStorage.setItem('user', userStr); }
  })();


document.getElementById('seller-signin-ajax').onsubmit = async function(e) {
  e.preventDefault();
  const btn = document.getElementById('seller-signin-btn');
  const spinner = document.getElementById('seller-signin-spinner');
  const errorDiv = document.getElementById('seller-signin-error');
  errorDiv.style.display = 'none';
  btn.disabled = true;
  spinner.style.display = '';
  btn.querySelector('span').textContent = 'Signing In...';
  const email = this.email.value.trim();
  const password = this.password.value;
  try {
    const res = await fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Login failed');
    if (data.user && data.user.role !== 'seller') throw new Error('Not a seller account');
    // Save token and user to localStorage for session persistence
    localStorage.setItem('authToken', data.token);
    localStorage.setItem('userData', JSON.stringify(data.user));
    
    // Mark as fresh login to prevent auth loops
    sessionStorage.setItem('freshLogin', 'true');
    sessionStorage.setItem('loginTimestamp', Date.now().toString());
    
    btn.querySelector('span').textContent = 'Success! Redirecting...';
    setTimeout(() => { window.location.href = '/seller/dashboard.html'; }, 800);
  } catch (err) {
    errorDiv.textContent = err.message;
    errorDiv.style.display = '';
    btn.disabled = false;
    spinner.style.display = 'none';
    btn.querySelector('span').textContent = 'Sign In';
  }
};

// AJAX Seller Sign Up
document.getElementById('seller-signup-ajax').onsubmit = async function(e) {
  e.preventDefault();
  const btn = document.getElementById('seller-signup-btn');
  const spinner = document.getElementById('seller-signup-spinner');
  const errorDiv = document.getElementById('seller-signup-error');
  errorDiv.style.display = 'none';
  btn.disabled = true;
  spinner.style.display = '';
  btn.querySelector('span').textContent = 'Signing Up...';
  const name = this["name"].value.trim();
  const email = this["email"].value.trim();
  const phone = this["phone"].value.trim();
  const password = this["password"].value;
  const confirm = this["confirm"].value;
  if (password !== confirm) {
    errorDiv.textContent = 'Passwords do not match.';
    errorDiv.style.display = '';
    btn.disabled = false;
    spinner.style.display = 'none';
    btn.querySelector('span').textContent = 'Sign Up';
    return;
  }
  try {
    const res = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, password, phone, role: 'seller' })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Registration failed');
    // Save token and user to localStorage for session persistence
    localStorage.setItem('authToken', data.token);
    localStorage.setItem('userData', JSON.stringify(data.user));
    
    // Mark as fresh login to prevent auth loops
    sessionStorage.setItem('freshLogin', 'true');
    sessionStorage.setItem('loginTimestamp', Date.now().toString());
    
    btn.querySelector('span').textContent = 'Success! Redirecting...';
    setTimeout(() => { window.location.href = '/seller/dashboard.html'; }, 800);
  } catch (err) {
    errorDiv.textContent = err.message;
    errorDiv.style.display = '';
    btn.disabled = false;
    spinner.style.display = 'none';
    btn.querySelector('span').textContent = 'Sign Up';
  }
};
  // Password visibility toggle (login)
  document.getElementById('toggle-password').onclick = function() {
    const pwInput = document.getElementById('password');
    pwInput.type = pwInput.type === 'password' ? 'text' : 'password';
    document.getElementById('eye-icon').innerHTML = pwInput.type === 'password'
      ? `<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 12a3 3 0 11-6 0 3 3 0 016 0z' /><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z' />`
      : `<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.956 9.956 0 012.293-3.95M6.873 6.876A9.956 9.956 0 0112 5c4.478 0 8.268 2.943 9.542 7a9.956 9.956 0 01-4.293 5.95M15 12a3 3 0 11-6 0 3 3 0 016 0z' />`;
  };
  </script>

<script>
// Utility Functions for Enhanced Functionality
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'warning' ? 'bg-yellow-500 text-black' :
        'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Generic search handlers
function handleProductSearch(query) {
    console.log('Searching products:', query);
    if (query.length > 2) {
        // Implement product search logic
        showNotification('Searching for: ' + query, 'info');
    }
}

function handleSellerSearch(query) {
    console.log('Searching sellers:', query);
    if (query.length > 2) {
        showNotification('Searching sellers: ' + query, 'info');
    }
}

function handleAgentSearch(query) {
    console.log('Searching agents:', query);
    if (query.length > 2) {
        showNotification('Searching agents: ' + query, 'info');
    }
}

function handleOrderSearch(query) {
    console.log('Searching orders:', query);
    if (query.length > 2) {
        showNotification('Searching orders: ' + query, 'info');
    }
}

function handleUserSearch(query) {
    console.log('Searching users:', query);
    if (query.length > 2) {
        showNotification('Searching users: ' + query, 'info');
    }
}

// Generic form handlers
function handleSave() {
    showNotification('Save functionality will be implemented soon', 'info');
}

function handleEdit() {
    showNotification('Edit functionality will be implemented soon', 'info');
}

function handleDelete() {
    if (confirm('Are you sure you want to delete this item?')) {
        showNotification('Delete functionality will be implemented soon', 'info');
    }
}

function handleCancel() {
    if (confirm('Are you sure you want to cancel? Unsaved changes will be lost.')) {
        history.back();
    }
}
</script>
</body>
</html> 