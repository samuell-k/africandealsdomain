<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Market | African Deals Domain</title>
  <style id="critical-css">*,*::before,*::after{box-sizing: border-box} html{line-height: 1.15;-webkit-text-size-adjust: 100%} body{margin: 0;font-family: 'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size: 16px;line-height: 1.6;color: #1f2937;background-color: #f9fafb} .container{max-width: 1200px;margin: 0 auto;padding: 0 1rem} .flex{display: flex} .grid{display: grid} .hidden{display: none} .sr-only{position: absolute;width: 1px;height: 1px;padding: 0;margin: -1px;overflow: hidden;clip: rect(0,0,0,0);white-space: nowrap;border: 0} header{position: sticky;top: 0;z-index: 50;background: rgba(255,255,255,0.95);backdrop-filter: blur(10px);border-bottom: 1px solid #e5e7eb;box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1)} .logo{height: 3rem;width: 3rem;border-radius: 0.75rem;box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);transition: transform 0.3s ease} .logo:hover{transform: scale(1.1)} .brand-text{font-weight: 800;font-size: 1.5rem;background: linear-gradient(135deg,#0e2038 0%,#23325c 50%,#1e3a8a 100%);-webkit-background-clip: text;-webkit-text-fill-color: transparent;background-clip: text} .loading-shimmer{background: linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size: 200% 100%;animation: shimmer 1.5s infinite} @keyframes shimmer{0%{background-position: -200% 0} 100%{background-position: 200% 0} } .fade-in{animation: fadeIn 0.6s ease-out} @keyframes fadeIn{from{opacity: 0} to{opacity: 1} } .btn{display: inline-flex;align-items: center;justify-content: center;padding: 0.5rem 1rem;border-radius: 0.375rem;font-weight: 500;text-decoration: none;transition: all 0.2s ease;cursor: pointer;border: none} .btn-primary{background: linear-gradient(135deg,#3b82f6,#1d4ed8);color: white} .btn-primary:hover{background: linear-gradient(135deg,#2563eb,#1e40af);transform: translateY(-1px);box-shadow: 0 4px 12px rgba(59,130,246,0.4)} input,select,textarea{width: 100%;padding: 0.75rem;border: 1px solid #d1d5db;border-radius: 0.375rem;font-size: 1rem;transition: border-color 0.2s ease} input:focus,select:focus,textarea:focus{outline: none;border-color: #3b82f6;box-shadow: 0 0 0 3px rgba(59,130,246,0.1)} @media (max-width: 768px){.container{padding: 0 0.5rem} .brand-text{font-size: 1.25rem} .btn{padding: 0.5rem 0.75rem;font-size: 0.875rem} } .below-fold{opacity: 0;transition: opacity 0.3s ease} .lazy-load{opacity: 0;transition: opacity 0.3s ease} .hero-section{background: linear-gradient(135deg,#0e2038 0%,#23325c 50%,#1e3a8a 100%);color: white;padding: 4rem 0;text-align: center} .hero-title{font-size: 3rem;font-weight: 800;margin-bottom: 1rem;line-height: 1.2} .hero-subtitle{font-size: 1.25rem;opacity: 0.9;margin-bottom: 2rem} .search-bar{max-width: 600px;margin: 0 auto;position: relative} .search-input{width: 100%;padding: 1rem 3rem 1rem 1rem;border: none;border-radius: 0.5rem;font-size: 1.125rem;box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1)} .category-grid{display: grid;grid-template-columns: repeat(auto-fit,minmax(200px,1fr));gap: 1.5rem;margin: 3rem 0} .category-card{background: white;border-radius: 0.75rem;padding: 1.5rem;text-align: center;box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);transition: transform 0.2s ease,box-shadow 0.2s ease} .category-card:hover{transform: translateY(-4px);box-shadow: 0 8px 25px -5px rgba(0,0,0,0.15)} @media (max-width: 768px){.hero-title{font-size: 2rem} .hero-subtitle{font-size: 1rem} .category-grid{grid-template-columns: repeat(auto-fit,minmax(150px,1fr));gap: 1rem} } .dashboard-header{background: white;border-bottom: 1px solid #e5e7eb;padding: 1.5rem 0} .dashboard-nav{display: flex;gap: 2rem;margin: 1rem 0} .nav-item{padding: 0.75rem 1.5rem;border-radius: 0.5rem;text-decoration: none;color: #6b7280;font-weight: 500;transition: all 0.2s ease} .nav-item.active{background: #3b82f6;color: white} .nav-item:hover{background: #f3f4f6;color: #374151} .stats-grid{display: grid;grid-template-columns: repeat(auto-fit,minmax(250px,1fr));gap: 1.5rem;margin: 2rem 0} .stat-card{background: white;border-radius: 0.75rem;padding: 1.5rem;box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1)} .stat-value{font-size: 2rem;font-weight: 700;color: #1f2937} .stat-label{color: #6b7280;font-size: 0.875rem;margin-top: 0.5rem}</style>
  <link rel="icon" href="/public/images/logo.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/public/css/tailwind.css">
  <link rel="stylesheet" href="/shared/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>window.__LEAFLET_ENABLED__ = false;</script>
  <!-- Inline auth utilities to avoid external file errors -->
  <script>
    // Auth utilities inline
    function getAuthToken() {
      return localStorage.getItem('authToken') || localStorage.getItem('token');
    }
    
    function isAuthenticated() {
      const token = getAuthToken();
      return token && token !== 'null' && token !== 'undefined';
    }
    
    function redirectToLogin() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('token');
      window.location.href = '/public/login.html';
    }
    
    // Mode switcher inline
    window.modeSwitcher = {
      switchMode: function(mode) {
        if (mode === 'physical') {
          window.location.href = '/buyer/buyers-home.html';
        } else if (mode === 'grocery') {
          window.location.href = '/grocery/local-market-home-signed.html';
        }
      }
    };
  </script>
  <style>
    /* Enhanced Animations */
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .slide-up { animation: slideUp 0.4s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .menu-item-enter { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    
    .bounce-in { animation: bounceIn 0.6s ease-out; }
    @keyframes bounceIn { 
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    /* Layout Improvements */
    .sticky-cart { position: sticky; top: 6rem; }
    #map-preview { height: 200px; min-height: 200px; }
    
    /* Enhanced Product Cards */
    .product-card { 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid transparent;
    }
    .product-card:hover { 
      transform: translateY(-8px) scale(1.02); 
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
      border-color: #10b981;
    }
    
    /* Loading States */
    .loading-spinner { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    .skeleton { 
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    
    /* Glass Effects */
    .glass { 
      background: rgba(255, 255, 255, 0.95); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .glass-dark { 
      background: rgba(0, 0, 0, 0.7); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Gradient Backgrounds */
    .gradient-bg { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .gradient-blue { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
    .gradient-purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
    
    /* Enhanced Buttons */
    .btn-floating {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    .btn-floating:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }
    
    /* Enhanced Form Elements */
    .form-input {
      transition: all 0.2s ease;
      border: 2px solid #e5e7eb;
    }
    .form-input:focus {
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      transform: translateY(-1px);
    }
    
    /* Tab Enhancements */
    .tab-btn {
      position: relative;
      overflow: hidden;
    }
    .tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .tab-btn:hover::before {
      left: 100%;
    }
    
    /* Mobile Optimizations */
    @media (max-width: 768px) {
      .product-card:hover {
        transform: translateY(-4px) scale(1.01);
      }
      
      .btn-floating {
        bottom: 1rem;
        right: 1rem;
        width: 48px;
        height: 48px;
      }
      
      #map-preview {
        height: 150px;
        min-height: 150px;
      }
      
      .glass {
        backdrop-filter: blur(8px);
      }
      
      /* Ensure tabs are responsive */
      .tab-btn {
        min-width: 80px;
        font-size: 0.875rem;
      }
      
      .tab-btn span {
        display: inline !important;
      }
    }
    
    /* Navigation Fixes */
    .tab-btn.active {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
      color: white !important;
    }
    
    /* Ensure proper spacing */
    body {
      padding-top: 0;
    }
    
    /* Fix any layout issues */
    .max-w-8xl {
      max-width: 1280px;
    }
    
    /* Cart Badge */
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* Enhanced Modals */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .modal-content {
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from { opacity: 0; transform: translateY(-50px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    /* Status Indicators */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    .status-dot.online { background: #10b981; }
    .status-dot.offline { background: #ef4444; }
    .status-dot.busy { background: #f59e0b; }
    
    /* Enhanced Scrollbars */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  </style>

      <script>
        // Ensure shared styles are present (already linked above as fallback)
        window.addEventListener('load', function() {
          if (!document.querySelector('link[href="/shared/styles.css"]')) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '/shared/styles.css';
            document.head.appendChild(link);
          }
        });
      </script>
      </head>
<body class="bg-green-50">

  <!-- Header -->
  <header class="bg-white shadow-lg sticky top-0 z-40 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo & Brand -->
        <div class="flex items-center gap-3">
          <a href="/buyer/buyers-home.html" class="flex items-center gap-2">
            <img src="/public/images/logo.png" alt="ADD Logo" class="h-10 w-10 rounded-lg shadow-md" />
            <div class="hidden sm:block">
              <h1 class="font-bold text-lg text-green-700">ðŸ›’ Local Market</h1>
              <p class="text-xs text-gray-500 -mt-1">Fresh â€¢ Fast â€¢ Local</p>
            </div>
          </a>
        </div>

        <!-- Search Bar (Desktop) -->
        <div class="hidden md:flex flex-1 max-w-md mx-6">
          <div class="relative w-full">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
            <input type="text" id="header-search" placeholder="Search products..." 
                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm">
          </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-3">
          <!-- Cart Button -->
          <button onclick="switchTab('cart')" class="relative p-2 text-gray-600 hover:text-green-700 rounded-lg hover:bg-green-50 transition-colors">
            <i class="fas fa-shopping-cart text-lg"></i>
            <span id="header-cart-badge" class="cart-badge hidden">0</span>
          </button>
          
          <!-- Mode Switch -->
          <button id="switch-to-physical" class="hidden lg:flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
            <i class="fas fa-box-open text-sm"></i>
            <span>Physical Products</span>
          </button>
          
          <!-- Mobile Menu -->
          <button id="mobile-menu-toggle" class="md:hidden p-2 text-gray-600 hover:text-green-700 rounded-lg hover:bg-green-50 transition-colors">
            <i class="fas fa-bars text-lg"></i>
          </button>
          
          <!-- User Menu (Desktop) -->
          <div class="hidden md:block relative">
            <button id="user-menu-btn" class="flex items-center gap-2 text-gray-600 hover:text-green-700 p-2 rounded-lg hover:bg-green-50 transition-colors">
              <div class="w-7 h-7 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-green-600 text-xs"></i>
              </div>
              <span id="user-name" class="font-medium text-sm">User</span>
              <i class="fas fa-chevron-down text-xs"></i>
            </button>
            
            <!-- Dropdown -->
            <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50">
              <div class="py-1">
                <button onclick="switchTab('orders')" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-green-50 transition-colors w-full text-left text-sm">
                  <i class="fas fa-receipt text-green-600"></i>
                  <span>My Orders</span>
                </button>
                <button onclick="switchTab('profile')" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-green-50 transition-colors w-full text-left text-sm">
                  <i class="fas fa-user text-green-600"></i>
                  <span>Profile</span>
                </button>
                <button onclick="openSupportModal()" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-green-50 transition-colors w-full text-left text-sm">
                  <i class="fas fa-headset text-green-600"></i>
                  <span>Support</span>
                </button>
                <hr class="my-1">
                <button id="logout-btn" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left text-sm">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Navigation Menu -->
  <div id="mobile-nav" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop fixed inset-0" onclick="closeMobileNav()"></div>
    <div class="fixed top-0 right-0 h-full w-72 max-w-full bg-white shadow-xl transform translate-x-full transition-transform duration-300" id="mobile-nav-panel">
      <div class="p-4">
        <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-800">Menu</h2>
          <button onclick="closeMobileNav()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
            <i class="fas fa-times text-gray-600"></i>
          </button>
        </div>
        
        <nav class="space-y-2">
          <button onclick="switchTab('browse'); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-green-50 transition-colors text-left">
            <i class="fas fa-store text-green-600"></i>
            <span class="text-gray-700">Browse Products</span>
          </button>
          <button onclick="switchTab('cart'); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-green-50 transition-colors text-left">
            <i class="fas fa-shopping-cart text-green-600"></i>
            <span class="text-gray-700">My Cart</span>
            <span id="mobile-cart-badge" class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full hidden">0</span>
          </button>
          <button onclick="switchTab('orders'); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-green-50 transition-colors text-left">
            <i class="fas fa-receipt text-green-600"></i>
            <span class="text-gray-700">My Orders</span>
          </button>
          <button onclick="switchTab('profile'); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-green-50 transition-colors text-left">
            <i class="fas fa-user text-green-600"></i>
            <span class="text-gray-700">Profile</span>
          </button>
          
          <hr class="my-4">
          
          <button onclick="window.modeSwitcher.switchMode('physical')" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-blue-50 transition-colors text-left">
            <i class="fas fa-box-open text-blue-600"></i>
            <span class="text-gray-700">Physical Products</span>
          </button>
          <button onclick="openSupportModal(); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-purple-50 transition-colors text-left">
            <i class="fas fa-headset text-purple-600"></i>
            <span class="text-gray-700">Help & Support</span>
          </button>
          
          <hr class="my-4">
          
          <button onclick="logout(); closeMobileNav();" class="flex items-center gap-3 w-full p-3 rounded-lg hover:bg-red-50 text-red-600 transition-colors text-left">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </nav>
      </div>
    </div>
  </div>

  <!-- Main Content Container -->
  <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    
    <!-- Tabs Navigation -->
    <nav class="mb-6" aria-label="Local Market sections">
      <div class="bg-white rounded-xl shadow-lg border border-gray-200">
        <div class="flex gap-1 overflow-x-auto p-2 custom-scrollbar" role="tablist">
          <button id="tab-browse" class="tab-btn flex-1 px-4 py-3 rounded-lg text-sm font-medium gradient-bg text-white shadow-md whitespace-nowrap transition-all duration-200" data-tab="browse" role="tab" aria-selected="true" aria-controls="browse-content">
            <i class="fas fa-store mr-2" aria-hidden="true"></i>
            <span>Browse Products</span>
          </button>
          <button id="tab-cart" class="tab-btn flex-1 px-4 py-3 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 whitespace-nowrap relative" data-tab="cart" role="tab" aria-selected="false" aria-controls="cart-content">
            <i class="fas fa-shopping-cart mr-2" aria-hidden="true"></i>
            <span>My Cart</span>
            <span id="tab-cart-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full hidden">0</span>
          </button>
          <button id="tab-orders" class="tab-btn flex-1 px-4 py-3 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 whitespace-nowrap" data-tab="orders" role="tab" aria-selected="false" aria-controls="orders-panel">
            <i class="fas fa-receipt mr-2" aria-hidden="true"></i>
            <span>My Orders</span>
          </button>
          <button id="tab-profile" class="tab-btn flex-1 px-4 py-3 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition-all duration-200 whitespace-nowrap" data-tab="profile" role="tab" aria-selected="false" aria-controls="profile-panel">
            <i class="fas fa-user mr-2" aria-hidden="true"></i>
            <span>Profile</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Tab Content -->
    <main class="grid grid-cols-1 lg:grid-cols-4 gap-8">

    <!-- Tab Panels -->
    <section id="orders-panel" class="col-span-1 lg:col-span-4 hidden" role="tabpanel" aria-labelledby="tab-orders">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-800">My Orders</h2>
            <p class="text-sm text-gray-600">View and track your grocery orders</p>
          </div>
          <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm" onclick="document.querySelector('[data-tab=\'browse\']')?.click()">
            <i class="fas fa-arrow-left mr-2" aria-hidden="true"></i>Back to Browse
          </button>
        </div>
        <div id="orders-panel-content" class="space-y-4">
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-spinner loading-spinner text-2xl text-gray-400 mb-2" aria-hidden="true"></i>
            <p>Loading your orders...</p>
          </div>
        </div>
      </div>
    </section>

    <section id="profile-panel" class="col-span-1 lg:col-span-4 hidden" role="tabpanel" aria-labelledby="tab-profile">
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-800">My Profile</h2>
            <p class="text-sm text-gray-600">Manage your personal information</p>
          </div>
          <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm" onclick="document.querySelector('[data-tab=\'browse\']')?.click()">
            <i class="fas fa-arrow-left mr-2" aria-hidden="true"></i>Back to Browse
          </button>
        </div>
        <div id="profile-panel-content" class="space-y-4">
          <div class="text-center py-8 text-gray-500">
            <i class="fas fa-spinner loading-spinner text-2xl text-gray-400 mb-2" aria-hidden="true"></i>
            <p>Loading your profile...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Browse Content (default visible) -->
    <!-- Left Column: Filters and Products -->
    <div id="browse-content" class="lg:col-span-3 space-y-8" role="tabpanel" aria-labelledby="tab-browse">
      
      <!-- Location & Search/Filter Panel -->
      <section class="bg-white rounded-2xl shadow-lg p-6 fade-in">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">
          <!-- Location Info -->
          <div>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                <i class="fas fa-map-marker-alt text-xl text-green-600"></i>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-800">Delivery Zone</h2>
                <p id="location-indicator" class="text-sm text-gray-600">
                  <i class="fas fa-spinner loading-spinner mr-1"></i>
                  Detecting your location...
                </p>
              </div>
            </div>
            <div id="map-preview" class="rounded-xl border border-gray-200 bg-gray-100 relative overflow-hidden">
              <div id="map-loading" class="absolute inset-0 flex items-center justify-center bg-gray-100 z-10">
                <div class="text-center">
                  <i class="fas fa-spinner loading-spinner text-2xl text-gray-400 mb-2"></i>
                  <p class="text-sm text-gray-500">Loading map...</p>
                </div>
              </div>
            </div>
            <div class="mt-4 flex gap-2">
              <button id="update-location-btn" class="flex-1 bg-green-100 text-green-800 font-semibold py-2 px-4 rounded-lg hover:bg-green-200 transition-colors">
                <i class="fas fa-location-crosshairs mr-2"></i>Update Location
              </button>
              <button id="use-current-location-btn" class="bg-blue-100 text-blue-800 font-semibold py-2 px-4 rounded-lg hover:bg-blue-200 transition-colors" title="Use current location">
                <i class="fas fa-crosshairs"></i>
              </button>
              <button id="choose-location-btn" class="bg-purple-100 text-purple-800 font-semibold py-2 px-4 rounded-lg hover:bg-purple-200 transition-colors" title="Choose location on map">
                <i class="fas fa-map-pin"></i>
              </button>
            </div>
          </div>

          <!-- Search & Filters -->
          <div>
            <!-- Mobile Search (shown on mobile) -->
            <div class="lg:hidden relative mb-4">
              <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" aria-hidden="true"></i>
              <label for="mobile-search-bar" class="sr-only">Search products</label>
              <input type="text" id="mobile-search-bar" placeholder="Search products..." class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500" autocomplete="off">
            </div>

            <!-- Filters -->
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                  <select id="category-filter" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500">
                    <option value="">All Categories</option>
                    <!-- Categories will be loaded dynamically -->
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                  <select id="sort-filter" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500">
                    <option value="name">Name (A-Z)</option>
                    <option value="price_low">Price (Low to High)</option>
                    <option value="price_high">Price (High to Low)</option>
                    <option value="rating">Highest Rated</option>
                    <option value="newest">Newest First</option>
                  </select>
                </div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                <div class="px-2">
                  <input type="range" id="price-range" min="0" max="10000" value="10000" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                  <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>0 RWF</span>
                    <span id="price-range-value">10,000 RWF</span>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Availability</label>
                  <select id="availability-filter" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500">
                    <option value="">All Products</option>
                    <option value="in_stock">In Stock Only</option>
                    <option value="low_stock">Low Stock</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Delivery</label>
                  <select id="delivery-time-filter" class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-green-500">
                    <option value="">Any Time</option>
                    <option value="fast">Under 1 hour</option>
                    <option value="standard">1-2 hours</option>
                    <option value="scheduled">Scheduled</option>
                  </select>
                </div>
              </div>

              <button id="clear-filters-btn" class="w-full bg-gray-100 text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors">
                <i class="fas fa-times mr-2"></i>Clear All Filters
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Product Listings -->
      <section>
        <!-- Section Header -->
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-800">Available Products</h2>
            <p id="products-count" class="text-sm text-gray-600" aria-live="polite">Loading products...</p>
          </div>
          <div class="flex items-center gap-2" role="group" aria-label="View mode">
            <button id="grid-view-btn" class="p-2 bg-green-100 text-green-600 rounded-lg" aria-pressed="true" title="Grid view">
              <i class="fas fa-th-large" aria-hidden="true"></i>
            </button>
            <button id="list-view-btn" class="p-2 text-gray-400 hover:bg-gray-100 rounded-lg" aria-pressed="false" title="List view">
              <i class="fas fa-list" aria-hidden="true"></i>
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div id="products-loading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4 md:gap-6">
          <!-- Loading skeletons -->
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden hidden lg:block">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden hidden xl:block">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden hidden 2xl:block">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden hidden 2xl:block">
            <div class="h-48 skeleton"></div>
            <div class="p-4 space-y-3">
              <div class="h-4 skeleton rounded w-3/4"></div>
              <div class="h-3 skeleton rounded w-1/2"></div>
              <div class="flex justify-between items-center">
                <div class="h-6 skeleton rounded w-1/4"></div>
                <div class="h-8 skeleton rounded w-16"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Products Grid -->
        <div id="product-listings" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4 md:gap-6 hidden" role="region" aria-live="polite" aria-label="Products">
          <!-- Product cards will be injected here by JS -->
        </div>

        <!-- No Products State -->
        <div id="no-products" class="text-center py-16 hidden">
          <div class="w-32 h-32 bg-gradient-to-br from-green-100 to-green-200 rounded-full flex items-center justify-center mx-auto mb-6 bounce-in">
            <i class="fas fa-shopping-basket text-4xl text-green-600"></i>
          </div>
          <h3 class="text-2xl font-bold text-gray-800 mb-3">No Products Found</h3>
          <p class="text-gray-600 mb-6 max-w-md mx-auto">We couldn't find any products matching your criteria. Try adjusting your filters or search terms to discover more items.</p>
          <div class="space-y-3">
            <button id="reset-search-btn" class="gradient-bg text-white px-8 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium">
              <i class="fas fa-refresh mr-2"></i>Reset Search
            </button>
            <button onclick="document.getElementById('header-search').focus()" class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors">
              <i class="fas fa-search mr-2"></i>Try Different Search
            </button>
          </div>
        </div>

        <!-- Load More Button -->
        <div id="load-more-container" class="text-center mt-12 hidden">
          <button id="load-more-btn" class="bg-white border-2 border-green-200 text-green-700 px-10 py-4 rounded-2xl hover:bg-green-50 hover:border-green-300 transition-all duration-300 font-semibold shadow-lg hover:shadow-xl">
            <i class="fas fa-plus mr-3"></i>Load More Products
          </button>
          <p class="text-sm text-gray-500 mt-3">Discover more fresh products</p>
        </div>
      </section>
    </div>

    <!-- Right Column: Shopping Menu (Cart) -->
    <aside id="cart-content" class="lg:col-span-1" role="tabpanel" aria-labelledby="tab-cart">
      <div class="sticky-cart">
        <div id="shopping-menu" class="bg-white rounded-2xl shadow-lg p-6 space-y-6" role="region" aria-label="Shopping menu">
          <!-- Title -->
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-gray-800" id="cart-title">Shopping Menu</h2>
            <span id="menu-item-count" class="bg-green-600 text-white text-xs font-bold px-2 py-1 rounded-full" aria-live="polite" aria-label="Items in cart">0</span>
          </div>

          <!-- Item List -->
          <div id="menu-items-list" class="space-y-4 max-h-64 overflow-y-auto pr-2">
            <p class="text-center text-gray-500 py-8">Your menu is empty. Add items to get started!</p>
          </div>

          <!-- Cost Breakdown -->
          <div id="cost-breakdown" class="border-t border-gray-200 pt-4 space-y-2 text-sm hidden">
            <div class="flex justify-between">
              <span class="text-gray-600">Products Total</span>
              <span id="products-total">0 RWF</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Platform Fee (1%)</span>
              <span id="platform-fee">0 RWF</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Packaging Fee</span>
              <span id="packaging-fee">200 RWF</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Delivery Fee</span>
              <span id="delivery-fee">1500 RWF</span>
            </div>
            <div class="flex justify-between font-bold text-lg text-gray-800 border-t border-gray-200 pt-2 mt-2">
              <span>Grand Total</span>
              <span id="grand-total">1700 RWF</span>
            </div>
          </div>

          <!-- Delivery Info Setup -->
          <div id="delivery-info-setup" class="border-t border-gray-200 pt-4 space-y-3 hidden">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Time Window</label>
              <select class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                <option>ASAP (30-60 min)</option>
                <option>In 1-2 hours</option>
                <option>In 2-4 hours</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Delivery Note (Optional)</label>
              <textarea rows="2" placeholder="e.g., Call upon arrival" class="w-full p-2 border border-gray-300 rounded-lg text-sm"></textarea>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="space-y-3">
            <button onclick="saveMenuForLater()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-xl transition-colors text-sm">
              <i class="fas fa-bookmark mr-2"></i>Save Menu for Later
            </button>
            <button onclick="loadSavedMenu()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 rounded-xl transition-colors text-sm">
              <i class="fas fa-history mr-2"></i>Load Saved Menu
            </button>
            <button id="checkout-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg transition-transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
              <i class="fas fa-shopping-cart mr-2"></i>Confirm & Checkout
            </button>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <script src="/grocery/missing-functions.js"></script>
  <script src="/grocery/missing-functions-comprehensive.js"></script>
  <script src="/grocery/local-market-core.js"></script>
  <script src="/grocery/local-market-product-modal.js"></script>
  <script src="/grocery/test-functionality.js"></script>
 
  <!-- Post-Order Confirmation Modal -->
  <div id="order-confirmation-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center fade-in">
      <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <i class="fas fa-check-circle text-5xl text-green-500"></i>
      </div>
      <h2 class="text-2xl font-bold text-gray-800 mb-3">Order Placed Successfully!</h2>
      <p class="text-gray-600 mb-6">Your fresh groceries are on the way. You can track the delivery in real-time.</p>
      
      <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
        <h3 class="font-semibold text-gray-700 mb-3">Order Summary</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600">Order Number:</span>
            <span class="font-mono">#LM-12345</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Estimated Delivery:</span>
            <span class="font-semibold text-green-600">35-50 minutes</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-600">Assigned Agent:</span>
            <div class="flex items-center gap-2">
              <img src="/public/images/logo.png" alt="Agent" class="w-6 h-6 rounded-full">
              <span class="font-semibold">John D.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-4">
        <a href="/buyer/track-order.html?id=12345" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
          <i class="fas fa-map-location-dot mr-2"></i>Track Delivery
        </a>
        <a href="/buyer/orders.html" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-4 rounded-lg transition-colors">
          View Full Order Details
        </a>
      </div>
      <button id="close-modal-btn" class="mt-6 text-sm text-gray-500 hover:underline">Close</button>
    </div>
  </div>

  <!-- Product Details Modal -->
  <div id="product-details-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800">Product Details</h2>
        <button onclick="closeProductDetailsModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div id="product-details-content" class="p-6">
        <!-- Product details will be loaded here -->
        <div class="animate-pulse">
          <div class="h-48 bg-gray-200 rounded-lg mb-4"></div>
          <div class="h-6 bg-gray-200 rounded mb-2"></div>
          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Track Location Modal -->
  <div id="track-location-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800">Seller Location & Delivery Info</h2>
        <button onclick="closeTrackLocationModal()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="p-6">
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Map Section -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Seller Location</h3>
            <div id="seller-map" class="h-64 rounded-lg border border-gray-300"></div>
            <div class="mt-4 space-y-2 text-sm">
              <div class="flex items-center gap-2">
                <i class="fas fa-map-marker-alt text-red-500"></i>
                <span id="seller-address">Loading address...</span>
              </div>
              <div class="flex items-center gap-2">
                <i class="fas fa-route text-blue-500"></i>
                <span id="delivery-distance">Calculating distance...</span>
              </div>
              <div class="flex items-center gap-2">
                <i class="fas fa-clock text-green-500"></i>
                <span id="estimated-delivery">Estimating delivery time...</span>
              </div>
            </div>
          </div>
          
          <!-- Seller Info Section -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Seller Information</h3>
            <div id="seller-info-content" class="space-y-4">
              <!-- Seller info will be loaded here -->
              <div class="animate-pulse">
                <div class="h-4 bg-gray-200 rounded mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-1/2"></div>
              </div>
            </div>
            
            <div class="mt-6 space-y-3">
              <button type="button" onclick="event.preventDefault(); contactSeller(); return false;" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 rounded-xl transition-colors">
                <i class="fas fa-phone mr-2"></i>Contact Seller
              </button>
              <button type="button" onclick="event.preventDefault(); requestDeliveryUpdate(); return false;" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-xl transition-colors">
                <i class="fas fa-truck mr-2"></i>Request Delivery Update
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>





  
</body>
</html>