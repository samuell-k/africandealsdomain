<!DOCTYPE html>
<header id="buyer-header" class="glass bg-white/80 fixed top-0 left-0 w-full z-50 shadow-md border-b border-gray-200">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-2 md:px-6 h-16 md:h-20 gap-2">
    <!-- Logo and Project Name -->
    <a href="/" class="flex items-center gap-2">
      <img src="/public/images/logo.png" alt="ADD Logo" class="h-8 w-8 md:h-12 md:w-12 rounded-xl shadow" />
      <span class="font-extrabold text-lg md:text-2xl text-[#0e2038] tracking-tight">ADD Physical Product</span>
    </a>
    
    <!-- Large Search Bar -->
    <div class="flex-1 flex justify-center items-center mx-2">
      <div class="relative w-full max-w-3xl">
        <input id="search-input" type="text" placeholder="What are you looking for?" class="w-full pl-12 pr-16 py-2 md:py-3 rounded-2xl border border-gray-300 focus:ring-2 focus:ring-blue-400 bg-white/80 shadow-md transition-all duration-300 text-base md:text-lg" autocomplete="off" />
        <span class="absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer" id="search-icon-left">
          <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </span>
        <button id="search-btn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl px-3 py-1 flex items-center gap-1 shadow transition focus:outline-none">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-white" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <span>Search</span>
        </button>
      </div>
    </div>
    
    <!-- Right Controls -->
    <div class="flex items-center gap-1 md:gap-2">
      <!-- Message Icon -->
      <a href="/buyer/messages.html" class="relative flex items-center justify-center h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-blue-50 transition" title="Messages">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.2" class="text-blue-600" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 9h8"/><path d="M8 13h6"/></svg>
        <span id="messages-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full px-1 py-0.5 shadow hidden">0</span>
      </a>
      
      <!-- Delivery Dropdown -->
      <div class="relative">
        <button id="delivery-btn" class="flex items-center gap-1 px-1 py-1 rounded-lg hover:bg-blue-50 transition text-xs md:text-sm font-semibold text-[#0e2038]">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600" viewBox="0 0 24 24"><path d="M3 12l2-2 4 4 8-8 4 4"/></svg>
          <span id="delivery-label">Deliver to: <span class="font-bold">Rwanda</span></span>
          <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" class="ml-1 text-gray-400" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
        </button>
        <div id="delivery-dropdown" class="absolute right-0 mt-2 min-w-[260px] bg-white rounded-xl shadow-2xl border border-gray-200 p-4" style="display: none; z-index: 99999; position: fixed; top: 80px; right: 20px;">
          <div class="mb-2 font-bold text-blue-700">Set Delivery Location</div>
          <div class="mb-2">
            <label class="block text-xs font-semibold mb-1">Country</label>
            <select id="country-select" class="w-full border rounded px-2 py-1 text-xs">
              <option value="Rwanda" selected>🇷🇼 Rwanda</option>
              <option value="Kenya">🇰🇪 Kenya</option>
              <option value="Nigeria">🇳🇬 Nigeria</option>
              <option value="Ghana">🇬🇭 Ghana</option>
              <option value="South Africa">🇿🇦 South Africa</option>
              <option value="United States">🇺🇸 United States</option>
              <option value="United Kingdom">🇬🇧 United Kingdom</option>
              <option value="France">🇫🇷 France</option>
              <option value="Germany">🇩🇪 Germany</option>
              <option value="China">🇨🇳 China</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="block text-xs font-semibold mb-1">Add Manual Address</label>
            <input id="manual-address" type="text" class="w-full border rounded px-2 py-1 text-xs" placeholder="Street, City, etc." />
          </div>
          <div class="mb-2">
            <label class="block text-xs font-semibold mb-1">Zip/Postal Code</label>
            <input id="zip-code" type="text" class="w-full border rounded px-2 py-1 text-xs" placeholder="e.g. 10001" />
          </div>
          <button id="save-delivery-btn" class="w-full bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 transition mt-2 text-xs">Save</button>
        </div>
      </div>
      
      <!-- Money Dropdown -->
      <div class="relative">
        <button id="money-btn" class="flex items-center gap-1 px-1 py-1 rounded-lg hover:bg-blue-50 transition text-xs md:text-sm font-semibold text-[#0e2038]">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" class="text-yellow-500" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><text x="12" y="16" text-anchor="middle" font-size="8" fill="#f59e42">&#8377;</text></svg>
          <span id="money-label">EN | RWF</span>
          <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" class="ml-1 text-gray-400" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
        </button>
        <div id="money-dropdown" class="absolute right-0 mt-2 min-w-[200px] bg-white rounded-xl shadow-2xl border border-gray-200 p-4" style="display: none; z-index: 99999; position: fixed; top: 80px; right: 20px;">
          <div class="mb-2 font-bold text-blue-700 text-sm">Language & Currency</div>
          <div class="mb-2">
            <label class="block text-xs font-semibold mb-1">Language</label>
            <select id="lang-select" class="w-full border rounded px-2 py-1 text-xs">
              <option value="en" selected>English</option>
              <option value="fr">Français</option>
              <option value="rw">Kinyarwanda</option>
              <option value="sw">Swahili</option>
              <option value="ar">العربية</option>
              <option value="ha">Hausa</option>
              <option value="yo">Yoruba</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="block text-xs font-semibold mb-1">Currency</label>
            <select id="currency-select" class="w-full border rounded px-2 py-1 text-xs">
              <option value="RWF" selected>RWF - Rwanda Franc</option>
              <option value="KES">KES - Kenya Shilling</option>
              <option value="NGN">NGN - Nigerian Naira</option>
              <option value="USD">USD - US Dollar</option>
              <option value="EUR">EUR - Euro</option>
              <option value="GBP">GBP - British Pound</option>
              <option value="JPY">JPY - Japanese Yen</option>
              <option value="CNY">CNY - Chinese Yuan</option>
              <option value="ZAR">ZAR - South African Rand</option>
              <option value="GHS">GHS - Ghanaian Cedi</option>
            </select>
          </div>
          <button id="save-money-btn" class="w-full bg-yellow-500 text-white px-3 py-1 rounded-lg hover:bg-yellow-600 transition mt-2 text-xs">Save</button>
        </div>
      </div>
      
      <!-- Cart Icon -->
      <a href="/buyer/cart.html" class="relative flex items-center justify-center h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-blue-50 transition group" title="Cart">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.2" class="text-blue-600 group-hover:scale-110 transition-transform duration-200" viewBox="0 0 24 24">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span data-cart-count class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full px-1 py-0.5 shadow hidden animate-pulse">0</span>
      </a>
      
      <!-- Order Icon -->
      <a href="/buyer/orders.html" class="flex items-center justify-center h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-blue-50 transition" title="Orders">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.2" class="text-blue-600" viewBox="0 0 24 24"><rect x="4" y="6" width="16" height="14" rx="3"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
      </a>
      
      <!-- Profile Dropdown -->
      <div class="relative">
        <button id="profile-btn" class="flex items-center justify-center h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-blue-50 transition">
          <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.2" class="text-blue-600" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
        </button>
        <div id="profile-dropdown" class="absolute right-0 mt-2 min-w-[180px] bg-white rounded-xl shadow-2xl border border-gray-200 p-4" style="display: none; z-index: 99999; position: fixed; top: 80px; right: 20px;">
          <div class="mb-2 font-bold text-blue-700 text-sm" id="profile-greeting">Hello, User</div>
          <a href="/buyer/orders.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">Orders</a>
          <a href="/buyer/messages.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">Messages</a>
          <a href="/buyer/wishlist.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">Favourites</a>
          <a href="/public/how-it-works.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">How it works</a>
          <a href="/public/about.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">About</a>
          <a href="/public/privacy-policy.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">Privacy</a>
          <a href="/buyer/profile.html" class="block px-4 py-2 hover:bg-blue-50 text-xs">Account</a>
          <button id="signout-btn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 text-xs">Logout</button>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
/* Ensure dropdowns are always on top */
#delivery-dropdown,
#money-dropdown,
#profile-dropdown {
  position: fixed !important;
  z-index: 99999 !important;
  top: 80px !important;
  right: 20px !important;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
  border: 1px solid #e5e7eb !important;
  background: white !important;
  border-radius: 12px !important;
}

/* Ensure header has proper z-index */
#buyer-header {
  z-index: 1000 !important;
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
}

/* Ensure main content doesn't overlap */
main {
  margin-top: 80px !important;
  position: relative !important;
  z-index: 1 !important;
}

/* Override any conflicting styles */
body {
  overflow-x: hidden !important;
}

.container, .wrapper {
  position: relative !important;
  z-index: 1 !important;
}
</style>

<script>
// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing header...');
  
  // Get all elements
  const deliveryBtn = document.getElementById('delivery-btn');
  const deliveryDropdown = document.getElementById('delivery-dropdown');
  const moneyBtn = document.getElementById('money-btn');
  const moneyDropdown = document.getElementById('money-dropdown');
  const profileBtn = document.getElementById('profile-btn');
  const profileDropdown = document.getElementById('profile-dropdown');
  const saveDeliveryBtn = document.getElementById('save-delivery-btn');
  const saveMoneyBtn = document.getElementById('save-money-btn');
  const signoutBtn = document.getElementById('signout-btn');
  
  // Set default values
  localStorage.setItem('deliveryCountry', 'Rwanda');
  localStorage.setItem('selectedLanguage', 'en');
  localStorage.setItem('selectedCurrency', 'RWF');
  
  // Function to position dropdowns correctly
  function positionDropdown(dropdown, button) {
    if (button && dropdown) {
      const buttonRect = button.getBoundingClientRect();
      const headerHeight = 80; // Approximate header height
      
      dropdown.style.position = 'fixed';
      dropdown.style.top = (headerHeight + 10) + 'px';
      dropdown.style.right = '20px';
      dropdown.style.zIndex = '99999';
    }
  }
  
  // Delivery dropdown toggle
  if (deliveryBtn) {
    deliveryBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Delivery button clicked');
      
      // Close other dropdowns
      moneyDropdown.style.display = 'none';
      profileDropdown.style.display = 'none';
      
      // Toggle delivery dropdown
      if (deliveryDropdown.style.display === 'none' || deliveryDropdown.style.display === '') {
        deliveryDropdown.style.display = 'block';
        positionDropdown(deliveryDropdown, deliveryBtn);
        console.log('Delivery dropdown opened');
      } else {
        deliveryDropdown.style.display = 'none';
        console.log('Delivery dropdown closed');
      }
    });
  }
  
  // Money dropdown toggle
  if (moneyBtn) {
    moneyBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Money button clicked');
      
      // Close other dropdowns
      deliveryDropdown.style.display = 'none';
      profileDropdown.style.display = 'none';
      
      // Toggle money dropdown
      if (moneyDropdown.style.display === 'none' || moneyDropdown.style.display === '') {
        moneyDropdown.style.display = 'block';
        positionDropdown(moneyDropdown, moneyBtn);
        console.log('Money dropdown opened');
      } else {
        moneyDropdown.style.display = 'none';
        console.log('Money dropdown closed');
      }
    });
  }
  
  // Profile dropdown toggle
  if (profileBtn) {
    profileBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Profile button clicked');
      
      // Close other dropdowns
      deliveryDropdown.style.display = 'none';
      moneyDropdown.style.display = 'none';
      
      // Toggle profile dropdown
      if (profileDropdown.style.display === 'none' || profileDropdown.style.display === '') {
        profileDropdown.style.display = 'block';
        positionDropdown(profileDropdown, profileBtn);
        console.log('Profile dropdown opened');
      } else {
        profileDropdown.style.display = 'none';
        console.log('Profile dropdown closed');
      }
    });
  }
  
  // Save delivery
  if (saveDeliveryBtn) {
    saveDeliveryBtn.addEventListener('click', function() {
      const country = document.getElementById('country-select').value;
      const address = document.getElementById('manual-address').value;
      const zip = document.getElementById('zip-code').value;
      
      if (country) {
        localStorage.setItem('deliveryCountry', country);
        localStorage.setItem('deliveryAddress', address);
        localStorage.setItem('deliveryZipCode', zip);
        
        document.getElementById('delivery-label').innerHTML = `Deliver to: <span class="font-bold">${country}</span>`;
        deliveryDropdown.style.display = 'none';
        showNotification('Delivery location saved!', 'success');
        console.log('Delivery saved:', country);
      } else {
        showNotification('Please select a country', 'error');
      }
    });
  }
  
  // Save money/language
  if (saveMoneyBtn) {
    saveMoneyBtn.addEventListener('click', function() {
      const language = document.getElementById('lang-select').value;
      const currency = document.getElementById('currency-select').value;
      
      if (language && currency) {
        localStorage.setItem('selectedLanguage', language);
        localStorage.setItem('selectedCurrency', currency);
        
        document.getElementById('money-label').textContent = `${language.toUpperCase()} | ${currency}`;
        moneyDropdown.style.display = 'none';
        showNotification('Language and currency updated!', 'success');
        console.log('Money settings saved:', language, currency);
      } else {
        showNotification('Please select both language and currency', 'error');
      }
    });
  }
  
  // Signout
  if (signoutBtn) {
    signoutBtn.addEventListener('click', function() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('userData');
      localStorage.removeItem('cart');
      window.location.href = '/';
    });
  }
  
  // Close dropdowns when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('#delivery-dropdown') && !e.target.closest('#money-dropdown') && !e.target.closest('#profile-dropdown') &&
        !e.target.closest('#delivery-btn') && !e.target.closest('#money-btn') && !e.target.closest('#profile-btn')) {
      deliveryDropdown.style.display = 'none';
      moneyDropdown.style.display = 'none';
      profileDropdown.style.display = 'none';
    }
  });
  
  // Load saved preferences
  function loadSavedPreferences() {
    const savedCountry = localStorage.getItem('deliveryCountry') || 'Rwanda';
    const savedAddress = localStorage.getItem('deliveryAddress') || '';
    const savedZip = localStorage.getItem('deliveryZipCode') || '';
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    const savedCurrency = localStorage.getItem('selectedCurrency') || 'RWF';
    
    // Set delivery label
    document.getElementById('delivery-label').innerHTML = `Deliver to: <span class="font-bold">${savedCountry}</span>`;
    
    // Set form values
    document.getElementById('country-select').value = savedCountry;
    document.getElementById('manual-address').value = savedAddress;
    document.getElementById('zip-code').value = savedZip;
    document.getElementById('lang-select').value = savedLanguage;
    document.getElementById('currency-select').value = savedCurrency;
    document.getElementById('money-label').textContent = `${savedLanguage.toUpperCase()} | ${savedCurrency}`;
    
    console.log('Preferences loaded:', { savedCountry, savedLanguage, savedCurrency });
  }
  
  // Load user data
  function loadUserData() {
    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
    if (userData.name) {
      document.getElementById('profile-greeting').textContent = `Hello, ${userData.name}`;
    }
  }
  
  // Notification function
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    let bgColor = 'bg-blue-500';
    let icon = 'ℹ️';
    
    if (type === 'success') {
      bgColor = 'bg-green-500';
      icon = '✅';
    } else if (type === 'error') {
      bgColor = 'bg-red-500';
      icon = '❌';
    }
    
    notification.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white ${bgColor} shadow-lg flex items-center gap-2`;
    notification.innerHTML = `<span>${icon}</span><span>${message}</span>`;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }
  
  // Initialize
  loadSavedPreferences();
  loadUserData();
  console.log('Header initialized successfully!');
});

// Also initialize on window load as backup
window.addEventListener('load', function() {
  console.log('Window loaded, header should be ready');
});
</script> 