<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Messages | African Deals Domain</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/public/images/logo.png">
  <style>
    .skeleton {
      background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.2s infinite linear;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .soft-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .hover-lift {
      transition: all 0.3s ease;
    }
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    .animate-fade-in {
      animation: fadeIn 0.6s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .success-glow {
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }
    .pulse-glow {
      animation: pulse-glow 2s infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
      50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
    }
    .unread-indicator {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
  <script src="/shared/auth-utils.js"></script>
  <script>
    (function normalizeAuthStorage(){
      const token = localStorage.getItem('authToken') || localStorage.getItem('token');
      const userStr = localStorage.getItem('userData') || localStorage.getItem('user');
      if (token) { localStorage.setItem('authToken', token); localStorage.setItem('token', token); }
      if (userStr) { localStorage.setItem('userData', userStr); localStorage.setItem('user', userStr); }
    })();
  </script>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a href="/seller/dashboard.html" class="flex items-center space-x-2">
            <img src="/public/images/logo.png" alt="ADD Logo" class="h-8 w-8 rounded-lg shadow">
            <span class="font-bold text-xl text-blue-600">ADD Seller</span>
          </a>
          <div class="hidden md:ml-6 md:flex md:space-x-8">
            <a href="/seller/dashboard.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Dashboard</a>
            <a href="/seller/products.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Products</a>
            <a href="/seller/orders.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Orders</a>
            <a href="/seller/inventory.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Inventory</a>
            <a href="/seller/analytics.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Analytics</a>
            <a href="/seller/messages.html" class="text-blue-600 border-b-2 border-blue-600 px-3 py-2 text-sm font-medium">Messages</a>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Mobile Menu Button -->
          <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
          
          <!-- Profile Dropdown -->
          <div class="relative">
            <button id="profile-dropdown-btn" class="flex items-center gap-1 px-3 py-1 rounded hover:bg-gray-50 font-semibold transition-colors">
              <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" class="text-blue-600" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
              <span id="profile-name">My Store</span>
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" class="ml-1 text-gray-400 transition-transform" id="dropdown-arrow" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div id="profile-dropdown-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-50">
              <div class="py-2">
                <a href="/seller/profile.html" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-blue-50 transition-colors">
                  <i class="fas fa-user text-blue-600"></i>
                  <span>Profile</span>
                </a>
                <a href="/seller/settings.html" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-blue-50 transition-colors">
                  <i class="fas fa-cog text-blue-600"></i>
                  <span>Settings</span>
                </a>
                <hr class="my-2">
                <button id="logout-btn" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu" class="md:hidden bg-white border-t border-gray-200 hidden">
      <div class="px-4 py-2 space-y-1">
        <a href="/seller/dashboard.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Dashboard</a>
        <a href="/seller/products.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Products</a>
        <a href="/seller/orders.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Orders</a>
        <a href="/seller/inventory.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Inventory</a>
        <a href="/seller/analytics.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Analytics</a>
        <a href="/seller/messages.html" class="block px-3 py-2 text-blue-700 bg-blue-50 rounded-lg font-semibold">Messages</a>
      </div>
    </div>
  </nav>

  <main class="flex-1 max-w-7xl mx-auto w-full px-4 md:px-8 py-8">
    <!-- Enhanced Header Section -->
    <div class="soft-card rounded-2xl p-6 mb-8 animate-fade-in">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div class="flex items-center gap-4">
          <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-3 rounded-xl">
            <svg width="28" height="28" fill="none" stroke="white" stroke-width="2.5" viewBox="0 0 24 24">
              <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-3xl font-bold gradient-text">Messages</h1>
            <p class="text-gray-600 mt-1">Communicate with customers and support team</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div class="bg-gradient-to-r from-blue-500 to-purple-500 p-2 rounded-lg">
            <svg width="20" height="20" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
          </div>
          <select id="filter-messages" class="bg-white border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">All Messages</option>
            <option value="unread">Unread</option>
            <option value="support">Support</option>
            <option value="customer">Customer</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="soft-card rounded-xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Total Messages</p>
            <p class="text-2xl font-bold text-gray-900" id="total-messages">-</p>
          </div>
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-3 rounded-lg">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
        </div>
      </div>
      
      <div class="soft-card rounded-xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Unread</p>
            <p class="text-2xl font-bold text-red-600" id="unread-messages">-</p>
          </div>
          <div class="bg-gradient-to-r from-red-500 to-red-600 p-3 rounded-lg">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
          </div>
        </div>
      </div>
      
      <div class="soft-card rounded-xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Support</p>
            <p class="text-2xl font-bold text-orange-600" id="support-messages">-</p>
          </div>
          <div class="bg-gradient-to-r from-orange-500 to-orange-600 p-3 rounded-lg">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M12 2.25a9.75 9.75 0 100 19.5 9.75 9.75 0 000-19.5z"/>
            </svg>
          </div>
        </div>
      </div>
      
      <div class="soft-card rounded-xl p-6 hover-lift">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-600 text-sm font-medium">Customers</p>
            <p class="text-2xl font-bold text-green-600" id="customer-messages">-</p>
          </div>
          <div class="bg-gradient-to-r from-green-500 to-green-600 p-3 rounded-lg">
            <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
              <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <div id="message" class="mb-6 text-center text-sm font-semibold"></div>
    
    <!-- Loading State -->
    <div id="messages-loading" class="space-y-4 mb-6">
      <div class="soft-card rounded-xl p-6 skeleton h-24"></div>
      <div class="soft-card rounded-xl p-6 skeleton h-24"></div>
      <div class="soft-card rounded-xl p-6 skeleton h-24"></div>
    </div>
    
    <!-- Messages List -->
    <div id="messages-list" class="space-y-4 mb-6"></div>
    
    <!-- Empty State -->
    <div id="messages-empty" class="hidden text-center py-12">
      <div class="soft-card rounded-2xl p-12 max-w-md mx-auto">
        <div class="bg-gradient-to-r from-gray-400 to-gray-500 p-4 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center">
          <svg width="32" height="32" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
            <path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">No Messages Yet</h3>
        <p class="text-gray-600 mb-6">When customers or support team send you messages, they will appear here.</p>
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
          <p class="text-sm text-gray-600">💡 Tip: Great communication leads to better customer satisfaction!</p>
        </div>
      </div>
    </div>
  </main>
  <script>
    // --- LOAD SELLER HEADER ---
    async function loadSellerHeader() {
      try {
        console.log('Loading seller header...');
        const response = await fetch('/seller/seller-header.html');
        const html = await response.text();
        document.getElementById('seller-header').innerHTML = html;
        console.log('Seller header loaded successfully');
      } catch (error) {
        console.error('Failed to load seller header:', error);
      }
    }
    
    // --- CONFIG ---
    const API = '/api/seller/messages';
    
    // --- AUTH HEADER (token from localStorage) ---
    function authHeader() {
      const token = localStorage.getItem('authToken');
      return token ? { 'Authorization': 'Bearer ' + token } : {};
    }
    
    // --- GET MESSAGE TYPE ICON ---
    function getMessageTypeIcon(type) {
      const icons = {
        'support': '🛠️',
        'customer': '👤',
        'system': '⚙️',
        'order': '📦'
      };
      return icons[type] || '💬';
    }
    
    // --- GET MESSAGE TYPE COLOR ---
    function getMessageTypeColor(type) {
      const colors = {
        'support': 'bg-orange-100 text-orange-800',
        'customer': 'bg-blue-100 text-blue-800',
        'system': 'bg-gray-100 text-gray-800',
        'order': 'bg-green-100 text-green-800'
      };
      return colors[type] || 'bg-gray-100 text-gray-800';
    }
    
    // --- UPDATE STATS ---
    function updateStats(messages) {
      const totalMessages = messages.length;
      const unreadMessages = messages.filter(m => !m.read).length;
      const supportMessages = messages.filter(m => m.type === 'support').length;
      const customerMessages = messages.filter(m => m.type === 'customer').length;
      
      document.getElementById('total-messages').textContent = totalMessages;
      document.getElementById('unread-messages').textContent = unreadMessages;
      document.getElementById('support-messages').textContent = supportMessages;
      document.getElementById('customer-messages').textContent = customerMessages;
    }
    
    // --- LOAD MESSAGES ---
    async function loadMessages(filter = '') {
      document.getElementById('messages-loading').classList.remove('hidden');
      document.getElementById('messages-list').classList.add('hidden');
      document.getElementById('messages-empty').classList.add('hidden');
      
      try {
        const url = filter ? `${API}?type=${filter}` : API;
        const res = await fetch(url, { headers: authHeader() });
        if (!res.ok) throw new Error('Failed to load messages');
        const messages = await res.json();
        
        updateStats(messages);
        
        if (!messages || messages.length === 0) {
          document.getElementById('messages-empty').classList.remove('hidden');
          return;
        }
        
        let html = '';
        for (const msg of messages) {
          const typeIcon = getMessageTypeIcon(msg.type);
          const typeColor = getMessageTypeColor(msg.type);
          const messageDate = new Date(msg.created_at || msg.date).toLocaleDateString();
          const isUnread = !msg.read;
          
          html += `
            <div class="soft-card rounded-xl p-6 hover-lift animate-fade-in ${isUnread ? 'border-l-4 border-l-red-500' : ''}">
              <div class="flex items-start justify-between gap-4">
                <div class="flex items-start gap-4 flex-1">
                  <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-3 rounded-lg">
                    <span class="text-white text-lg">${typeIcon}</span>
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-3 mb-2">
                      <h3 class="font-semibold text-gray-900 ${isUnread ? 'font-bold' : ''}">${msg.subject || 'Message'}</h3>
                      ${isUnread ? '<span class="unread-indicator w-3 h-3 rounded-full"></span>' : ''}
                      <span class="px-2 py-1 rounded-full text-xs font-medium ${typeColor}">
                        ${msg.type ? msg.type.charAt(0).toUpperCase() + msg.type.slice(1) : 'General'}
                      </span>
                    </div>
                    <p class="text-gray-600 text-sm mb-2 line-clamp-2">${msg.content || msg.snippet || 'No content available'}</p>
                    <div class="flex items-center gap-4 text-xs text-gray-500">
                      <span>${msg.sender_name || 'Unknown'}</span>
                      <span>•</span>
                      <span>${messageDate}</span>
                      ${msg.order_id ? `<span>•</span><span>Order #${msg.order_id}</span>` : ''}
                    </div>
                  </div>
                </div>
                
                <div class="flex flex-col items-end gap-2">
                  <a href="/messages/thread.html?id=${msg.id}" 
                     class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:shadow-md transition-all duration-200">
                    ${isUnread ? 'Reply' : 'View'}
                  </a>
                  ${isUnread ? `
                    <button class="text-xs text-gray-500 hover:text-gray-700 mark-read-btn" data-id="${msg.id}">
                      Mark as read
                    </button>
                  ` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        document.getElementById('messages-list').innerHTML = html;
        document.getElementById('messages-list').classList.remove('hidden');
      } catch (error) {
        console.error('Error loading messages:', error);
        document.getElementById('messages-empty').classList.remove('hidden');
      } finally {
        document.getElementById('messages-loading').classList.add('hidden');
      }
    }
    
    // --- MARK AS READ ---
    document.addEventListener('click', async function(e) {
      if (e.target.classList.contains('mark-read-btn')) {
        const id = e.target.getAttribute('data-id');
        const msg = document.getElementById('message');
        msg.textContent = '';
        msg.className = 'mb-6 text-center text-sm font-semibold';
        
        try {
          const res = await fetch(`/api/messages/${id}/read`, {
            method: 'PUT',
            headers: authHeader()
          });
          
          if (!res.ok) throw new Error('Failed to mark as read');
          
          msg.textContent = '✅ Message marked as read!';
          msg.classList.add('text-green-600', 'success-glow');
          loadMessages();
          
          setTimeout(() => {
            msg.textContent = '';
            msg.className = 'mb-6 text-center text-sm font-semibold';
          }, 3000);
        } catch (err) {
          msg.textContent = `❌ ${err.message}`;
          msg.classList.add('text-red-600');
        }
      }
    });
    
    // --- FILTER MESSAGES ---
    document.getElementById('filter-messages').addEventListener('change', function(e) {
      loadMessages(e.target.value);
    });
    
    // --- NOTIFICATION SYSTEM ---
    function showNotification(title, message, type = 'info') {
      let container = document.getElementById('notification-container');
      if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'fixed top-4 right-4 z-50 space-y-2';
        document.body.appendChild(container);
      }
      
      const notification = document.createElement('div');
      const bgColor = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      }[type] || 'bg-blue-500';
      
      notification.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 max-w-sm`;
      notification.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0">
            ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
          </div>
          <div class="flex-1">
            <h4 class="font-semibold text-sm">${title}</h4>
            <p class="text-xs opacity-90 mt-1">${message}</p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="flex-shrink-0 text-white hover:text-gray-200">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      `;
      
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 300);
      }, 5000);
    }

    // --- MOBILE MENU FUNCTIONALITY ---
    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      
      if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
          
          const icon = mobileMenuBtn.querySelector('svg');
          if (mobileMenu.classList.contains('hidden')) {
            icon.innerHTML = '<path d="M4 6h16M4 12h16M4 18h16"/>';
          } else {
            icon.innerHTML = '<path d="M6 18L18 6M6 6l12 12"/>';
          }
        });
        
        document.addEventListener('click', function(e) {
          if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target) && !mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.add('hidden');
            const icon = mobileMenuBtn.querySelector('svg');
            icon.innerHTML = '<path d="M4 6h16M4 12h16M4 18h16"/>';
          }
        });
      }
    }

    // --- PROFILE DROPDOWN FUNCTIONALITY ---
    function setupProfileDropdown() {
      const profileBtn = document.getElementById('profile-dropdown-btn');
      const profileMenu = document.getElementById('profile-dropdown-menu');
      const arrow = document.getElementById('dropdown-arrow');
      
      if (profileBtn && profileMenu) {
        profileBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          profileMenu.classList.toggle('hidden');
          arrow.classList.toggle('rotate-180');
        });
        
        document.addEventListener('click', function(e) {
          if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.classList.add('hidden');
            arrow.classList.remove('rotate-180');
          }
        });
      }
      
      // Update profile name
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const profileName = document.getElementById('profile-name');
      if (profileName && user.name) {
        profileName.textContent = user.name;
      }
      
      // Setup logout
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/auth/auth-seller.html';
        });
      }
    }

    // --- INITIAL LOAD ---
    document.addEventListener('DOMContentLoaded', async function() {
      setupMobileMenu();
      setupProfileDropdown();
      
      loadMessages();
    });
  </script>
</body>
</html>
