<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard | African Deals Domain</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/public/images/logo.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar-collapsed { width: 0 !important; min-width: 0 !important; overflow: hidden; }
    .sidebar-expanded { width: 240px; min-width: 200px; }
    .sidebar-link.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold; }
    .soft-card { box-shadow: 0 8px 32px 0 rgba(16,30,54,0.1); border-radius: 1.5rem; backdrop-filter: blur(10px); }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .glass { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.8); }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .animate-fade-in { animation: fadeIn 0.6s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .pulse-glow { animation: pulseGlow 2s infinite; }
    @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.3); } 50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); } }
    .hover-lift { transition: all 0.3s ease; }
    .hover-lift:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .success-glow { animation: successGlow 2s ease-in-out infinite alternate; }
    @keyframes successGlow { from { box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); } to { box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); } }
  </style>
  <script src="/shared/auth-utils.js"></script>
  <script>
    // Prevent auth-utils from auto-initializing to avoid conflicts
    window.DISABLE_AUTH_UTILS_AUTO_INIT = true;
    // Normalize keys to avoid redirect loops
    (function normalizeAuthStorage(){
      const token = localStorage.getItem('authToken') || localStorage.getItem('token');
      const userStr = localStorage.getItem('userData') || localStorage.getItem('user');
      if (token) { localStorage.setItem('authToken', token); localStorage.setItem('token', token); }
      if (userStr) { localStorage.setItem('userData', userStr); localStorage.setItem('user', userStr); }
    })();
  </script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen flex flex-col">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a href="/seller/dashboard.html" class="flex items-center space-x-2">
            <img src="/public/images/logo.png" alt="ADD Logo" class="h-8 w-8 rounded-lg shadow">
            <span class="font-bold text-xl text-blue-600">ADD Seller</span>
          </a>
          <div class="hidden md:ml-6 md:flex md:space-x-8">
            <a href="/seller/dashboard.html" class="text-blue-600 border-b-2 border-blue-600 px-3 py-2 text-sm font-medium">Dashboard</a>
            <a href="/seller/products.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Products</a>
            <a href="/seller/orders.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Orders</a>
            <a href="/seller/inventory.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Inventory</a>
            <a href="/seller/analytics.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Analytics</a>
            <a href="/seller/messages.html" class="text-gray-500 hover:text-blue-700 px-3 py-2 text-sm font-medium transition-colors">Messages</a>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Local Market Quick Switch Button -->
          <a href="/seller/local-market-dashboard.html" 
             class="hidden md:flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-lg text-sm">
            <span class="text-sm">🛒</span>
            <span>Local Market</span>
            <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-full">NEW</span>
          </a>
          
          <!-- Mobile Menu Button -->
          <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
          
          <!-- Profile Dropdown -->
          <div class="relative">
            <button id="profile-dropdown-btn" class="flex items-center gap-1 px-3 py-1 rounded hover:bg-gray-50 font-semibold transition-colors">
              <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" class="text-blue-600" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
              <span id="profile-name">My Store</span>
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" class="ml-1 text-gray-400 transition-transform" id="dropdown-arrow" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
            </button>
            <div id="profile-dropdown-menu" class="absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-50">
              <!-- Profile Section -->
              <div class="px-4 py-3 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-purple-50 rounded-t-xl">
                <div class="font-bold text-sm text-gray-800" id="profile-greeting">Hello, Seller 👋</div>
                <div class="text-xs text-gray-600">Your store is performing excellently!</div>
                <div class="flex items-center gap-2 mt-2">
                  <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                  <span class="text-xs text-green-600 font-medium">Store Online</span>
                </div>
              <!-- Menu Items -->
              <div class="py-2">
                <a href="/seller/profile.html" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-blue-50 transition-colors">
                  <i class="fas fa-user text-blue-600"></i>
                  <span>Profile</span>
                </a>
                <a href="/seller/analytics.html" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-blue-50 transition-colors">
                  <i class="fas fa-chart-line text-blue-600"></i>
                  <span>Analytics</span>
                </a>
                <a href="/seller/settings.html" class="flex items-center gap-3 px-4 py-2 text-gray-700 hover:bg-blue-50 transition-colors">
                  <i class="fas fa-cog text-blue-600"></i>
                  <span>Settings</span>
                </a>
                <hr class="my-2">
                <button id="logout-btn" class="flex items-center gap-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-left">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu" class="md:hidden bg-white border-t border-gray-200 hidden">
      <div class="px-4 py-2 space-y-1">
        <a href="/seller/dashboard.html" class="block px-3 py-2 text-blue-700 bg-blue-50 rounded-lg font-semibold">Dashboard</a>
        <a href="/seller/products.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Products</a>
        <a href="/seller/orders.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Orders</a>
        <a href="/seller/inventory.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Inventory</a>
        <a href="/seller/analytics.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Analytics</a>
        <a href="/seller/messages.html" class="block px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">Messages</a>
        <div class="border-t border-gray-200 mt-2 pt-2">
          <a href="/seller/local-market-dashboard.html" class="flex items-center gap-2 px-3 py-2 text-green-700 bg-green-50 rounded-lg font-semibold">
            <span>🛒</span>
            <span>Local Market</span>
            <span class="text-xs bg-green-200 px-2 py-1 rounded-full">NEW</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
          

  <div class="max-w-7xl mx-auto w-full flex gap-6 mt-6 px-4">
    <!-- Collapsible Sidebar -->
    <aside id="sidebar" class="sidebar-expanded bg-gradient-to-b from-white to-blue-50 shadow-xl pt-6 pb-8 px-2 flex flex-col gap-2 transition-all duration-300 hidden md:block w-64 shrink-0 min-h-[calc(100vh-4rem)]">
      <div class="flex items-center justify-between mb-4 px-2">
        <div class="flex items-center gap-2">
          <div class="relative">
            <img src="/public/images/logo.png" alt="ADD Logo" class="h-8 w-8 rounded-lg shadow-md" />
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
          </div>
          <span class="font-bold text-lg gradient-text">Seller Portal</span>
        </div>
        <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-blue-100 transition-colors">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600" viewBox="0 0 24 24"><path d="M4 12h16"/><path d="M10 6l-6 6 6 6"/></svg>
        </button>
      </div>
      <nav class="flex flex-col gap-1">
          <a href="#" class="sidebar-link active flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
            </svg>
            <span>Overview</span>
          </a>
          
          <!-- Local Market Section -->
          <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 mb-4 border border-green-200">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-lg">🛒</span>
              <span class="font-bold text-sm text-green-800">Local Market</span>
              <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">NEW</span>
            </div>
            <p class="text-xs text-green-700 mb-3">Sell fresh groceries with fast delivery</p>
            <a href="/seller/local-market-dashboard.html" 
               class="block w-full text-center bg-green-600 hover:bg-green-700 text-white text-sm font-semibold py-2 rounded-lg transition-colors">
              Switch to Local Market
            </a>
          </div>

          <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Product Management</div>
          <a href="/seller/add-product.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <span>Add Product</span>
          </a>
          <a href="/seller/products.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
            </svg>
            <span>All Products</span>
          </a>
          <a href="#" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <span>Out of Stock</span>
          </a>
          
          <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Orders</div>
          <a href="#" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Pending</span>
            <span class="ml-auto bg-orange-500 text-white text-xs rounded-full px-2 py-1">5</span>
          </a>
          <a href="#" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Completed</span>
          </a>
          <a href="#" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            <span>Cancelled</span>
          </a>
        <a href="/seller/returns.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
          </svg>
          <span>Returns</span>
        </a>
        
        <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Promotions & Ads</div>
        <a href="/seller/boosted-products.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
          <span>Boosted Products</span>
        </a>
        
        <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Communication</div>
        <a href="/seller/messages.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          <span>Messages</span>
          <span class="ml-auto bg-blue-500 text-white text-xs rounded-full px-2 py-1">3</span>
        </a>
        <a href="/seller/notifications.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h16a2 2 0 002-2V7a2 2 0 00-2-2H4a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg>
          <span>Notifications</span>
          <span class="ml-auto bg-red-500 text-white text-xs rounded-full px-2 py-1">5</span>
        </a>
        
        <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Business Tools</div>
        <a href="/seller/analytics.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Analytics</span>
        </a>
        <a href="/seller/reviews.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
          </svg>
          <span>Reviews</span>
        </a>
        <a href="/seller/payouts.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          <span>Payouts</span>
        </a>
        
        <div class="font-bold text-xs text-gray-500 mt-6 mb-2 px-3">Account & Support</div>
        <a href="/seller/profile.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span>Profile</span>
        </a>
        <a href="/seller/wallet.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
          </svg>
          <span>Wallet</span>
        </a>
        <a href="/seller/support-tickets.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <span>Support Tickets</span>
        </a>
        <a href="/seller/settings.html" class="sidebar-link flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-blue-100 transition-all duration-200">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <span>Settings</span>
        </a>
      </nav>
    </aside>
    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col min-h-0 p-1 md:p-2">
      <!-- Enhanced Greeting Section -->
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-white mb-8 animate-fade-in">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-3xl font-bold mb-2" id="greeting">Welcome back, Seller! 👋</h2>
            <p class="text-blue-100 text-lg mb-4">Your store is performing excellently! Here's what's happening today.</p>
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-sm">Store is live</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-yellow-400 rounded-full animate-pulse"></div>
                <span class="text-sm">5 new orders</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-blue-400 rounded-full animate-pulse"></div>
                <span class="text-sm">3 messages</span>
              </div>
            </div>
          </div>
          <div class="hidden md:block">
            <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center">
              <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>
                      <!-- Enhanced Dashboard Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                  <div class="soft-card bg-gradient-to-br from-green-500 to-green-600 p-6 text-white hover-lift animate-fade-in">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="text-green-100 text-sm font-medium mb-1" data-i18n="totalSales">Total Sales</p>
                        <p class="text-3xl font-bold text-white" id="card-sales">--</p>
                        <p class="text-xs text-green-100 mt-1 flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L12 10.586z" clip-rule="evenodd"/>
                          </svg>
                          +12.5% from last month
                        </p>
                      </div>
                      <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center pulse-glow">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                      </div>
                    </div>
                  </div>
        
        <div class="soft-card bg-gradient-to-br from-blue-500 to-blue-600 p-6 text-white hover-lift animate-fade-in" style="animation-delay: 0.1s;">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-blue-100 text-sm font-medium mb-1" data-i18n="pendingOrders">Pending Orders</p>
              <p class="text-3xl font-bold text-white" id="card-pending">--</p>
              <p class="text-xs text-blue-100 mt-1 flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                +8.3% from last month
              </p>
            </div>
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
              </svg>
            </div>
          </div>
        </div>
        
        <div class="soft-card bg-gradient-to-br from-orange-500 to-orange-600 p-6 text-white hover-lift animate-fade-in" style="animation-delay: 0.2s;">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-orange-100 text-sm font-medium mb-1" data-i18n="outOfStock">Out of Stock</p>
              <p class="text-3xl font-bold text-white" id="card-outofstock">--</p>
              <p class="text-xs text-orange-100 mt-1 flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                -5.2% from last month
              </p>
            </div>
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
              </svg>
            </div>
          </div>
        </div>
        
        <div class="soft-card bg-gradient-to-br from-purple-500 to-purple-600 p-6 text-white hover-lift animate-fade-in" style="animation-delay: 0.3s;">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-purple-100 text-sm font-medium mb-1" data-i18n="newMessages">New Messages</p>
              <p class="text-3xl font-bold text-white" id="card-messages">--</p>
              <p class="text-xs text-purple-100 mt-1 flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L12 10.586z" clip-rule="evenodd"/>
                </svg>
                +15.7% from last month
              </p>
            </div>
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>
      <!-- Recent Orders Table -->
      <div class="bg-white soft-card shadow p-6 mb-8 overflow-x-auto">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-[#0e2038]" data-i18n="recentOrders">Recent Orders</h3>
          <a href="/seller/orders.html" class="text-blue-600 hover:underline text-sm" data-i18n="viewAll">View All</a>
        </div>
        <table class="min-w-full text-sm">
          <thead>
            <tr class="text-gray-500">
              <th class="px-4 py-2" data-i18n="orderId">Order ID</th>
              <th class="px-4 py-2" data-i18n="buyer">Buyer</th>
              <th class="px-4 py-2" data-i18n="date">Date</th>
              <th class="px-4 py-2" data-i18n="status">Status</th>
              <th class="px-4 py-2" data-i18n="total">Total</th>
              <th class="px-4 py-2" data-i18n="actions">Actions</th>
            </tr>
          </thead>
          <tbody id="orders-table">
            <!-- TODO: Integrate Order Management & Tracking API -->
          </tbody>
        </table>
      </div>
      <!-- Recent Products Section -->
      <div class="bg-white soft-card shadow p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-[#0e2038]">Recent Products</h3>
          <a href="/seller/products.html" class="text-blue-600 hover:text-blue-700 font-semibold text-sm">View All →</a>
        </div>
        <div id="recent-products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- Recent products will be loaded here -->
          <div class="animate-pulse">
            <div class="bg-gray-200 h-32 rounded-lg mb-2"></div>
            <div class="h-4 bg-gray-200 rounded mb-1"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          </div>
          <div class="animate-pulse">
            <div class="bg-gray-200 h-32 rounded-lg mb-2"></div>
            <div class="h-4 bg-gray-200 rounded mb-1"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          </div>
          <div class="animate-pulse">
            <div class="bg-gray-200 h-32 rounded-lg mb-2"></div>
            <div class="h-4 bg-gray-200 rounded mb-1"></div>
            <div class="h-4 bg-gray-200 rounded w-3/4"></div>
          </div>
        </div>
      </div>

      <!-- Product Performance Charts -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white soft-card shadow p-6">
          <h3 class="text-lg font-bold mb-2 text-[#0e2038]" data-i18n="bestSelling">Best-selling Products</h3>
          <canvas id="bestseller-chart" height="180"></canvas>
          <!-- TODO: Integrate Analytics & Reporting API -->
        </div>
        <div class="bg-white soft-card shadow p-6">
          <h3 class="text-lg font-bold mb-2 text-[#0e2038]" data-i18n="orderStatus">Order Status</h3>
          <canvas id="orderstatus-chart" height="180"></canvas>
          <!-- TODO: Integrate Analytics & Reporting API -->
        </div>
      </div>
      <!-- Notification Feed -->
      <div class="bg-white soft-card shadow p-6 mb-8">
        <h3 class="text-lg font-bold mb-2 text-[#0e2038]" data-i18n="notifications">Notifications</h3>
        <ul id="notification-feed" class="space-y-2 max-h-40 overflow-y-auto scrollbar-hide">
          <!-- TODO: Integrate Notification API -->
        </ul>
      </div>
    </main>
  </div>
  <!-- Footer -->
  <footer class="bg-white/90 border-t border-gray-200 mt-12 pt-8 pb-4 px-2 md:px-6">
    <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-8 text-sm">
      <div>
        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-1">Support</h3>
        <ul class="space-y-1">
          <li><a href="/buyer/support.html" class="hover:underline flex items-center gap-1">Help Center</a></li>
          <li><a href="#" class="hover:underline flex items-center gap-1">Contact Us</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-1">Legal</h3>
        <ul class="space-y-1">
          <li><a href="/public/terms-and-conditions.html" class="hover:underline flex items-center gap-1">Terms</a></li>
          <li><a href="/public/privacy-policy.html" class="hover:underline flex items-center gap-1">Privacy</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-1">Community</h3>
        <ul class="space-y-1">
          <li><a href="#" class="hover:underline flex items-center gap-1">WhatsApp</a></li>
          <li><a href="#" class="hover:underline flex items-center gap-1">Facebook</a></li>
          <li><a href="#" class="hover:underline flex items-center gap-1">Twitter</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-1">Preferences</h3>
        <div class="flex gap-2 mb-2">
          <select class="border rounded px-2 py-1 text-xs">
            <option>English</option>
            <option>Kinyarwanda</option>
            <option>French</option>
            <option>Kiswahili</option>
          </select>
          <select class="border rounded px-2 py-1 text-xs">
            <option>RWF</option>
            <option>USD</option>
            <option>EUR</option>
          </select>
        </div>
      </div>
    </div>
    <div class="text-center text-xs text-gray-500 mt-4">&copy; 2025 African Deals Domain. All rights reserved.</div>
  </footer>
  <script>
    // --- AUTH CHECK (robust, consistent) ---
    document.addEventListener('DOMContentLoaded', function() {
      normalizeAuthStorage();
      const { token, user } = readAuthState();

      if (!token || !user || !isSeller(user)) {
        console.log('Authentication required - redirecting to seller login');
        window.location.replace('/auth/auth-seller.html');
        return;
      }

      initializeDashboard();
    });

    function readAuthState() {
      const token = localStorage.getItem('authToken') || localStorage.getItem('token');
      let user = null;
      try {
        user = JSON.parse(localStorage.getItem('userData') || localStorage.getItem('user') || 'null');
      } catch (_) { user = null; }
      return { token, user };
    }

    function isSeller(user) {
      const role = (user?.role || '').toString().toLowerCase();
      return role === 'seller' || role === 'sellers' || role === 'store' || role === 'vendor';
    }

    function normalizeAuthStorage() {
      const token = localStorage.getItem('authToken') || localStorage.getItem('token');
      const userStr = localStorage.getItem('userData') || localStorage.getItem('user');
      if (token) {
        // Persist under both legacy and canonical keys so all pages agree
        localStorage.setItem('authToken', token);
        localStorage.setItem('token', token);
      }
      if (userStr) {
        localStorage.setItem('userData', userStr);
        localStorage.setItem('user', userStr);
      }
    }

    function initializeDashboard() {
      // Update profile name if available
      const user = JSON.parse(localStorage.getItem('userData') || localStorage.getItem('user') || 'null');
      const profileName = document.getElementById('profile-name');
      if (profileName && user && user.name) {
        profileName.textContent = user.name;
      }

      console.log('✅ Seller dashboard initialized for:', user?.name, '(ID:', user?.id, ')');
    }

    // --- GLOBAL STATE ---
    let currencyRates = {};
    let selectedCurrency = localStorage.getItem('selectedCurrency') || 'RWF';
    let selectedCurrencySymbol = { USD: '$', RWF: 'FRw', EUR: '€', KES: 'Ksh', NGN: '₦' }[selectedCurrency] || 'FRw';
    let selectedLang = localStorage.getItem('selectedLang') || 'en';
    const currencySymbols = { USD: '$', RWF: 'FRw', EUR: '€', KES: 'Ksh', NGN: '₦' };
    const supportedCurrencies = ['USD','RWF','EUR','KES','NGN'];
    const supportedLangs = [
      { code: 'en', label: 'English' },
      { code: 'fr', label: 'Français' },
      { code: 'rw', label: 'Kinyarwanda' },
      { code: 'sw', label: 'Kiswahili' },
      { code: 'ar', label: 'العربية' },
      { code: 'ha', label: 'Hausa' },
      { code: 'yo', label: 'Yoruba' }
    ];

    // --- SIDEBAR COLLAPSE ---
    const sidebarToggle = document.getElementById('sidebar-toggle');
    if (sidebarToggle) {
      sidebarToggle.onclick = function() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
          sidebar.classList.toggle('sidebar-collapsed');
          sidebar.classList.toggle('sidebar-expanded');
        }
      };
    }

    // --- PROFILE DROPDOWN ---
    const profileDropdownBtn = document.getElementById('profile-dropdown-btn');
    if (profileDropdownBtn) {
      profileDropdownBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const dropdownMenu = document.getElementById('profile-dropdown-menu');
        const arrow = document.getElementById('dropdown-arrow');
        if (dropdownMenu) dropdownMenu.classList.toggle('hidden');
        if (arrow) arrow.classList.toggle('rotate-180');
      });
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const dropdownMenu = document.getElementById('profile-dropdown-menu');
      const dropdownBtn = document.getElementById('profile-dropdown-btn');
      const arrow = document.getElementById('dropdown-arrow');
      
      if (dropdownBtn && dropdownMenu && !dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
        dropdownMenu.classList.add('hidden');
        if (arrow) arrow.classList.remove('rotate-180');
      }
    });

    // --- MOBILE MENU ---
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // --- LOGOUT ---
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.onclick = function() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
        window.location.href = '/auth/auth-seller.html';
      };
    }

    // --- LANGUAGE SWITCHER ---
    const langSwitch = document.getElementById('lang-switch');
    const i18n = {
      greeting: {
        en: 'Welcome back, Seller!',
        fr: 'Bon retour, Vendeur!',
        rw: 'Murakaza neza, Umucuruzi!',
        sw: 'Karibu tena, Muuzaji!',
        ar: 'مرحبًا بعودتك، البائع!',
        ha: 'Barka da dawowa, Mai sayarwa!',
        yo: 'Kaabo pada, Olùtajà!'
      },
      totalSales: {
        en: 'Total Sales', fr: 'Ventes totales', rw: 'Igiteranyo cy\'Ubucuruzi', sw: 'Jumla ya Mauzo', ar: 'إجمالي المبيعات', ha: 'Jimillar Tallace-tallace', yo: 'Lapapọ Tita'
      },
      pendingOrders: {
        en: 'Pending Orders', fr: 'Commandes en attente', rw: 'Itegeko ritararangira', sw: 'Oda Zinazosubiri', ar: 'الطلبات المعلقة', ha: 'Umarni Masu Jira', yo: 'Awọn aṣẹ ti n duro de'
      },
      outOfStock: {
        en: 'Out of Stock', fr: 'Rupture de stock', rw: 'Byarashize', sw: 'Imeisha', ar: 'غير متوفر', ha: 'Ba a Samu ba', yo: 'Ko si ni Stọkì'
      },
      newMessages: {
        en: 'New Messages', fr: 'Nouveaux messages', rw: 'Ubutumwa bushya', sw: 'Ujumbe Mpya', ar: 'رسائل جديدة', ha: 'Sabbin Saƙonni', yo: 'Ifiranṣẹ Titun'
      },
      recentOrders: {
        en: 'Recent Orders', fr: 'Commandes récentes', rw: 'Itegeko rishya', sw: 'Oda za Hivi Karibuni', ar: 'الطلبات الأخيرة', ha: 'Sabbin Umarni', yo: 'Awọn aṣẹ laipẹ'
      },
      viewAll: {
        en: 'View All', fr: 'Voir tout', rw: 'Reba byose', sw: 'Tazama Zote', ar: 'عرض الكل', ha: 'Duba Duka', yo: 'Wo Gbogbo'
      },
      orderId: {
        en: 'Order ID', fr: 'ID Commande', rw: 'ID y\'Itegeko', sw: 'Kitambulisho cha Oda', ar: 'معرف الطلب', ha: 'ID Umarni', yo: 'ID Aṣẹ'
      },
      buyer: {
        en: 'Buyer', fr: 'Acheteur', rw: 'Umuguzi', sw: 'Mnunuzi', ar: 'المشتري', ha: 'Mai Siya', yo: 'Onra'
      },
      date: {
        en: 'Date', fr: 'Date', rw: 'Itariki', sw: 'Tarehe', ar: 'التاريخ', ha: 'Kwanan wata', yo: 'Ọjọ'
      },
      status: {
        en: 'Status', fr: 'Statut', rw: 'Imiterere', sw: 'Hali', ar: 'الحالة', ha: 'Matsayi', yo: 'Ipo'
      },
      total: {
        en: 'Total', fr: 'Total', rw: 'Igiteranyo', sw: 'Jumla', ar: 'الإجمالي', ha: 'Jimilla', yo: 'Lapapọ'
      },
      actions: {
        en: 'Actions', fr: 'Actions', rw: 'Ibikorwa', sw: 'Vitendo', ar: 'إجراءات', ha: 'Ayyuka', yo: 'Iṣe'
      },
      view: {
        en: 'View', fr: 'Voir', rw: 'Reba', sw: 'Tazama', ar: 'عرض', ha: 'Duba', yo: 'Wo'
      },
      bestSelling: {
        en: 'Best-selling Products', fr: 'Meilleures ventes', rw: 'Ibicuruzwa bigurishwa cyane', sw: 'Bidhaa Zinazouzwa Zaidi', ar: 'المنتجات الأكثر مبيعًا', ha: 'Kayayyakin da Aka Fi Siyarwa', yo: 'Awọn ọja tita julọ'
      },
      orderStatus: {
        en: 'Order Status', fr: 'Statut de la commande', rw: 'Imiterere y\'Itegeko', sw: 'Hali ya Oda', ar: 'حالة الطلب', ha: 'Matsayin Umarni', yo: 'Ipo Aṣẹ'
      },
      notifications: {
        en: 'Notifications', fr: 'Notifications', rw: 'Amakuru', sw: 'Arifa', ar: 'إشعارات', ha: 'Sanarwa', yo: 'Ìkìlọ́'
      },
      onlineSupport: {
        en: 'Online Support', fr: 'Support en ligne', rw: 'Ubufasha kuri internet', sw: 'Msaada Mtandaoni', ar: 'الدعم عبر الإنترنت', ha: 'Tallafin Kan layi', yo: 'Atilẹyin Ayelujara'
      },
      profileSettings: {
        en: 'Profile Settings', fr: 'Paramètres du profil', rw: 'Uburere bwo guhagaze', sw: 'Mipangilio ya Muuzaji', ar: 'إعدادات الملف الشخصي', ha: 'Kowace da mai siya', yo: 'Ọwọn ọwọn mu'
      },
      analytics: {
        en: 'Analytics', fr: 'Analytiques', rw: 'Ikibazo', sw: 'Ujumbe', ar: 'التحليلات', ha: 'Kayan ƙasar', yo: 'Ẹnikẹni'
      },
      privacyPolicy: {
        en: 'Privacy & Policy', fr: 'Politique de confidentialité', rw: 'Uburere bwo guhagaze', sw: 'Mipangilio ya Muuzaji', ar: 'سياسة الخصوصية', ha: 'Kowace da mai siya', yo: 'Ọwọn ọwọn mu'
      },
      termsConditions: {
        en: 'Terms & Conditions', fr: 'Conditions d\'utilisation', rw: 'Itegeko z\'ibyaha', sw: 'Mipangilio ya Muuzaji', ar: 'الشروط والأحكام', ha: 'Kowace da mai siya', yo: 'Ọwọn ọwọn mu'
      },
      settings: {
        en: 'Settings', fr: 'Paramètres', rw: 'Uburere', sw: 'Mipangilio', ar: 'الإعدادات', ha: 'Kowace', yo: 'Ọwọn ọwọn'
      },
      support: {
        en: 'Support', fr: 'Support', rw: 'Ubufasha', sw: 'Msaada', ar: 'الدعم', ha: 'Tallafi', yo: 'Atilẹyin'
      },
      logout: {
        en: 'Logout', fr: 'Déconnexion', rw: 'Sohoka', sw: 'Ondoka', ar: 'تسجيل الخروج', ha: 'Fita', yo: 'Jáde'
      }
    };
    function t(key) {
      return i18n[key] && i18n[key][selectedLang] ? i18n[key][selectedLang] : (i18n[key] ? i18n[key]['en'] : key);
    }
    function updateLangUI() {
      const elements = {
        'greeting': document.getElementById('greeting'),
        'totalSales': document.querySelector('[data-i18n="totalSales"]'),
        'pendingOrders': document.querySelector('[data-i18n="pendingOrders"]'),
        'outOfStock': document.querySelector('[data-i18n="outOfStock"]'),
        'newMessages': document.querySelector('[data-i18n="newMessages"]'),
        'recentOrders': document.querySelector('[data-i18n="recentOrders"]'),
        'viewAll': document.querySelector('[data-i18n="viewAll"]'),
        'orderId': document.querySelector('[data-i18n="orderId"]'),
        'buyer': document.querySelector('[data-i18n="buyer"]'),
        'date': document.querySelector('[data-i18n="date"]'),
        'status': document.querySelector('[data-i18n="status"]'),
        'total': document.querySelector('[data-i18n="total"]'),
        'actions': document.querySelector('[data-i18n="actions"]'),
        'bestSelling': document.querySelector('[data-i18n="bestSelling"]'),
        'orderStatus': document.querySelector('[data-i18n="orderStatus"]'),
        'notifications': document.querySelector('[data-i18n="notifications"]'),
        'onlineSupport': document.querySelector('[data-i18n="onlineSupport"]'),
        'profileSettings': document.querySelector('[data-i18n="profileSettings"]'),
        'analytics': document.querySelector('[data-i18n="analytics"]'),
        'privacyPolicy': document.querySelector('[data-i18n="privacyPolicy"]'),
        'termsConditions': document.querySelector('[data-i18n="termsConditions"]'),
        'settings': document.querySelector('[data-i18n="settings"]'),
        'support': document.querySelector('[data-i18n="support"]'),
        'logout': document.querySelector('[data-i18n="logout"]')
      };
      
      // Update elements that exist
      Object.entries(elements).forEach(([key, element]) => {
        if (element) {
          element.textContent = t(key);
        }
      });
      
      // Update order table action links
      document.querySelectorAll('.order-view-link').forEach(el => el.textContent = t('view'));
    }
    function renderLangOptions() {
      if (langSwitch) {
        langSwitch.innerHTML = supportedLangs.map(l => `<option value="${l.code}">${l.label}</option>`).join('');
        langSwitch.value = selectedLang;
      }
    }
    if (langSwitch) {
      langSwitch.addEventListener('change', function() {
        selectedLang = this.value;
        localStorage.setItem('selectedLang', selectedLang);
        updateLangUI();
      });
      renderLangOptions();
    }
    // Call updateLangUI after DOMContentLoaded to ensure all elements exist
    document.addEventListener('DOMContentLoaded', updateLangUI);

    // --- CURRENCY SWITCHER ---
    const currencySwitch = document.getElementById('currency-switch');
    function renderCurrencyOptions(currencyList) {
      if (currencySwitch) {
        currencySwitch.innerHTML = currencyList.map(cur => `<option value="${cur}">${cur}</option>`).join('');
        currencySwitch.value = selectedCurrency;
      }
    }
    if (currencySwitch) {
      currencySwitch.addEventListener('change', function() {
        selectedCurrency = this.value;
        selectedCurrencySymbol = currencySymbols[selectedCurrency] || selectedCurrency;
        localStorage.setItem('selectedCurrency', selectedCurrency);
        updateCurrencyUI();
        updateDashboardPrices();
      });
    }
    function updateCurrencyUI() {
      // Optionally update currency symbol in UI
    }
    
    function updateDashboardPrices() {
      // Update prices when currency changes
      const rate = currencyRates[selectedCurrency] || 1;
      document.querySelectorAll('[data-base-price]').forEach(element => {
        const basePrice = parseFloat(element.dataset.basePrice || 0);
        element.textContent = `${selectedCurrencySymbol} ${(basePrice * rate).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
      });
    }

    // --- FETCH CURRENCY RATES ---
    async function fetchCurrencyRates() {
      try {
        const res = await fetch('https://v6.exchangerate-api.com/v6/c5f524e323378439dad2a43f/latest/USD');
        const data = await res.json();
        if (data && data.result === 'success') {
          currencyRates = data.conversion_rates;
          localStorage.setItem('currencyRates', JSON.stringify(currencyRates));
          renderCurrencyOptions(Object.keys(currencyRates));
        } else {
          throw new Error('API error');
        }
      } catch (e) {
        // fallback
        currencyRates = { USD: 1, RWF: 1200, EUR: 0.9, KES: 130, NGN: 1500 };
        localStorage.setItem('currencyRates', JSON.stringify(currencyRates));
        renderCurrencyOptions(Object.keys(currencyRates));
      }
      updateDashboardPrices();
    }
    fetchCurrencyRates();

    // Initialize dashboard with real data
    fetchDashboardData();

    // --- DASHBOARD CARDS (REAL DATA FROM BACKEND) ---
    async function fetchDashboardData() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        if (!token) {
          // Allow a short grace period after login before redirecting
          const fresh = sessionStorage.getItem('freshLogin');
          if (fresh) {
            await new Promise(r => setTimeout(r, 500));
          }
          const recheck = localStorage.getItem('authToken') || localStorage.getItem('token');
          if (!recheck) {
            window.location.replace('/auth/auth-seller.html');
            return;
          }
        }

        // Show loading states
        showLoadingState('card-sales', 'Loading sales...');
        showLoadingState('card-pending', 'Loading orders...');
        showLoadingState('card-outofstock', 'Loading stock...');
        showLoadingState('card-messages', 'Loading messages...');
        showLoadingState('orders-table', 'Loading recent orders...');

        // Fetch seller statistics
        const statsRes = await fetch('/api/seller/stats', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (statsRes.ok) {
          const stats = await statsRes.json();
          updateDashboardCards(stats);
          showNotification('Dashboard Updated', 'Latest statistics loaded successfully', 'success');
        } else {
          // Fallback to basic stats if API not available
          await fetchBasicStats();
          showNotification('Using Cached Data', 'Unable to fetch latest stats, showing cached data', 'warning');
        }

        // Fetch recent orders
        await fetchRecentOrders();
        
        // Fetch recent products
        await loadRecentProducts();
        
        // Fetch notifications
        await fetchNotifications();
        
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
        showNotification('Error Loading Dashboard', 'Failed to load dashboard data. Please refresh the page.', 'error');
        
        // Show error state
        document.getElementById('card-sales').textContent = '--';
        document.getElementById('card-pending').textContent = '--';
        document.getElementById('card-outofstock').textContent = '--';
        document.getElementById('card-messages').textContent = '--';
      }
    }

    async function fetchBasicStats() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const [productsRes, ordersRes, messagesRes] = await Promise.all([
          fetch('/api/seller/products', { headers: { 'Authorization': `Bearer ${token}` } }),
          fetch('/api/seller/orders', { headers: { 'Authorization': `Bearer ${token}` } }),
          fetch('/api/seller/messages', { headers: { 'Authorization': `Bearer ${token}` } })
        ]);

        let totalSales = 0;
        let pendingOrders = 0;
        let outOfStock = 0;
        let newMessages = 0;

        if (productsRes.ok) {
          const products = await productsRes.json();
          outOfStock = products.products?.filter(p => p.stock_quantity <= 0).length || 0;
        }

        if (ordersRes.ok) {
          const orders = await ordersRes.json();
          pendingOrders = orders.orders?.filter(o => o.status === 'pending').length || 0;
          totalSales = orders.orders?.reduce((sum, o) => sum + parseFloat(o.seller_earnings || 0), 0) || 0;
        }

        if (messagesRes.ok) {
          const messages = await messagesRes.json();
          newMessages = messages.messages?.filter(m => !m.is_read).length || 0;
        }

        updateDashboardCards({ totalSales, pendingOrders, outOfStock, newMessages });
      } catch (error) {
        console.error('Error fetching basic stats:', error);
      }
    }

    function updateDashboardCards(stats) {
      const rate = currencyRates[selectedCurrency] || 1;
      const salesElement = document.getElementById('card-sales');
      const pendingElement = document.getElementById('card-pending');
      const outOfStockElement = document.getElementById('card-outofstock');
      const messagesElement = document.getElementById('card-messages');
      
      if (salesElement) {
        salesElement.textContent = `${selectedCurrencySymbol} ${(stats.totalSales * rate).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
      }
      if (pendingElement) {
        pendingElement.textContent = stats.pendingOrders || 0;
      }
      if (outOfStockElement) {
        outOfStockElement.textContent = stats.outOfStock || 0;
      }
      if (messagesElement) {
        messagesElement.textContent = stats.newMessages || 0;
      }
    }

    // --- RECENT ORDERS TABLE (REAL DATA FROM BACKEND) ---
    async function fetchRecentOrders() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const res = await fetch('/api/seller/orders?limit=5', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (res.ok) {
          const data = await res.json();
          renderOrdersTable(data.orders || []);
        } else {
          // Show empty state
          renderOrdersTable([]);
        }
      } catch (error) {
        console.error('Error fetching recent orders:', error);
        renderOrdersTable([]);
      }
    }

    function renderOrdersTable(orders) {
      const rate = currencyRates[selectedCurrency] || 1;
      
      if (orders.length === 0) {
        document.getElementById('orders-table').innerHTML = `
          <tr>
            <td colspan="6" class="px-4 py-8 text-center text-gray-500">
              <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-2 text-gray-300" viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <path d="M21 15l-5-5L5 21"/>
              </svg>
              <p class="text-sm">No orders yet</p>
              <p class="text-xs text-gray-400">Orders will appear here when customers place them</p>
            </td>
          </tr>
        `;
        return;
      }
      
      const rows = orders.map(order => `
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm font-medium">${order.order_number || order.id}</td>
          <td class="px-4 py-3 text-sm">${order.buyer_name || 'Customer'}</td>
          <td class="px-4 py-3 text-sm">${new Date(order.created_at).toLocaleDateString()}</td>
          <td class="px-4 py-3">
            <span class="px-2 py-1 text-xs rounded-full ${getStatusColor(order.status)}">
              ${order.status}
            </span>
          </td>
          <td class="px-4 py-3 text-sm font-medium order-total" data-base-price="${order.seller_earnings}">
            ${selectedCurrencySymbol} ${(parseFloat(order.seller_earnings || 0) * rate).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}
          </td>
          <td class="px-4 py-3">
            <a href="/seller/order-detail.html?id=${order.id}" class="text-blue-600 hover:underline text-xs order-view-link">${t('view')}</a>
          </td>
        </tr>
      `).join('');
      
      document.getElementById('orders-table').innerHTML = rows;
    }

    function getStatusColor(status) {
      const colors = {
        'pending': 'bg-yellow-100 text-yellow-800',
        'confirmed': 'bg-blue-100 text-blue-800',
        'processing': 'bg-purple-100 text-purple-800',
        'shipped': 'bg-indigo-100 text-indigo-800',
        'delivered': 'bg-green-100 text-green-800',
        'cancelled': 'bg-red-100 text-red-800'
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    }

    // --- PRODUCT PERFORMANCE CHARTS (MOCK DATA) ---
    new Chart(document.getElementById('bestseller-chart').getContext('2d'), {
      type: 'bar',
      data: { labels: ['Product A','Product B','Product C'], datasets: [{ label: 'Sales', data: [12, 19, 7], backgroundColor: ['#2563eb','#818cf8','#fbbf24'] }] },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });
    new Chart(document.getElementById('orderstatus-chart').getContext('2d'), {
      type: 'pie',
      data: { labels: ['Pending','Completed','Cancelled'], datasets: [{ data: [5, 15, 2], backgroundColor: ['#fbbf24','#22c55e','#ef4444'] }] },
      options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    // --- LOAD RECENT PRODUCTS (REAL DATA FROM BACKEND) ---
    async function loadRecentProducts() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        console.log('🔍 Loading recent products...');
        console.log('Token:', token ? 'Present' : 'Missing');
        
        const res = await fetch('/api/seller/products?limit=3', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        console.log('API Response status:', res.status);
        
        if (res.ok) {
          const data = await res.json();
          console.log('API Response data:', data);
          const products = data.products || [];
          
          console.log(`Found ${products.length} products`);
          
          if (products.length > 0) {
            const container = document.getElementById('recent-products');
            const rate = currencyRates[selectedCurrency] || 1;
            
            container.innerHTML = products.map(product => `
              <div class="bg-white border border-gray-200 rounded-lg p-3 hover:shadow-md transition-shadow">
                <div class="flex items-center gap-3">
                  <img src="${product.image_url || '/public/images/placeholder.png'}" 
                       alt="${product.name}" 
                       class="w-16 h-16 object-cover rounded-lg"
                       onerror="this.src='/public/images/logo.png'">
                  <div class="flex-1 min-w-0">
                    <h4 class="font-semibold text-gray-900 text-sm truncate">${product.name}</h4>
                    <p class="text-xs text-gray-500">${product.category || 'Uncategorized'}</p>
                    <p class="text-sm font-bold text-gray-900" data-base-price="${product.price}">
                      ${selectedCurrencySymbol} ${(parseFloat(product.price || 0) * rate).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}
                    </p>
                    <p class="text-xs text-gray-500">Stock: ${product.stock_quantity || 0}</p>
                  </div>
                </div>
              </div>
            `).join('');
            console.log('✅ Products rendered successfully');
          } else {
            document.getElementById('recent-products').innerHTML = `
              <div class="col-span-full text-center py-4 text-gray-500">
                <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-2 text-gray-300" viewBox="0 0 24 24">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5"/>
                  <path d="M21 15l-5-5L5 21"/>
                </svg>
                <p class="text-sm">No products yet</p>
                <a href="/seller/add-product.html" class="text-blue-600 hover:text-blue-700 text-sm font-semibold">Add your first product →</a>
              </div>
            `;
            console.log('ℹ️ No products found, showing empty state');
          }
        } else {
          const errorData = await res.text();
          console.error('❌ API Error:', res.status, errorData);
          throw new Error(`Failed to fetch products: ${res.status}`);
        }
      } catch (error) {
        console.error('❌ Error loading recent products:', error);
        document.getElementById('recent-products').innerHTML = `
          <div class="col-span-full text-center py-4 text-gray-500">
            <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" class="mx-auto mb-2 text-gray-300" viewBox="0 0 24 24">
              <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
            </svg>
            <p class="text-sm">Failed to load products</p>
            <p class="text-xs text-gray-400">Please try again later</p>
          </div>
        `;
      }
    }

    // --- NOTIFICATION FEED (REAL DATA FROM BACKEND) ---
    async function fetchNotifications() {
      try {
        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const res = await fetch('/api/notifications/seller?limit=5', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (res.ok) {
          const data = await res.json();
          renderNotifications(data.notifications || []);
        } else {
          // Show welcome message if no notifications API
          renderNotifications([{
            id: 1,
            message: 'Welcome to your seller dashboard!',
            type: 'info',
            created_at: new Date().toISOString()
          }]);
        }
      } catch (error) {
        console.error('Error fetching notifications:', error);
        renderNotifications([{
          id: 1,
          message: 'Welcome to your seller dashboard!',
          type: 'info',
          created_at: new Date().toISOString()
        }]);
      }
    }

    function renderNotifications(notifications) {
      const container = document.getElementById('notification-feed');
      
      if (notifications.length === 0) {
        container.innerHTML = `
          <li class="flex items-center gap-2 text-gray-500">
            <span class="h-2 w-2 rounded-full bg-gray-300"></span>
            <span class="text-sm">No notifications</span>
          </li>
        `;
        return;
      }
      
      container.innerHTML = notifications.map(notification => `
        <li class="flex items-center gap-2">
          <span class="h-2 w-2 rounded-full ${getNotificationColor(notification.type)}"></span>
          <span class="text-sm">${notification.message}</span>
          <span class="text-xs text-gray-400 ml-auto">${formatTimeAgo(notification.created_at)}</span>
        </li>
      `).join('');
    }

    function getNotificationColor(type) {
      const colors = {
        'info': 'bg-blue-500',
        'success': 'bg-green-500',
        'warning': 'bg-yellow-500',
        'error': 'bg-red-500'
      };
      return colors[type] || 'bg-gray-500';
    }

    function formatTimeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      return date.toLocaleDateString();
    }

    // --- SOCKET.IO REAL-TIME NOTIFICATIONS ---
    if (window.io) {
      const socket = io();
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      
      socket.emit('seller-online', { role: 'seller', sellerId: user.id });
      
      // Listen for new orders
      socket.on('new_order', (orderData) => {
        showNotification('New Order Received!', `Order #${orderData.order_number} from ${orderData.buyer_name}`, 'success');
        updateDashboardStats();
        fetchRecentOrders(); // Refresh orders table
      });
      
      // Listen for order status updates
      socket.on('order_status_update', (data) => {
        showNotification('Order Status Updated', `Order #${data.order_number} is now ${data.status}`, 'info');
        fetchRecentOrders(); // Refresh orders table
      });
      
      // Listen for new messages
      socket.on('new_message', (messageData) => {
        showNotification('New Message', `New message from ${messageData.sender_name}`, 'info');
        updateMessageCount();
      });
      
      // Listen for low stock alerts
      socket.on('low_stock_alert', (productData) => {
        showNotification('Low Stock Alert', `${productData.name} is running low (${productData.stock_quantity} left)`, 'warning');
        updateDashboardStats();
      });
    }

    // --- MOBILE DROPDOWN SUPPORT ---
    // Sidebar toggle for mobile
    document.addEventListener('DOMContentLoaded', function() {
      setupProfileDropdown();
      // Touch/click for sidebar
      const sidebarToggle = document.getElementById('sidebar-toggle');
      if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
          const sidebar = document.getElementById('sidebar');
          sidebar.classList.toggle('sidebar-collapsed');
          sidebar.classList.toggle('sidebar-expanded');
        });
      }
      
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      if (mobileMenuBtn && mobileMenu) {
        mobileMenuBtn.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
          
          // Update button icon
          const icon = mobileMenuBtn.querySelector('svg');
          if (mobileMenu.classList.contains('hidden')) {
            icon.innerHTML = '<path d="M4 6h16M4 12h16M4 18h16"/>';
          } else {
            icon.innerHTML = '<path d="M6 18L18 6M6 6l12 12"/>';
          }
        });
      }
      
      // Close mobile menu when clicking outside
      document.addEventListener('click', function(e) {
        if (mobileMenu && mobileMenuBtn && 
            !mobileMenu.contains(e.target) && 
            !mobileMenuBtn.contains(e.target) && 
            !mobileMenu.classList.contains('hidden')) {
          mobileMenu.classList.add('hidden');
          const icon = mobileMenuBtn.querySelector('svg');
          icon.innerHTML = '<path d="M4 6h16M4 12h16M4 18h16"/>';
        }
      });
      
      // Profile dropdown is already handled by the main event listeners above
      // No need for duplicate event listeners here
    });

    // --- NOTIFICATION SYSTEM ---
    function showNotification(title, message, type = 'info') {
      // Create notification container if it doesn't exist
      let container = document.getElementById('notification-container');
      if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'fixed top-4 right-4 z-50 space-y-2';
        document.body.appendChild(container);
      }
      
      // Create notification element
      const notification = document.createElement('div');
      const bgColor = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      }[type] || 'bg-blue-500';
      
      notification.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 max-w-sm`;
      notification.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0">
            ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
          </div>
          <div class="flex-1">
            <h4 class="font-semibold text-sm">${title}</h4>
            <p class="text-xs opacity-90 mt-1">${message}</p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="flex-shrink-0 text-white hover:text-gray-200">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 300);
      }, 5000);
    }
    
    // --- LOADING STATES ---
    function showLoadingState(elementId, text = 'Loading...') {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `
          <div class="flex items-center justify-center py-4">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-gray-600">${text}</span>
          </div>
        `;
      }
    }
    
    function hideLoadingState(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = '';
      }
    }
    
    // --- UTILITY FUNCTIONS ---
    function updateDashboardStats() {
      fetchDashboardData();
    }
    
    function updateMessageCount() {
      fetchNotifications();
    }
    
    // --- DEBUG FUNCTION (for browser console) ---
    window.debugSellerAPI = async function() {
      console.log('🔍 Debugging Seller API...');
      
      const token = localStorage.getItem('token');
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      
      console.log('Token:', token ? 'Present' : 'Missing');
      console.log('User:', user);
      
      if (!token || !user) {
        console.error('❌ No token or user found');
        return;
      }
      
      try {
        // Test seller stats
        console.log('\n📊 Testing /api/seller/stats...');
        const statsRes = await fetch('/api/seller/stats', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        console.log('Stats Response Status:', statsRes.status);
        if (statsRes.ok) {
          const stats = await statsRes.json();
          console.log('Stats Data:', stats);
        } else {
          const errorText = await statsRes.text();
          console.error('Stats Error:', errorText);
        }
        
        // Test seller products
        console.log('\n📦 Testing /api/seller/products...');
        const productsRes = await fetch('/api/seller/products?limit=5', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        console.log('Products Response Status:', productsRes.status);
        if (productsRes.ok) {
          const products = await productsRes.json();
          console.log('Products Data:', products);
        } else {
          const errorText = await productsRes.text();
          console.error('Products Error:', errorText);
        }
        
        // Test seller orders
        console.log('\n📋 Testing /api/seller/orders...');
        const ordersRes = await fetch('/api/seller/orders?limit=5', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        console.log('Orders Response Status:', ordersRes.status);
        if (ordersRes.ok) {
          const orders = await ordersRes.json();
          console.log('Orders Data:', orders);
        } else {
          const errorText = await ordersRes.text();
          console.error('Orders Error:', errorText);
        }
        
      } catch (error) {
        console.error('❌ Debug API Error:', error);
      }
    };
    
    // Call debug function on page load (remove this line after testing)
    // setTimeout(() => window.debugSellerAPI(), 2000);

    // --- NOTIFICATION SYSTEM ---
    function showNotification(title, message, type = 'info') {
      let container = document.getElementById('notification-container');
      if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.className = 'fixed top-4 right-4 z-50 space-y-2';
        document.body.appendChild(container);
      }
      
      const notification = document.createElement('div');
      const bgColor = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      }[type] || 'bg-blue-500';
      
      notification.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 max-w-sm`;
      notification.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="flex-shrink-0">
            ${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}
          </div>
          <div class="flex-1">
            <h4 class="font-semibold text-sm">${title}</h4>
            <p class="text-xs opacity-90 mt-1">${message}</p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="flex-shrink-0 text-white hover:text-gray-200">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      `;
      
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 300);
      }, 5000);
    }

    // --- PROFILE DROPDOWN FUNCTIONALITY ---
    function setupProfileDropdown() {
      const profileBtn = document.getElementById('profile-dropdown-btn');
      const profileMenu = document.getElementById('profile-dropdown-menu');
      const arrow = document.getElementById('dropdown-arrow');
      
      if (profileBtn && profileMenu) {
        profileBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          profileMenu.classList.toggle('hidden');
          arrow.classList.toggle('rotate-180');
        });
        
        document.addEventListener('click', function(e) {
          if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.classList.add('hidden');
            arrow.classList.remove('rotate-180');
          }
        });
      }
      
      // Update profile name
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const profileName = document.getElementById('profile-name');
      if (profileName && user.name) {
        profileName.textContent = user.name;
      }
      
      // Setup logout
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = '/auth/auth-seller.html';
        });
      }
    }

    // --- SECURITY VERIFICATION ---
    window.verifySellerDataIsolation = async function() {
      console.log('🔒 Verifying seller data isolation...');
      
      const token = localStorage.getItem('token');
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      
      if (!token || !user) {
        console.error('❌ No token or user found');
        return;
      }
      
      console.log('Current seller:', user.name, '(ID:', user.id, ')');
      
      try {
        // Test products API
        const productsRes = await fetch('/api/seller/products?limit=10', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (productsRes.ok) {
          const products = await productsRes.json();
          console.log(`📦 Found ${products.products?.length || 0} products for seller ${user.id}:`);
          
          if (products.products) {
            products.products.forEach(product => {
              console.log(`  - ID: ${product.id}, Name: ${product.name}, Seller ID: ${product.seller_id || 'N/A'}`);
              
              // Verify this product belongs to the current seller
              if (product.seller_id && product.seller_id !== user.id) {
                console.error(`  ❌ SECURITY ISSUE: Product ${product.id} belongs to seller ${product.seller_id}, not current seller ${user.id}`);
              } else {
                console.log(`  ✅ Product ${product.id} correctly belongs to current seller`);
              }
            });
          }
        }
        
        // Test orders API
        const ordersRes = await fetch('/api/seller/orders?limit=10', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (ordersRes.ok) {
          const orders = await ordersRes.json();
          console.log(`📋 Found ${orders.orders?.length || 0} orders for seller ${user.id}`);
        }
        
        console.log('✅ Data isolation verification completed');
        
      } catch (error) {
        console.error('❌ Error during security verification:', error);
      }
    };
    
    // Call security verification on page load (remove this line after testing)
    // setTimeout(() => window.verifySellerDataIsolation(), 3000);
  </script>
</body>
</html>
